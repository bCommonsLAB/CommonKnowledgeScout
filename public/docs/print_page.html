
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="http://localhost:3000/docs/print_page.html">
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Common Knowledge Scout – Complete Document - Common Knowledge Scout</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="css/print-site.css">
    
      <link rel="stylesheet" href="css/print-site-material.css">
    
      <link rel="stylesheet" href="assets/stylesheets/print.css">
    
    <script>__md_scope=new URL("/docs/",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  
        <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            remove_material_navigation();remove_mkdocs_theme_navigation();generate_toc();
        })
        </script>
        </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#index" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Common Knowledge Scout" class="md-header__button md-logo" aria-label="Common Knowledge Scout" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Common Knowledge Scout
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Common Knowledge Scout – Complete Document
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/bCommonsLAB/CommonKnowledgeScout" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Common Knowledge Scout" class="md-nav__button md-logo" aria-label="Common Knowledge Scout" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Common Knowledge Scout
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/bCommonsLAB/CommonKnowledgeScout" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Overview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="overview/index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="overview/intro.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Intro
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="overview/features.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Features
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="architecture/module-hierarchy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Module Hierarchy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="architecture/dependency-graph.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dependency Graph
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="architecture/shadow-twin.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shadow-Twin
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="architecture/pdf-transformation-phases.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PDF Transformation Phases
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="guide/index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="guide/setup.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="guide/getting-started.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="guide/settings.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Settings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="guide/library.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using the Library
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="guide/event-monitor.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Event Monitor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="guide/batch-session-import.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Batch Session Import
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="guide/troubleshooting.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="guide/faq.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Use Cases
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Use Cases
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="use-cases/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="use-cases/library-setup.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Library Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="use-cases/file-transformation-pdf.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PDF Transformation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="use-cases/file-transformation-media.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Media Transformation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="use-cases/web-scraping.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Web Scraping
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="use-cases/publishing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Publishing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="use-cases/chat-exploration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chat & Story Mode
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="use-cases/batch-operations.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Batch Operations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Concepts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts/index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts/storage-provider.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Storage Provider
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts/localstorage.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FileSystem (Local)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts/image-transformation.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Image Transformation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts/pdf/extraction-methods.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PDF Extraction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts/metadata.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metadata
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_7" >
        
          
          <label class="md-nav__link" for="__nav_6_7" id="__nav_6_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Library
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_7">
            <span class="md-nav__icon md-icon"></span>
            Library
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts/library/overview.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts/library/global-state.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Global State
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts/library/header.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Header
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts/library/breadcrumb.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Breadcrumb
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts/library/file-tree.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FileTree
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts/library/file-list.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FileList
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts/library/upload.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upload
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts/library/file-preview.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FilePreview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts/library/transcription.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transcription
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts/library/transform.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transform
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts/library/batch-transcription.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Batch Transcription
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts/library/error-handling-logging-testing.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Error Handling & Tests
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts/library/initialization-sequence.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Initialization
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts/library/components.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Library Components
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts/features/shadowtwins.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shadow-Twin
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts/features/extended-shadowtwin.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Extended Shadow-Twin
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts/features/transformation-service.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transformation Service
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts/video-transformation.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Video Transformation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reference/file-index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    File Index
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Modules
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reference/modules/library.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Library
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reference/modules/storage.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Storage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reference/modules/chat.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chat
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reference/glossary.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reference/api/secretary-services.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Secretary Services
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reference/api/track-processor.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Track Processor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="chat-response-generation-process.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chat & Story Mode
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Operations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Operations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="ops/index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="ops/deployment/docker.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="ops/desktop/quick-setup.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Electron Quick Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="ops/desktop/package-strategy.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Electron Package Strategy
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#index" class="md-nav__link">
    <span class="md-ellipsis">
      1 Home
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-2" class="md-nav__link">
    <span class="md-ellipsis">
      2 Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-3" class="md-nav__link">
    <span class="md-ellipsis">
      3 Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architecture-module-hierarchy" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 Module Hierarchy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#architecture-dependency-graph" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 Dependency Graph
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#architecture-shadow-twin" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 Shadow-Twin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#architecture-pdf-transformation-phases" class="md-nav__link">
    <span class="md-ellipsis">
      3.4 PDF Transformation Phases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-4" class="md-nav__link">
    <span class="md-ellipsis">
      4 Guide
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-5" class="md-nav__link">
    <span class="md-ellipsis">
      5 Use Cases
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5 Use Cases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-cases-index" class="md-nav__link">
    <span class="md-ellipsis">
      5.1 Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases-library-setup" class="md-nav__link">
    <span class="md-ellipsis">
      5.2 Library Setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases-file-transformation-pdf" class="md-nav__link">
    <span class="md-ellipsis">
      5.3 PDF Transformation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases-file-transformation-media" class="md-nav__link">
    <span class="md-ellipsis">
      5.4 Media Transformation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases-web-scraping" class="md-nav__link">
    <span class="md-ellipsis">
      5.5 Web Scraping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases-publishing" class="md-nav__link">
    <span class="md-ellipsis">
      5.6 Publishing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases-chat-exploration" class="md-nav__link">
    <span class="md-ellipsis">
      5.7 Chat & Story Mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases-batch-operations" class="md-nav__link">
    <span class="md-ellipsis">
      5.8 Batch Operations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-6" class="md-nav__link">
    <span class="md-ellipsis">
      6 Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6 Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#section-6-7" class="md-nav__link">
    <span class="md-ellipsis">
      6.7 Library
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-7" class="md-nav__link">
    <span class="md-ellipsis">
      7 Reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7 Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reference-file-index" class="md-nav__link">
    <span class="md-ellipsis">
      7.1 File Index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-7-2" class="md-nav__link">
    <span class="md-ellipsis">
      7.2 Modules
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.2 Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reference-modules-library" class="md-nav__link">
    <span class="md-ellipsis">
      7.2.1 Library
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-modules-storage" class="md-nav__link">
    <span class="md-ellipsis">
      7.2.2 Storage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-modules-chat" class="md-nav__link">
    <span class="md-ellipsis">
      7.2.3 Chat
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-8" class="md-nav__link">
    <span class="md-ellipsis">
      8 Operations
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<div id="print-site-page" class="print-site-enumerate-headings print-site-enumerate-figures">
        <section class="print-page">
            <div id="print-page-toc" data-toc-depth="3">
                <nav role='navigation' class='print-page-toc-nav'>
                <h1 class='print-page-toc-title'>Table of Contents</h1>
                </nav>
            </div>
        </section>
        <section class="print-page" id="index" heading-number="1"><h1 id="index-common-knowledge-scout-documentation">Common Knowledge Scout Documentation<a class="headerlink" href="#index-common-knowledge-scout-documentation" title="Permanent link">&para;</a></h1>
<p>Welcome to the Common Knowledge Scout documentation.</p>
<h2 id="index-quick-start">Quick Start<a class="headerlink" href="#index-quick-start" title="Permanent link">&para;</a></h2>
<ul>
<li><strong><a href="#use-cases-index">Use Cases</a></strong> - Step-by-step guides for common tasks</li>
<li><strong><a href="#architecture-module-hierarchy">Architecture</a></strong> - System architecture and module structure</li>
<li><strong><a href="#reference-file-index">Reference</a></strong> - Complete file index and API reference</li>
</ul>
<h2 id="index-documentation-structure">Documentation Structure<a class="headerlink" href="#index-documentation-structure" title="Permanent link">&para;</a></h2>
<h3 id="index-use-cases">Use Cases<a class="headerlink" href="#index-use-cases" title="Permanent link">&para;</a></h3>
<p>Practical guides for end users:
- Library Setup
- File Transformation (PDF, Audio, Video)
- Web Scraping &amp; Event Import
- Publishing &amp; Gallery
- Chat &amp; Story Mode
- Batch Operations</p>
<h3 id="index-architecture">Architecture<a class="headerlink" href="#index-architecture" title="Permanent link">&para;</a></h3>
<p>System design and module documentation:
- Module Hierarchy
- Dependency Graph</p>
<h3 id="index-reference">Reference<a class="headerlink" href="#index-reference" title="Permanent link">&para;</a></h3>
<p>Technical reference documentation:
- File Index
- Module Documentation (Storage, Library, Chat)</p>
<h2 id="index-getting-help">Getting Help<a class="headerlink" href="#index-getting-help" title="Permanent link">&para;</a></h2>
<p>For detailed technical information, see the <a href="#reference-file-index">Reference Documentation</a>.</p></section>
                    <section class='print-page md-section' id='section-2' heading-number='2'>
                        <h1>Overview<a class='headerlink' href='#section-2' title='Permanent link'></a>
                        </h1>
                    </section>
                    <section class='print-page md-section' id='section-3' heading-number='3'>
                        <h1>Architecture<a class='headerlink' href='#section-3' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="architecture-module-hierarchy" heading-number="3.1"><h1 id="architecture-module-hierarchy-module-hierarchy">Module Hierarchy<a class="headerlink" href="#architecture-module-hierarchy-module-hierarchy" title="Permanent link">&para;</a></h1>
<p>Visual representation of the Common Knowledge Scout module organization and dependencies.</p>
<h2 id="architecture-module-hierarchy-module-tree">Module Tree<a class="headerlink" href="#architecture-module-hierarchy-module-tree" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>Common Knowledge Scout
│
├── Core Infrastructure (Layer 1)
│   ├── middleware.ts
│   │   └── Authentication &amp; Routing
│   ├── app/layout.tsx
│   │   └── Root Layout &amp; Providers
│   ├── instrumentation.ts
│   │   └── External Jobs Worker Startup
│   └── lib/
│       ├── env.ts
│       │   └── Environment Variables
│       ├── auth.ts
│       │   └── Authentication Helpers
│       └── mongodb-service.ts
│           └── Database Connection
│
├── Storage Layer (Layer 2)
│   ├── lib/storage/
│   │   ├── types.ts
│   │   │   └── Type Definitions
│   │   ├── storage-factory.ts
│   │   │   ├── LocalStorageProvider
│   │   │   └── StorageFactory
│   │   ├── filesystem-provider.ts
│   │   │   └── FileSystemProvider
│   │   ├── onedrive-provider.ts
│   │   │   └── OneDriveProvider
│   │   ├── onedrive-provider-server.ts
│   │   │   └── OneDriveServerProvider
│   │   ├── filesystem-client.ts
│   │   │   └── FilesystemClient
│   │   ├── server-provider.ts
│   │   │   └── Server Provider Helper
│   │   ├── storage-factory-mongodb.ts
│   │   │   └── MongoDBStorageFactory
│   │   ├── storage-service.ts
│   │   ├── shadow-twin.ts
│   │   └── supported-types.ts
│   ├── contexts/storage-context.tsx
│   │   └── StorageContextProvider
│   └── hooks/use-storage-provider.tsx
│       └── useStorageProvider Hook
│
├── Library System (Layer 3)
│   ├── types/library.ts
│   │   └── Library Type Definitions
│   ├── atoms/library-atom.ts
│   │   └── Library State Atoms
│   ├── lib/services/library-service.ts
│   │   └── LibraryService
│   └── components/library/
│       ├── library.tsx
│       │   └── Main Library Component
│       ├── library-header.tsx
│       ├── library-switcher.tsx
│       ├── file-tree.tsx
│       ├── file-list.tsx
│       ├── file-preview.tsx
│       └── ... (other library components)
│
├── Chat System (Layer 4)
│   ├── types/chat.ts
│   │   └── Chat Type Definitions
│   ├── lib/chat/
│   │   ├── constants.ts
│   │   ├── orchestrator.ts
│   │   ├── loader.ts
│   │   ├── config.ts
│   │   ├── common/
│   │   │   ├── prompt.ts
│   │   │   ├── filters.ts
│   │   │   ├── llm.ts
│   │   │   └── question-analyzer.ts
│   │   └── retrievers/
│   │       ├── chunks.ts
│   │       └── summaries-mongo.ts
│   ├── app/api/chat/[libraryId]/
│   │   └── stream/route.ts
│   └── components/library/chat/
│       └── ... (chat components)
│
└── API Routes &amp; Components (Layer 5)
    ├── app/api/
    │   ├── storage/
    │   ├── chat/
    │   ├── libraries/
    │   ├── external/jobs/
    │   └── ... (other API routes)
    └── components/
        ├── ui/ (Shadcn UI components)
        ├── shared/
        └── ... (other components)
</code></pre></div>
<h2 id="architecture-module-hierarchy-dependency-flow">Dependency Flow<a class="headerlink" href="#architecture-module-hierarchy-dependency-flow" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>Layer 1 (Core Infrastructure)
    ↓
Layer 2 (Storage Layer)
    ↓
Layer 3 (Library System)
    ↓
Layer 4 (Chat System)
    ↓
Layer 5 (API Routes &amp; Components)
</code></pre></div>
<h2 id="architecture-module-hierarchy-module-descriptions">Module Descriptions<a class="headerlink" href="#architecture-module-hierarchy-module-descriptions" title="Permanent link">&para;</a></h2>
<h3 id="architecture-module-hierarchy-core-infrastructure">Core Infrastructure<a class="headerlink" href="#architecture-module-hierarchy-core-infrastructure" title="Permanent link">&para;</a></h3>
<p>Foundation layer providing authentication, database, and environment configuration. No internal dependencies.</p>
<h3 id="architecture-module-hierarchy-storage-layer">Storage Layer<a class="headerlink" href="#architecture-module-hierarchy-storage-layer" title="Permanent link">&para;</a></h3>
<p>Abstracts file storage operations across multiple backends (local filesystem, OneDrive). Depends on Core Infrastructure.</p>
<h3 id="architecture-module-hierarchy-library-system">Library System<a class="headerlink" href="#architecture-module-hierarchy-library-system" title="Permanent link">&para;</a></h3>
<p>Manages library data and provides UI components for file browsing and management. Depends on Storage Layer.</p>
<h3 id="architecture-module-hierarchy-chat-system">Chat System<a class="headerlink" href="#architecture-module-hierarchy-chat-system" title="Permanent link">&para;</a></h3>
<p>Provides RAG-based chat functionality for knowledge exploration. Depends on Library System and Storage Layer.</p>
<h3 id="architecture-module-hierarchy-api-routes-components">API Routes &amp; Components<a class="headerlink" href="#architecture-module-hierarchy-api-routes-components" title="Permanent link">&para;</a></h3>
<p>User-facing API endpoints and React components. Depends on all previous layers.</p>
<h2 id="architecture-module-hierarchy-key-principles">Key Principles<a class="headerlink" href="#architecture-module-hierarchy-key-principles" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>Layered Architecture</strong>: Each layer depends only on layers below it</li>
<li><strong>Dependency Injection</strong>: Higher layers receive dependencies from lower layers</li>
<li><strong>Type Safety</strong>: TypeScript interfaces ensure contract compliance</li>
<li><strong>Separation of Concerns</strong>: Each module has a single, well-defined responsibility</li>
</ol></section><section class="print-page" id="architecture-dependency-graph" heading-number="3.2"><h1 id="architecture-dependency-graph-dependency-graph">Dependency Graph<a class="headerlink" href="#architecture-dependency-graph-dependency-graph" title="Permanent link">&para;</a></h1>
<p>Visual representation of module dependencies in the Common Knowledge Scout application.</p>
<h2 id="architecture-dependency-graph-mermaid-dependency-graph">Mermaid Dependency Graph<a class="headerlink" href="#architecture-dependency-graph-mermaid-dependency-graph" title="Permanent link">&para;</a></h2>
<pre class="mermaid"><code>graph TB
    subgraph "Layer 1: Core Infrastructure"
        MW[middleware.ts]
        LAYOUT[app/layout.tsx]
        INST[instrumentation.ts]
        ENV[lib/env.ts]
        AUTH[lib/auth.ts]
        DB[lib/mongodb-service.ts]
    end

    subgraph "Layer 2: Storage Layer"
        STYPES[lib/storage/types.ts]
        SFACTORY[lib/storage/storage-factory.ts]
        FSPROVIDER[lib/storage/filesystem-provider.ts]
        ODPROVIDER[lib/storage/onedrive-provider.ts]
        SERVERPROV[lib/storage/server-provider.ts]
        SCONTEXT[contexts/storage-context.tsx]
        USEPROV[hooks/use-storage-provider.tsx]
    end

    subgraph "Layer 3: Library System"
        LTYPES[types/library.ts]
        LATOMS[atoms/library-atom.ts]
        LSERVICE[lib/services/library-service.ts]
        LIBCOMP[components/library/library.tsx]
    end

    subgraph "Layer 4: Chat System"
        CTYPES[types/chat.ts]
        CCONST[lib/chat/constants.ts]
        CORCH[lib/chat/orchestrator.ts]
        CLOADER[lib/chat/loader.ts]
        CSTREAM[app/api/chat/.../stream/route.ts]
    end

    subgraph "Layer 5: API Routes &amp; Components"
        APIROUTES[app/api/**/*.ts]
        COMPONENTS[components/**/*.tsx]
    end

    %% Core Infrastructure (no dependencies)

    %% Storage Layer dependencies
    SFACTORY --&gt; STYPES
    SFACTORY --&gt; FSPROVIDER
    SFACTORY --&gt; ODPROVIDER
    FSPROVIDER --&gt; STYPES
    ODPROVIDER --&gt; STYPES
    ODPROVIDER --&gt; LTYPES
    SERVERPROV --&gt; SFACTORY
    SERVERPROV --&gt; LSERVICE
    SERVERPROV --&gt; ENV
    SCONTEXT --&gt; SFACTORY
    SCONTEXT --&gt; LATOMS
    USEPROV --&gt; LATOMS
    USEPROV --&gt; SFACTORY

    %% Library System dependencies
    LATOMS --&gt; LTYPES
    LATOMS --&gt; STYPES
    LSERVICE --&gt; DB
    LSERVICE --&gt; LTYPES
    LIBCOMP --&gt; SCONTEXT
    LIBCOMP --&gt; LATOMS

    %% Chat System dependencies
    CORCH --&gt; CLOADER
    CORCH --&gt; CCONST
    CORCH --&gt; CTYPES
    CLOADER --&gt; LSERVICE
    CLOADER --&gt; DB
    CSTREAM --&gt; CORCH
    CSTREAM --&gt; CLOADER
    CSTREAM --&gt; CCONST

    %% API Routes dependencies
    APIROUTES --&gt; LSERVICE
    APIROUTES --&gt; SFACTORY
    APIROUTES --&gt; DB
    APIROUTES --&gt; CORCH

    %% Components dependencies
    COMPONENTS --&gt; SCONTEXT
    COMPONENTS --&gt; LATOMS
    COMPONENTS --&gt; LIBCOMP</code></pre>
<h2 id="architecture-dependency-graph-dependency-layers">Dependency Layers<a class="headerlink" href="#architecture-dependency-graph-dependency-layers" title="Permanent link">&para;</a></h2>
<h3 id="architecture-dependency-graph-layer-1-core-infrastructure">Layer 1: Core Infrastructure<a class="headerlink" href="#architecture-dependency-graph-layer-1-core-infrastructure" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>No internal dependencies</strong></li>
<li>Provides foundational services (auth, database, env)</li>
<li>Used by all other layers</li>
</ul>
<h3 id="architecture-dependency-graph-layer-2-storage-layer">Layer 2: Storage Layer<a class="headerlink" href="#architecture-dependency-graph-layer-2-storage-layer" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Depends on</strong>: Layer 1 (env, auth, db)</li>
<li><strong>Provides</strong>: Storage abstraction</li>
<li><strong>Used by</strong>: Layer 3 (Library System), Layer 5 (API Routes)</li>
</ul>
<h3 id="architecture-dependency-graph-layer-3-library-system">Layer 3: Library System<a class="headerlink" href="#architecture-dependency-graph-layer-3-library-system" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Depends on</strong>: Layer 2 (Storage Layer)</li>
<li><strong>Provides</strong>: Library management and UI</li>
<li><strong>Used by</strong>: Layer 4 (Chat System), Layer 5 (Components)</li>
</ul>
<h3 id="architecture-dependency-graph-layer-4-chat-system">Layer 4: Chat System<a class="headerlink" href="#architecture-dependency-graph-layer-4-chat-system" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Depends on</strong>: Layer 3 (Library System), Layer 2 (Storage)</li>
<li><strong>Provides</strong>: RAG-based chat functionality</li>
<li><strong>Used by</strong>: Layer 5 (API Routes, Components)</li>
</ul>
<h3 id="architecture-dependency-graph-layer-5-api-routes-components">Layer 5: API Routes &amp; Components<a class="headerlink" href="#architecture-dependency-graph-layer-5-api-routes-components" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Depends on</strong>: All previous layers</li>
<li><strong>Provides</strong>: User-facing interfaces</li>
<li><strong>No dependencies from other modules</strong></li>
</ul>
<h2 id="architecture-dependency-graph-key-dependencies">Key Dependencies<a class="headerlink" href="#architecture-dependency-graph-key-dependencies" title="Permanent link">&para;</a></h2>
<h3 id="architecture-dependency-graph-most-imported-modules">Most Imported Modules<a class="headerlink" href="#architecture-dependency-graph-most-imported-modules" title="Permanent link">&para;</a></h3>
<ol>
<li><code>@/lib/storage/storage-factory.ts</code> - Used by contexts, API routes, components</li>
<li><code>@/lib/storage/types.ts</code> - Used by all storage-related files</li>
<li><code>@/lib/services/library-service.ts</code> - Used by API routes, storage, chat</li>
<li><code>@/types/library.ts</code> - Used throughout the application</li>
<li><code>@/lib/mongodb-service.ts</code> - Used by services and repositories</li>
</ol>
<h3 id="architecture-dependency-graph-critical-paths">Critical Paths<a class="headerlink" href="#architecture-dependency-graph-critical-paths" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Storage Access</strong>: <code>components</code> → <code>contexts/storage-context</code> → <code>storage-factory</code> → <code>providers</code></li>
<li><strong>Chat Flow</strong>: <code>api/chat/stream</code> → <code>chat/orchestrator</code> → <code>chat/loader</code> → <code>library-service</code> → <code>mongodb-service</code></li>
<li><strong>Library Management</strong>: <code>components/library</code> → <code>atoms/library-atom</code> → <code>services/library-service</code> → <code>mongodb-service</code></li>
</ul>
<h2 id="architecture-dependency-graph-circular-dependencies">Circular Dependencies<a class="headerlink" href="#architecture-dependency-graph-circular-dependencies" title="Permanent link">&para;</a></h2>
<h3 id="architecture-dependency-graph-potential-issues-to-verify">Potential Issues (To Verify)<a class="headerlink" href="#architecture-dependency-graph-potential-issues-to-verify" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Storage Factory ↔ Providers</strong>: Factory creates providers, providers may reference factory</li>
<li><strong>Library Service ↔ Storage Factory</strong>: Service uses storage, storage may reference library types</li>
<li><strong>Chat Orchestrator ↔ Chat Loader</strong>: Orchestrator uses loader, loader may use orchestrator utilities</li>
</ol>
<h2 id="architecture-dependency-graph-notes">Notes<a class="headerlink" href="#architecture-dependency-graph-notes" title="Permanent link">&para;</a></h2>
<ul>
<li>Dependencies flow downward (Layer 1 → Layer 5)</li>
<li>Each layer can only depend on layers below it</li>
<li>Type definitions (types/) have no runtime dependencies</li>
<li>Components depend on hooks, contexts, and library code</li>
<li>API routes depend on services, storage, and chat systems</li>
</ul></section><section class="print-page" id="architecture-shadow-twin" heading-number="3.3"><h1 id="architecture-shadow-twin-shadow-twin-architecture">Shadow-Twin Architecture<a class="headerlink" href="#architecture-shadow-twin-shadow-twin-architecture" title="Permanent link">&para;</a></h1>
<h2 id="architecture-shadow-twin-concept">Concept<a class="headerlink" href="#architecture-shadow-twin-concept" title="Permanent link">&para;</a></h2>
<p>A <strong>Shadow-Twin</strong> is a transformed representation of an original document (PDF, audio, video, image, text) stored alongside the original. It contains:</p>
<ul>
<li><strong>Markdown files</strong>: Extracted text, structured content, and metadata</li>
<li><strong>Images</strong>: Extracted images from PDFs or OCR results</li>
<li><strong>Media files</strong>: Audio/video transcripts</li>
</ul>
<p>Shadow-Twins enable:
- Searchable text content
- Structured metadata
- RAG (Retrieval Augmented Generation) integration
- Media-independent processing pipeline</p>
<h2 id="architecture-shadow-twin-structure">Structure<a class="headerlink" href="#architecture-shadow-twin-structure" title="Permanent link">&para;</a></h2>
<p>Shadow-Twins can exist in two forms:</p>
<h3 id="architecture-shadow-twin-1-shadow-twin-directory-when-imagesmedia-are-present">1. Shadow-Twin Directory (when images/media are present)<a class="headerlink" href="#architecture-shadow-twin-1-shadow-twin-directory-when-imagesmedia-are-present" title="Permanent link">&para;</a></h3>
<p>A hidden directory (starts with <code>.</code>) containing all related files:</p>
<div class="highlight"><pre><span></span><code>.document.pdf/
├── document.md          (Transcript - Phase 1 output)
├── document.de.md       (Transformed - Phase 2 output)
├── page-001.png        (Extracted images)
├── page-002.png
└── ...
</code></pre></div>
<p><strong>When created</strong>: Automatically when images are extracted (<code>includeOcrImages</code> or <code>includePageImages</code> enabled)</p>
<p><strong>Directory naming</strong>: <code>.{originalName}</code> (e.g., <code>.document.pdf/</code>)
- Maximum length: 255 characters (truncated if necessary)
- Hidden from normal directory listings (starts with <code>.</code>)</p>
<h3 id="architecture-shadow-twin-2-shadow-twin-files-when-no-imagesmedia">2. Shadow-Twin Files (when no images/media)<a class="headerlink" href="#architecture-shadow-twin-2-shadow-twin-files-when-no-imagesmedia" title="Permanent link">&para;</a></h3>
<p>Files stored directly next to the original:</p>
<div class="highlight"><pre><span></span><code>document.pdf
document.md          (Transcript - Phase 1 output)
document.de.md       (Transformed - Phase 2 output)
</code></pre></div>
<h2 id="architecture-shadow-twin-naming-conventions">Naming Conventions<a class="headerlink" href="#architecture-shadow-twin-naming-conventions" title="Permanent link">&para;</a></h2>
<h3 id="architecture-shadow-twin-transcript-file">Transcript File<a class="headerlink" href="#architecture-shadow-twin-transcript-file" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Format</strong>: <code>{originalName}.md</code></li>
<li><strong>Example</strong>: <code>document.md</code></li>
<li><strong>Created</strong>: After Phase 1 (Extract)</li>
<li><strong>Content</strong>: Extracted text without frontmatter</li>
<li><strong>Language</strong>: <strong>No language suffix</strong> (original language of source)</li>
</ul>
<h3 id="architecture-shadow-twin-transformed-file">Transformed File<a class="headerlink" href="#architecture-shadow-twin-transformed-file" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Format</strong>: <code>{originalName}.{language}.md</code></li>
<li><strong>Example</strong>: <code>document.de.md</code></li>
<li><strong>Created</strong>: After Phase 2 (Template)</li>
<li><strong>Content</strong>: Text with frontmatter and metadata</li>
<li><strong>Language</strong>: <strong>With language suffix</strong> (target language for transformation)</li>
</ul>
<h3 id="architecture-shadow-twin-shadow-twin-directory">Shadow-Twin Directory<a class="headerlink" href="#architecture-shadow-twin-shadow-twin-directory" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Format</strong>: <code>.{originalName}</code></li>
<li><strong>Example</strong>: <code>.document.pdf/</code></li>
<li><strong>Created</strong>: When images are extracted</li>
<li><strong>Length limit</strong>: 255 characters (truncated if necessary)</li>
</ul>
<h2 id="architecture-shadow-twin-state-management">State Management<a class="headerlink" href="#architecture-shadow-twin-state-management" title="Permanent link">&para;</a></h2>
<h3 id="architecture-shadow-twin-job-document-primary-source">Job Document (Primary Source)<a class="headerlink" href="#architecture-shadow-twin-job-document-primary-source" title="Permanent link">&para;</a></h3>
<p>Shadow-Twin state is calculated at job start and stored in MongoDB:</p>
<div class="highlight"><pre><span></span><code><span class="kd">interface</span><span class="w"> </span><span class="nx">ExternalJob</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">shadowTwinState</span><span class="o">?:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">baseItem</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w"> </span><span class="nx">metadata</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="nx">transformed</span><span class="o">?:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w"> </span><span class="nx">metadata</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="nx">transcriptFiles?</span><span class="o">:</span><span class="w"> </span><span class="kt">Array</span><span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w"> </span><span class="nx">metadata</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">shadowTwinFolderId?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">    </span><span class="nx">mediaFiles?</span><span class="o">:</span><span class="w"> </span><span class="kt">Array</span><span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w"> </span><span class="nx">metadata</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">analysisTimestamp</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">    </span><span class="nx">analysisError?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Benefits</strong>:
- Single source of truth
- Available to all workers (parallel processing)
- Persistent across sessions</p>
<h3 id="architecture-shadow-twin-frontend-atom-ui-display">Frontend Atom (UI Display)<a class="headerlink" href="#architecture-shadow-twin-frontend-atom-ui-display" title="Permanent link">&para;</a></h3>
<p>Frontend uses Jotai atom for UI state:</p>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">shadowTwinStateAtom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">atom</span><span class="o">&lt;</span><span class="nb">Map</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">FrontendShadowTwinState</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">());</span>
</code></pre></div>
<p><strong>Purpose</strong>: UI display only (not primary source)
<strong>Updates</strong>: From job documents or local analysis</p>
<h2 id="architecture-shadow-twin-analysis-logic">Analysis Logic<a class="headerlink" href="#architecture-shadow-twin-analysis-logic" title="Permanent link">&para;</a></h2>
<p>Shadow-Twin analysis is performed by <code>analyzeShadowTwin()</code>:</p>
<ol>
<li><strong>Load base item</strong> (original file)</li>
<li><strong>Check for Shadow-Twin directory</strong>:</li>
<li>Search for <code>.document.pdf/</code> directory</li>
<li>If found: Load contents</li>
<li><strong>Check for Shadow-Twin files</strong>:</li>
<li>Search for <code>document.md</code> (transcript)</li>
<li>Search for <code>document.de.md</code> (transformed)</li>
<li><strong>Classify files</strong>:</li>
<li>Files without language suffix → <code>transcriptFiles</code></li>
<li>Files with language suffix → <code>transformed</code> (after frontmatter check)</li>
<li><strong>Return ShadowTwinState</strong></li>
</ol>
<h2 id="architecture-shadow-twin-file-types-in-shadow-twin">File Types in Shadow-Twin<a class="headerlink" href="#architecture-shadow-twin-file-types-in-shadow-twin" title="Permanent link">&para;</a></h2>
<h3 id="architecture-shadow-twin-transcriptfiles"><code>transcriptFiles</code><a class="headerlink" href="#architecture-shadow-twin-transcriptfiles" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Type</strong>: <code>StorageItem[]</code></li>
<li><strong>Content</strong>: Markdown without frontmatter</li>
<li><strong>Naming</strong>: <code>{originalName}.md</code> (no language suffix)</li>
<li><strong>Created</strong>: Phase 1 (Extract)</li>
<li><strong>Purpose</strong>: Raw extracted text (original language)</li>
</ul>
<h3 id="architecture-shadow-twin-transformed"><code>transformed</code><a class="headerlink" href="#architecture-shadow-twin-transformed" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Type</strong>: <code>StorageItem</code></li>
<li><strong>Content</strong>: Markdown with frontmatter</li>
<li><strong>Naming</strong>: <code>{originalName}.{language}.md</code> (with language suffix)</li>
<li><strong>Created</strong>: Phase 2 (Template)</li>
<li><strong>Purpose</strong>: Structured document with metadata</li>
</ul>
<h3 id="architecture-shadow-twin-shadowtwinfolderid"><code>shadowTwinFolderId</code><a class="headerlink" href="#architecture-shadow-twin-shadowtwinfolderid" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Type</strong>: <code>string | undefined</code></li>
<li><strong>Content</strong>: ID of Shadow-Twin directory</li>
<li><strong>Created</strong>: When images are extracted</li>
<li><strong>Purpose</strong>: Container for all Shadow-Twin files</li>
</ul>
<h3 id="architecture-shadow-twin-mediafiles"><code>mediaFiles</code><a class="headerlink" href="#architecture-shadow-twin-mediafiles" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Type</strong>: <code>StorageItem[]</code></li>
<li><strong>Content</strong>: Audio/video files</li>
<li><strong>Purpose</strong>: Original media files (for audio/video transformations)</li>
</ul>
<h2 id="architecture-shadow-twin-code-references">Code References<a class="headerlink" href="#architecture-shadow-twin-code-references" title="Permanent link">&para;</a></h2>
<h3 id="architecture-shadow-twin-core-functions">Core Functions<a class="headerlink" href="#architecture-shadow-twin-core-functions" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>src/lib/storage/shadow-twin.ts</code></strong>:</li>
<li><code>generateShadowTwinName()</code>: Generate file names (with/without language suffix)</li>
<li><code>generateShadowTwinFolderName()</code>: Generate directory names</li>
<li><code>findShadowTwinFolder()</code>: Find Shadow-Twin directory</li>
<li>
<p><code>findShadowTwinMarkdown()</code>: Find Markdown files (both variants)</p>
</li>
<li>
<p><strong><code>src/lib/shadow-twin/analyze-shadow-twin.ts</code></strong>:</p>
</li>
<li>
<p><code>analyzeShadowTwin()</code>: Analyze file and find all Shadow-Twin components</p>
</li>
<li>
<p><strong><code>src/lib/shadow-twin/shared.ts</code></strong>:</p>
</li>
<li><code>ShadowTwinState</code>: Shared type definition</li>
<li><code>toMongoShadowTwinState()</code>: Convert to MongoDB-compatible format</li>
</ul>
<h3 id="architecture-shadow-twin-state-management_1">State Management<a class="headerlink" href="#architecture-shadow-twin-state-management_1" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>src/atoms/shadow-twin-atom.ts</code></strong>:</li>
<li><code>shadowTwinStateAtom</code>: Frontend state atom</li>
<li>
<p><code>FrontendShadowTwinState</code>: Frontend type (with full StorageItem objects)</p>
</li>
<li>
<p><strong><code>src/hooks/use-shadow-twin-analysis.ts</code></strong>:</p>
</li>
<li><code>useShadowTwinAnalysis()</code>: React hook for automatic analysis</li>
</ul>
<h3 id="architecture-shadow-twin-processing">Processing<a class="headerlink" href="#architecture-shadow-twin-processing" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>src/lib/external-jobs/extract-only.ts</code></strong>:</li>
<li>
<p>Extract phase: Creates transcript file (<code>document.md</code>)</p>
</li>
<li>
<p><strong><code>src/lib/external-jobs/storage.ts</code></strong>:</p>
</li>
<li>
<p><code>saveMarkdown()</code>: Saves Markdown files (transcript or transformed)</p>
</li>
<li>
<p><strong><code>src/lib/processing/gates.ts</code></strong>:</p>
</li>
<li><code>gateExtractPdf()</code>: Checks if extraction should be skipped</li>
<li><code>gateTransformTemplate()</code>: Checks if template phase should be skipped</li>
</ul>
<h2 id="architecture-shadow-twin-usage-examples">Usage Examples<a class="headerlink" href="#architecture-shadow-twin-usage-examples" title="Permanent link">&para;</a></h2>
<h3 id="architecture-shadow-twin-finding-a-shadow-twin">Finding a Shadow-Twin<a class="headerlink" href="#architecture-shadow-twin-finding-a-shadow-twin" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">findShadowTwinFolder</span><span class="p">,</span><span class="w"> </span><span class="nx">findShadowTwinMarkdown</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/lib/storage/shadow-twin&#39;</span><span class="p">;</span>

<span class="c1">// Find directory</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">folder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">findShadowTwinFolder</span><span class="p">(</span><span class="nx">parentId</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;document.pdf&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">provider</span><span class="p">);</span>

<span class="c1">// Find Markdown (prefers transformed, falls back to transcript)</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">markdown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">findShadowTwinMarkdown</span><span class="p">(</span><span class="nx">folder</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;document&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;de&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">provider</span><span class="p">);</span>
</code></pre></div>
<h3 id="architecture-shadow-twin-creating-or-finding-shadow-twin-folder">Creating or Finding Shadow-Twin Folder<a class="headerlink" href="#architecture-shadow-twin-creating-or-finding-shadow-twin-folder" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">findOrCreateShadowTwinFolder</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/lib/external-jobs/shadow-twin-helpers&#39;</span><span class="p">;</span>

<span class="c1">// Find existing folder or create new one</span>
<span class="c1">// Returns folder ID (string) or undefined if failed</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">folderId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">findOrCreateShadowTwinFolder</span><span class="p">(</span>
<span class="w">  </span><span class="nx">provider</span><span class="p">,</span>
<span class="w">  </span><span class="nx">parentId</span><span class="p">,</span>
<span class="w">  </span><span class="s1">&#39;document&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">// original name without extension</span>
<span class="w">  </span><span class="nx">jobId</span>
<span class="p">);</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">folderId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Use folderId to save files in Shadow-Twin directory</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">provider</span><span class="p">.</span><span class="nx">saveFile</span><span class="p">(</span><span class="nx">folderId</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;document.md&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">content</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="architecture-shadow-twin-analyzing-shadow-twin-state">Analyzing Shadow-Twin State<a class="headerlink" href="#architecture-shadow-twin-analyzing-shadow-twin-state" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">analyzeShadowTwin</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/lib/shadow-twin/analyze-shadow-twin&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">analyzeShadowTwin</span><span class="p">(</span><span class="nx">fileId</span><span class="p">,</span><span class="w"> </span><span class="nx">provider</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Transcript:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">transcriptFiles</span><span class="p">);</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Transformed:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">transformed</span><span class="p">);</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Folder:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">shadowTwinFolderId</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="architecture-shadow-twin-best-practices">Best Practices<a class="headerlink" href="#architecture-shadow-twin-best-practices" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>Always use job document state</strong> as primary source (not frontend atom)</li>
<li><strong>Check both file variants</strong> when searching (transcript and transformed)</li>
<li><strong>Respect naming conventions</strong> (transcript without language, transformed with language)</li>
<li><strong>Handle directory length limits</strong> (255 characters)</li>
<li><strong>Use analysis function</strong> instead of manual file searching</li>
</ol></section><section class="print-page" id="architecture-pdf-transformation-phases" heading-number="3.4"><h1 id="architecture-pdf-transformation-phases-pdf-transformation-phases">PDF Transformation Phases<a class="headerlink" href="#architecture-pdf-transformation-phases-pdf-transformation-phases" title="Permanent link">&para;</a></h1>
<h2 id="architecture-pdf-transformation-phases-overview">Overview<a class="headerlink" href="#architecture-pdf-transformation-phases-overview" title="Permanent link">&para;</a></h2>
<p>PDF transformation consists of three sequential phases that convert a PDF file into a searchable, structured document ready for RAG (Retrieval Augmented Generation). Each phase builds upon the previous one, creating intermediate artifacts that can be reused or skipped based on policies.</p>
<h2 id="architecture-pdf-transformation-phases-phase-1-extract-extraction">Phase 1: Extract (Extraction)<a class="headerlink" href="#architecture-pdf-transformation-phases-phase-1-extract-extraction" title="Permanent link">&para;</a></h2>
<h3 id="architecture-pdf-transformation-phases-purpose">Purpose<a class="headerlink" href="#architecture-pdf-transformation-phases-purpose" title="Permanent link">&para;</a></h3>
<p>Extract text and images from PDF files using OCR or native text extraction.</p>
<h3 id="architecture-pdf-transformation-phases-what-happens">What Happens<a class="headerlink" href="#architecture-pdf-transformation-phases-what-happens" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>PDF Processing</strong>:</li>
<li>PDF file is sent to Secretary Service</li>
<li>Text extraction via native PDF parsing or OCR (Mistral OCR)</li>
<li>
<p>Image extraction (if enabled)</p>
</li>
<li>
<p><strong>Image Processing</strong>:</p>
</li>
<li>Mistral OCR images: Extracted as Base64 from <code>mistral_ocr_raw.pages[*].images[*].image_base64</code></li>
<li>PDF page images: Extracted as ZIP archive (<code>pages_archive_url</code> or <code>pages_archive_data</code>)</li>
<li>
<p>Images saved to Shadow-Twin directory (if present)</p>
</li>
<li>
<p><strong>Markdown Creation</strong>:</p>
</li>
<li>Extracted text saved as Markdown <strong>without frontmatter</strong></li>
<li>File name: <code>{originalName}.md</code> (no language suffix - transcript)</li>
</ol>
<h3 id="architecture-pdf-transformation-phases-input">Input<a class="headerlink" href="#architecture-pdf-transformation-phases-input" title="Permanent link">&para;</a></h3>
<ul>
<li>PDF file (<code>document.pdf</code>)</li>
<li>Extraction method (<code>native</code> or <code>mistral_ocr</code>)</li>
<li>Target language (for OCR)</li>
<li>Image extraction flags (<code>includeOcrImages</code>, <code>includePageImages</code>)</li>
</ul>
<h3 id="architecture-pdf-transformation-phases-output">Output<a class="headerlink" href="#architecture-pdf-transformation-phases-output" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Transcript File</strong>: <code>document.md</code> (Markdown without frontmatter)</li>
<li><strong>Images</strong>: Saved to <code>.document.pdf/</code> directory (if images extracted)</li>
<li><strong>Shadow-Twin Directory</strong>: Created automatically if images are present</li>
</ul>
<h3 id="architecture-pdf-transformation-phases-code-references">Code References<a class="headerlink" href="#architecture-pdf-transformation-phases-code-references" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>src/lib/external-jobs/extract-only.ts</code></strong>: Extract-only processing logic</li>
<li><strong><code>src/lib/external-jobs/images.ts</code></strong>: Image extraction and processing</li>
<li><strong><code>src/lib/transform/image-extraction-service.ts</code></strong>: Image extraction service</li>
</ul>
<h3 id="architecture-pdf-transformation-phases-example-output">Example Output<a class="headerlink" href="#architecture-pdf-transformation-phases-example-output" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>.document.pdf/
├── document.md          (Transcript - extracted text, no frontmatter)
├── page-001.png        (Extracted images)
└── page-002.png
</code></pre></div>
<h2 id="architecture-pdf-transformation-phases-phase-2-template-metadata">Phase 2: Template (Metadata)<a class="headerlink" href="#architecture-pdf-transformation-phases-phase-2-template-metadata" title="Permanent link">&para;</a></h2>
<h3 id="architecture-pdf-transformation-phases-purpose_1">Purpose<a class="headerlink" href="#architecture-pdf-transformation-phases-purpose_1" title="Permanent link">&para;</a></h3>
<p>Add structured metadata (frontmatter) to the extracted text, enabling structured queries and RAG integration.</p>
<h3 id="architecture-pdf-transformation-phases-what-happens_1">What Happens<a class="headerlink" href="#architecture-pdf-transformation-phases-what-happens_1" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Template Processing</strong>:</li>
<li>Transcript Markdown (<code>document.md</code>) is sent to Secretary Service template transformer</li>
<li>LLM analyzes content and extracts structured metadata</li>
<li>
<p>Frontmatter is generated with chapters, pages, topics, etc.</p>
</li>
<li>
<p><strong>Markdown Creation</strong>:</p>
</li>
<li>Transcript content + frontmatter = transformed Markdown</li>
<li>File name: <code>{originalName}.{language}.md</code> (with language suffix - transformed)</li>
</ol>
<h3 id="architecture-pdf-transformation-phases-input_1">Input<a class="headerlink" href="#architecture-pdf-transformation-phases-input_1" title="Permanent link">&para;</a></h3>
<ul>
<li>Transcript Markdown (<code>document.md</code>)</li>
<li>Template content (structured schema)</li>
<li>Target language</li>
</ul>
<h3 id="architecture-pdf-transformation-phases-output_1">Output<a class="headerlink" href="#architecture-pdf-transformation-phases-output_1" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Transformed File</strong>: <code>document.de.md</code> (Markdown with frontmatter)</li>
<li><strong>Metadata</strong>: Structured data in YAML frontmatter</li>
</ul>
<h3 id="architecture-pdf-transformation-phases-code-references_1">Code References<a class="headerlink" href="#architecture-pdf-transformation-phases-code-references_1" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>src/lib/external-jobs/template-run.ts</code></strong>: Template transformation execution</li>
<li><strong><code>src/lib/external-jobs/template-decision.ts</code></strong>: Decision logic for template phase</li>
<li><strong><code>src/lib/processing/gates.ts</code></strong>: Gate checking (skip if frontmatter exists)</li>
</ul>
<h3 id="architecture-pdf-transformation-phases-example-output_1">Example Output<a class="headerlink" href="#architecture-pdf-transformation-phases-example-output_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>---
title: &quot;Document Title&quot;
pages: 42
chapters:
<span class="w">  </span><span class="k">-</span><span class="w"> </span>title: &quot;Chapter 1&quot;
    page: 1
<span class="w">  </span><span class="k">-</span><span class="w"> </span>title: &quot;Chapter 2&quot;
<span class="gu">    page: 15</span>
<span class="gu">---</span>
<span class="gh"># Document Title</span>

[Extracted content...]
</code></pre></div>
<h3 id="architecture-pdf-transformation-phases-skip-conditions">Skip Conditions<a class="headerlink" href="#architecture-pdf-transformation-phases-skip-conditions" title="Permanent link">&para;</a></h3>
<ul>
<li>Frontmatter already exists and is complete</li>
<li>Template phase disabled via policy</li>
<li>Previous job already completed template phase</li>
</ul>
<h2 id="architecture-pdf-transformation-phases-phase-3-ingestion-rag">Phase 3: Ingestion (RAG)<a class="headerlink" href="#architecture-pdf-transformation-phases-phase-3-ingestion-rag" title="Permanent link">&para;</a></h2>
<h3 id="architecture-pdf-transformation-phases-purpose_2">Purpose<a class="headerlink" href="#architecture-pdf-transformation-phases-purpose_2" title="Permanent link">&para;</a></h3>
<p>Ingest transformed Markdown into vector database (Pinecone) and MongoDB for RAG queries.</p>
<h3 id="architecture-pdf-transformation-phases-what-happens_2">What Happens<a class="headerlink" href="#architecture-pdf-transformation-phases-what-happens_2" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Markdown Processing</strong>:</li>
<li>Transformed Markdown (<code>document.de.md</code>) is parsed</li>
<li>Chapters are detected and structured</li>
<li>
<p>Text is chunked for vector storage</p>
</li>
<li>
<p><strong>Vector Storage</strong>:</p>
</li>
<li>Chunks are embedded and stored in Pinecone</li>
<li>
<p>Metadata filters enable chapter-level retrieval</p>
</li>
<li>
<p><strong>MongoDB Storage</strong>:</p>
</li>
<li>Document metadata stored in MongoDB</li>
<li>
<p>Chapter summaries stored for fast retrieval</p>
</li>
<li>
<p><strong>Image Upload</strong>:</p>
</li>
<li>Images from Shadow-Twin directory uploaded to Azure Storage</li>
<li>URLs stored in metadata for frontend access</li>
</ol>
<h3 id="architecture-pdf-transformation-phases-input_2">Input<a class="headerlink" href="#architecture-pdf-transformation-phases-input_2" title="Permanent link">&para;</a></h3>
<ul>
<li>Transformed Markdown (<code>document.de.md</code>)</li>
<li>Images from Shadow-Twin directory</li>
<li>Library configuration</li>
</ul>
<h3 id="architecture-pdf-transformation-phases-output_2">Output<a class="headerlink" href="#architecture-pdf-transformation-phases-output_2" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Vector embeddings</strong>: Stored in Pinecone</li>
<li><strong>Document metadata</strong>: Stored in MongoDB</li>
<li><strong>Image URLs</strong>: Azure Storage URLs in metadata</li>
</ul>
<h3 id="architecture-pdf-transformation-phases-code-references_2">Code References<a class="headerlink" href="#architecture-pdf-transformation-phases-code-references_2" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>src/lib/external-jobs/ingest.ts</code></strong>: RAG ingestion pipeline</li>
<li><strong><code>src/lib/chat/ingestion-service.ts</code></strong>: Ingestion service</li>
<li><strong><code>src/lib/repositories/doc-meta-repo.ts</code></strong>: MongoDB document metadata repository</li>
</ul>
<h3 id="architecture-pdf-transformation-phases-skip-conditions_1">Skip Conditions<a class="headerlink" href="#architecture-pdf-transformation-phases-skip-conditions_1" title="Permanent link">&para;</a></h3>
<ul>
<li>Document already ingested (check via <code>ingestionCheck</code>)</li>
<li>Ingestion phase disabled via policy</li>
</ul>
<h2 id="architecture-pdf-transformation-phases-phase-control">Phase Control<a class="headerlink" href="#architecture-pdf-transformation-phases-phase-control" title="Permanent link">&para;</a></h2>
<h3 id="architecture-pdf-transformation-phases-policies">Policies<a class="headerlink" href="#architecture-pdf-transformation-phases-policies" title="Permanent link">&para;</a></h3>
<p>Phases can be controlled via policies:</p>
<div class="highlight"><pre><span></span><code><span class="kd">interface</span><span class="w"> </span><span class="nx">PhasePolicies</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">extract</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;force&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;skip&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;auto&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;ignore&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="nx">metadata</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;force&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;skip&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;auto&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;ignore&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="nx">ingest</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;force&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;skip&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;auto&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;ignore&#39;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><strong><code>force</code></strong>: Always execute phase (even if artifacts exist)</li>
<li><strong><code>skip</code></strong>: Skip phase (even if artifacts don't exist)</li>
<li><strong><code>auto</code></strong>: Execute if needed (check gates)</li>
<li><strong><code>ignore</code></strong>: Phase disabled</li>
</ul>
<h3 id="architecture-pdf-transformation-phases-gates">Gates<a class="headerlink" href="#architecture-pdf-transformation-phases-gates" title="Permanent link">&para;</a></h3>
<p>Gates check if phases should be skipped:</p>
<ul>
<li><strong><code>gateExtractPdf()</code></strong>: Checks for existing Shadow-Twin files</li>
<li><strong><code>gateTransformTemplate()</code></strong>: Checks for existing frontmatter</li>
<li><strong><code>gateIngestRag()</code></strong>: Checks for existing ingestion</li>
</ul>
<h3 id="architecture-pdf-transformation-phases-execution-flow">Execution Flow<a class="headerlink" href="#architecture-pdf-transformation-phases-execution-flow" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>PDF File
  ↓
[Gate: Extract] → Skip if Shadow-Twin exists
  ↓
Phase 1: Extract → document.md + images
  ↓
[Gate: Template] → Skip if frontmatter exists
  ↓
Phase 2: Template → document.de.md
  ↓
[Gate: Ingestion] → Skip if already ingested
  ↓
Phase 3: Ingestion → Vector storage + MongoDB
  ↓
Complete
</code></pre></div>
<h2 id="architecture-pdf-transformation-phases-file-naming-convention">File Naming Convention<a class="headerlink" href="#architecture-pdf-transformation-phases-file-naming-convention" title="Permanent link">&para;</a></h2>
<h3 id="architecture-pdf-transformation-phases-transcript-file-phase-1">Transcript File (Phase 1)<a class="headerlink" href="#architecture-pdf-transformation-phases-transcript-file-phase-1" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Format</strong>: <code>{originalName}.md</code></li>
<li><strong>Example</strong>: <code>document.md</code></li>
<li><strong>Language</strong>: No suffix (original language)</li>
<li><strong>Content</strong>: Extracted text without frontmatter</li>
</ul>
<h3 id="architecture-pdf-transformation-phases-transformed-file-phase-2">Transformed File (Phase 2)<a class="headerlink" href="#architecture-pdf-transformation-phases-transformed-file-phase-2" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Format</strong>: <code>{originalName}.{language}.md</code></li>
<li><strong>Example</strong>: <code>document.de.md</code></li>
<li><strong>Language</strong>: With suffix (target language)</li>
<li><strong>Content</strong>: Text with frontmatter and metadata</li>
</ul>
<h3 id="architecture-pdf-transformation-phases-why-different-names">Why Different Names?<a class="headerlink" href="#architecture-pdf-transformation-phases-why-different-names" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Transcript</strong>: Original language, no transformation → no language suffix</li>
<li><strong>Transformed</strong>: Translated/structured, target language → language suffix</li>
<li><strong>Coexistence</strong>: Both files can exist simultaneously (no overwrite)</li>
</ul>
<h2 id="architecture-pdf-transformation-phases-error-handling">Error Handling<a class="headerlink" href="#architecture-pdf-transformation-phases-error-handling" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Phase failures</strong>: Logged in job document, job status set to <code>failed</code></li>
<li><strong>Partial completion</strong>: Intermediate artifacts preserved</li>
<li><strong>Retry</strong>: Failed phases can be retried independently</li>
<li><strong>Skip on error</strong>: Subsequent phases can still execute if previous phase failed (depending on policy)</li>
</ul>
<h2 id="architecture-pdf-transformation-phases-performance-considerations">Performance Considerations<a class="headerlink" href="#architecture-pdf-transformation-phases-performance-considerations" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Parallel processing</strong>: Images processed in parallel with text extraction</li>
<li><strong>Caching</strong>: Secretary Service caches OCR results</li>
<li><strong>Batch processing</strong>: Multiple PDFs processed in parallel</li>
<li><strong>Incremental updates</strong>: Only changed phases re-executed</li>
</ul></section></section>
                    <section class='print-page md-section' id='section-4' heading-number='4'>
                        <h1>Guide<a class='headerlink' href='#section-4' title='Permanent link'></a>
                        </h1>
                    </section>
                    <section class='print-page md-section' id='section-5' heading-number='5'>
                        <h1>Use Cases<a class='headerlink' href='#section-5' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="use-cases-index" heading-number="5.1"><h1 id="use-cases-index-use-cases">Use Cases<a class="headerlink" href="#use-cases-index-use-cases" title="Permanent link">&para;</a></h1>
<p>Short guides for common tasks in Common Knowledge Scout.</p>
<h2 id="use-cases-index-basic-use-cases">Basic Use Cases<a class="headerlink" href="#use-cases-index-basic-use-cases" title="Permanent link">&para;</a></h2>
<ul>
<li><strong><a href="#use-cases-library-setup">Library Setup</a></strong> – Create and configure a library</li>
<li><strong><a href="#use-cases-file-transformation-pdf">PDF Transformation</a></strong> – Transform PDF files to Markdown</li>
<li><strong><a href="#use-cases-file-transformation-media">Media Transformation</a></strong> – Transcribe audio and video files</li>
</ul>
<h2 id="use-cases-index-advanced-use-cases">Advanced Use Cases<a class="headerlink" href="#use-cases-index-advanced-use-cases" title="Permanent link">&para;</a></h2>
<ul>
<li><strong><a href="#use-cases-web-scraping">Web Scraping</a></strong> – Scrape web content and import events</li>
<li><strong><a href="#use-cases-publishing">Publishing</a></strong> – Publish library publicly</li>
<li><strong><a href="#use-cases-chat-exploration">Chat &amp; Story Mode</a></strong> – Explore knowledge with chat</li>
</ul>
<h2 id="use-cases-index-advanced-features">Advanced Features<a class="headerlink" href="#use-cases-index-advanced-features" title="Permanent link">&para;</a></h2>
<ul>
<li><strong><a href="#use-cases-batch-operations">Batch Operations</a></strong> – Process multiple files simultaneously</li>
</ul>
<h2 id="use-cases-index-further-information">Further Information<a class="headerlink" href="#use-cases-index-further-information" title="Permanent link">&para;</a></h2>
<p>For detailed technical information see:
- <a href="#architecture">Architecture Documentation</a>
- <a href="#reference">Reference Documentation</a>
- <a href="#concepts">Concepts Documentation</a></p></section><section class="print-page" id="use-cases-library-setup" heading-number="5.2"><h1 id="use-cases-library-setup-library-setup">Library Setup<a class="headerlink" href="#use-cases-library-setup-library-setup" title="Permanent link">&para;</a></h1>
<h2 id="use-cases-library-setup-what-is-achieved">What is achieved?<a class="headerlink" href="#use-cases-library-setup-what-is-achieved" title="Permanent link">&para;</a></h2>
<p>Create a new library to organize your knowledge. Libraries serve as containers for documents, media files, and transformed content.</p>
<h2 id="use-cases-library-setup-prerequisites">Prerequisites<a class="headerlink" href="#use-cases-library-setup-prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>Authenticated user</li>
<li>Access to storage provider (Local Filesystem or OneDrive)</li>
</ul>
<h2 id="use-cases-library-setup-steps">Steps<a class="headerlink" href="#use-cases-library-setup-steps" title="Permanent link">&para;</a></h2>
<ol>
<li>Go to <strong>Settings → Library</strong></li>
<li>Click <strong>"Create New Library"</strong> (if no library exists yet)</li>
<li>Fill out the form:</li>
<li><strong>Name</strong>: Enter a meaningful name (at least 3 characters)</li>
<li><strong>Storage Type</strong>: Choose between "Local" (local filesystem) or "OneDrive"</li>
<li><strong>Storage Path</strong>: Enter the path where files should be stored</li>
<li><strong>Description</strong> (optional): Short description of the library</li>
<li>Configure the transcription strategy:</li>
<li><strong>Shadow Twin</strong>: Transformed files are saved as separate Markdown files</li>
<li><strong>Database</strong>: Transcripts are stored in the database</li>
<li>Click <strong>"Save"</strong></li>
</ol>
<h2 id="use-cases-library-setup-result">Result<a class="headerlink" href="#use-cases-library-setup-result" title="Permanent link">&para;</a></h2>
<p>A new library is created and can be used for files. The library appears in the Library Switcher and can be selected as the active library.</p>
<h2 id="use-cases-library-setup-further-information">Further Information<a class="headerlink" href="#use-cases-library-setup-further-information" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#reference-modules-library">Library Module Documentation</a></li>
<li><a href="#reference-modules-storage">Storage Provider Concepts</a></li>
</ul></section><section class="print-page" id="use-cases-file-transformation-pdf" heading-number="5.3"><h1 id="use-cases-file-transformation-pdf-pdf-transformation">PDF Transformation<a class="headerlink" href="#use-cases-file-transformation-pdf-pdf-transformation" title="Permanent link">&para;</a></h1>
<h2 id="use-cases-file-transformation-pdf-what-is-achieved">What is achieved?<a class="headerlink" href="#use-cases-file-transformation-pdf-what-is-achieved" title="Permanent link">&para;</a></h2>
<p>Transform PDF files into structured Markdown documents. Text, images, and structure are extracted and saved as searchable Markdown files. The transformation process consists of three phases: <strong>Extract</strong>, <strong>Template/Metadata</strong>, and <strong>Ingestion</strong>.</p>
<h2 id="use-cases-file-transformation-pdf-prerequisites">Prerequisites<a class="headerlink" href="#use-cases-file-transformation-pdf-prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>Active library selected</li>
<li>PDF file available in Library Browser</li>
</ul>
<h2 id="use-cases-file-transformation-pdf-steps">Steps<a class="headerlink" href="#use-cases-file-transformation-pdf-steps" title="Permanent link">&para;</a></h2>
<ol>
<li>Open the <strong>Library</strong> view</li>
<li>Navigate to the folder containing the PDF file</li>
<li>Select the PDF file (single file or multiple for batch processing)</li>
<li>Click the <strong>Transformation icon</strong> or use the context menu</li>
<li>In the transformation dialog:</li>
<li>Select the <strong>target language</strong> for transformation</li>
<li>Optional: Choose a <strong>template</strong> for structured output</li>
<li>Optional: Enable <strong>"Extract OCR images"</strong> for Mistral OCR extracted images</li>
<li>Optional: Enable <strong>"Extract page images"</strong> for PDF pages as images</li>
<li>Click <strong>"Start Transformation"</strong></li>
<li>Monitor progress in the dialog (three phases: Extract → Template → Ingestion)</li>
<li>After completion: The transformed Markdown files (Shadow Twins) appear next to the original</li>
</ol>
<h2 id="use-cases-file-transformation-pdf-transformation-phases">Transformation Phases<a class="headerlink" href="#use-cases-file-transformation-pdf-transformation-phases" title="Permanent link">&para;</a></h2>
<h3 id="use-cases-file-transformation-pdf-phase-1-extract-extraction">Phase 1: Extract (Extraction)<a class="headerlink" href="#use-cases-file-transformation-pdf-phase-1-extract-extraction" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>What happens</strong>: PDF → Text + Images extraction</li>
<li><strong>Output</strong>: Markdown file without frontmatter (<code>document.md</code> - Transcript)</li>
<li><strong>Images</strong>: Extracted as ZIP archives or Base64 (Mistral OCR)</li>
<li><strong>Shadow-Twin Directory</strong>: Created automatically if images are present (<code>.document.pdf/</code>)</li>
</ul>
<h3 id="use-cases-file-transformation-pdf-phase-2-templatemetadata">Phase 2: Template/Metadata<a class="headerlink" href="#use-cases-file-transformation-pdf-phase-2-templatemetadata" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>What happens</strong>: Frontmatter added, document structured</li>
<li><strong>Input</strong>: Markdown without frontmatter (<code>document.md</code>)</li>
<li><strong>Output</strong>: Markdown with frontmatter (<code>document.de.md</code> - Transformed)</li>
<li><strong>Note</strong>: This phase can be skipped if frontmatter already exists</li>
</ul>
<h3 id="use-cases-file-transformation-pdf-phase-3-ingestion-rag">Phase 3: Ingestion (RAG)<a class="headerlink" href="#use-cases-file-transformation-pdf-phase-3-ingestion-rag" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>What happens</strong>: Markdown → Vector storage, MongoDB</li>
<li><strong>Images</strong>: Uploaded to Azure Storage for frontend access</li>
<li><strong>Result</strong>: Document is searchable via RAG (Retrieval Augmented Generation)</li>
</ul>
<h2 id="use-cases-file-transformation-pdf-result-structure">Result Structure<a class="headerlink" href="#use-cases-file-transformation-pdf-result-structure" title="Permanent link">&para;</a></h2>
<h3 id="use-cases-file-transformation-pdf-shadow-twin-directory-when-images-are-present">Shadow-Twin Directory (when images are present)<a class="headerlink" href="#use-cases-file-transformation-pdf-shadow-twin-directory-when-images-are-present" title="Permanent link">&para;</a></h3>
<p>If images are extracted, a Shadow-Twin directory is created:
<div class="highlight"><pre><span></span><code>.document.pdf/
├── document.md          (Transcript - Phase 1 output, no frontmatter)
├── document.de.md       (Transformed - Phase 2 output, with frontmatter)
├── page-001.png        (Extracted images)
├── page-002.png
└── ...
</code></pre></div></p>
<h3 id="use-cases-file-transformation-pdf-shadow-twin-files-when-no-images">Shadow-Twin Files (when no images)<a class="headerlink" href="#use-cases-file-transformation-pdf-shadow-twin-files-when-no-images" title="Permanent link">&para;</a></h3>
<p>If no images are extracted, files are saved directly next to the PDF:
<div class="highlight"><pre><span></span><code>document.pdf
document.md          (Transcript - Phase 1 output, no frontmatter)
document.de.md       (Transformed - Phase 2 output, with frontmatter)
</code></pre></div></p>
<h2 id="use-cases-file-transformation-pdf-file-naming-convention">File Naming Convention<a class="headerlink" href="#use-cases-file-transformation-pdf-file-naming-convention" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Transcript File</strong> (<code>document.md</code>): </li>
<li>Created after Phase 1 (Extract)</li>
<li>Contains extracted text without frontmatter</li>
<li>
<p><strong>No language suffix</strong> (original language of source)</p>
</li>
<li>
<p><strong>Transformed File</strong> (<code>document.de.md</code>):</p>
</li>
<li>Created after Phase 2 (Template)</li>
<li>Contains text with frontmatter and metadata</li>
<li><strong>With language suffix</strong> (target language for transformation)</li>
</ul>
<h2 id="use-cases-file-transformation-pdf-parameters">Parameters<a class="headerlink" href="#use-cases-file-transformation-pdf-parameters" title="Permanent link">&para;</a></h2>
<ul>
<li><strong><code>includeOcrImages</code></strong>: Request Mistral OCR images as Base64 (default: <code>true</code> for Mistral OCR)</li>
<li><strong><code>includePageImages</code></strong>: Extract PDF pages as images and return as ZIP archive (default: <code>true</code> for Mistral OCR)</li>
</ul>
<h2 id="use-cases-file-transformation-pdf-tips">Tips<a class="headerlink" href="#use-cases-file-transformation-pdf-tips" title="Permanent link">&para;</a></h2>
<ul>
<li>Shadow Twins are automatically linked with the original</li>
<li>Transformation runs in the background - you can continue working</li>
<li>Errors are displayed in an error message</li>
<li>Both transcript and transformed files can coexist (different names)</li>
<li>Shadow-Twin directory is hidden (starts with <code>.</code>)</li>
</ul>
<h2 id="use-cases-file-transformation-pdf-further-information">Further Information<a class="headerlink" href="#use-cases-file-transformation-pdf-further-information" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#architecture-shadow-twin">Shadow-Twin Architecture Documentation</a></li>
<li><a href="#architecture-pdf-transformation-phases">PDF Transformation Phases</a></li>
<li><a href="#reference-file-index-transform--processing">Transform Service Documentation</a></li>
<li><a href="#use-cases-batch-operations">Batch Operations</a> for multiple files</li>
</ul></section><section class="print-page" id="use-cases-file-transformation-media" heading-number="5.4"><h1 id="use-cases-file-transformation-media-media-transformation-audiovideo">Media Transformation (Audio/Video)<a class="headerlink" href="#use-cases-file-transformation-media-media-transformation-audiovideo" title="Permanent link">&para;</a></h1>
<h2 id="use-cases-file-transformation-media-what-is-achieved">What is achieved?<a class="headerlink" href="#use-cases-file-transformation-media-what-is-achieved" title="Permanent link">&para;</a></h2>
<p>Transcribe audio and video files to text. Extract transcripts with speaker identification and save them as searchable Markdown files.</p>
<h2 id="use-cases-file-transformation-media-prerequisites">Prerequisites<a class="headerlink" href="#use-cases-file-transformation-media-prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>Active library selected</li>
<li>Audio or video file available in Library Browser</li>
</ul>
<h2 id="use-cases-file-transformation-media-steps">Steps<a class="headerlink" href="#use-cases-file-transformation-media-steps" title="Permanent link">&para;</a></h2>
<ol>
<li>Open the <strong>Library</strong> view</li>
<li>Navigate to the folder containing the audio/video file</li>
<li>Select the media file (single file or multiple for batch processing)</li>
<li>Click the <strong>Transcription icon</strong> or use the context menu</li>
<li>In the transcription dialog:</li>
<li>Select the <strong>target language</strong> for transcription</li>
<li>Optional: Choose a <strong>template</strong> for structured output</li>
<li>Click <strong>"Start Transcription"</strong></li>
<li>Monitor progress in the dialog</li>
<li>After completion: The transcript Markdown file appears next to the original</li>
</ol>
<h2 id="use-cases-file-transformation-media-result">Result<a class="headerlink" href="#use-cases-file-transformation-media-result" title="Permanent link">&para;</a></h2>
<p>A new Markdown file named <code>[OriginalName].md</code> is created. It contains the transcribed text, speaker identification (if available), and metadata in frontmatter.</p>
<h2 id="use-cases-file-transformation-media-tips">Tips<a class="headerlink" href="#use-cases-file-transformation-media-tips" title="Permanent link">&para;</a></h2>
<ul>
<li>Transcription runs in the background - you can continue working</li>
<li>For video files, transcripts can be extracted from VTT files if available</li>
<li>Errors are displayed in an error message</li>
<li>Batch processing is supported for multiple files</li>
</ul>
<h2 id="use-cases-file-transformation-media-further-information">Further Information<a class="headerlink" href="#use-cases-file-transformation-media-further-information" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#reference-file-index-transform--processing">Transform Service Documentation</a></li>
<li><a href="#use-cases-batch-operations">Batch Operations</a> for multiple files</li>
</ul></section><section class="print-page" id="use-cases-web-scraping" heading-number="5.5"><h1 id="use-cases-web-scraping-web-scraping-event-import">Web Scraping &amp; Event Import<a class="headerlink" href="#use-cases-web-scraping-web-scraping-event-import" title="Permanent link">&para;</a></h1>
<h2 id="use-cases-web-scraping-what-is-achieved">What is achieved?<a class="headerlink" href="#use-cases-web-scraping-what-is-achieved" title="Permanent link">&para;</a></h2>
<p>Scrape web content and import event data (conferences, workshops, talks) into your library. Extract structured data from web pages, convert them to Markdown format, and organize them by events and tracks.</p>
<h2 id="use-cases-web-scraping-prerequisites">Prerequisites<a class="headerlink" href="#use-cases-web-scraping-prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>Active library selected</li>
<li>Event Monitor access</li>
<li>Event URL or web page with structured content</li>
</ul>
<h2 id="use-cases-web-scraping-steps">Steps<a class="headerlink" href="#use-cases-web-scraping-steps" title="Permanent link">&para;</a></h2>
<ol>
<li>Navigate to <strong>Event Monitor</strong> page</li>
<li>Click <strong>"Create Track"</strong> to start a new batch</li>
<li>Enter event information:</li>
<li><strong>Event Name</strong>: Name of the event/conference</li>
<li><strong>Track Name</strong>: Track or session category</li>
<li><strong>Source URL</strong>: URL of the web page to scrape</li>
<li>Configure scraping options:</li>
<li>Select <strong>target language</strong> for transformation</li>
<li>Choose <strong>template</strong> for structured output (optional)</li>
<li>Start the scraping process</li>
<li>Monitor progress in the Event Monitor:</li>
<li>View job status (pending, running, completed, failed)</li>
<li>Filter by event name</li>
<li>Check individual job details</li>
<li>After completion: Sessions are transformed to Markdown files in your library</li>
</ol>
<h2 id="use-cases-web-scraping-result">Result<a class="headerlink" href="#use-cases-web-scraping-result" title="Permanent link">&para;</a></h2>
<p>Event sessions are imported as structured Markdown files organized by event and track. Each session contains metadata, transcripts (if available), and associated media files.</p>
<h2 id="use-cases-web-scraping-tips">Tips<a class="headerlink" href="#use-cases-web-scraping-tips" title="Permanent link">&para;</a></h2>
<ul>
<li>Use the Event Filter to focus on specific events</li>
<li>Batch operations allow processing multiple tracks simultaneously</li>
<li>Failed jobs can be retried individually</li>
<li>Archive completed batches for organization</li>
</ul>
<h2 id="use-cases-web-scraping-further-information">Further Information<a class="headerlink" href="#use-cases-web-scraping-further-information" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#reference-file-index-event-job-system">Event Job System Documentation</a></li>
<li><a href="#use-cases-batch-operations">Batch Operations</a> for multiple files</li>
</ul></section><section class="print-page" id="use-cases-publishing" heading-number="5.6"><h1 id="use-cases-publishing-publishing-gallery">Publishing &amp; Gallery<a class="headerlink" href="#use-cases-publishing-publishing-gallery" title="Permanent link">&para;</a></h1>
<h2 id="use-cases-publishing-what-is-achieved">What is achieved?<a class="headerlink" href="#use-cases-publishing-what-is-achieved" title="Permanent link">&para;</a></h2>
<p>Publish your library publicly so others can access and explore your knowledge base. Create a public gallery with a custom URL, API access, and configurable display settings.</p>
<h2 id="use-cases-publishing-prerequisites">Prerequisites<a class="headerlink" href="#use-cases-publishing-prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>Active library configured</li>
<li>Library owner permissions</li>
</ul>
<h2 id="use-cases-publishing-steps">Steps<a class="headerlink" href="#use-cases-publishing-steps" title="Permanent link">&para;</a></h2>
<ol>
<li>Go to <strong>Settings → Public</strong></li>
<li>Enable <strong>"Public Library"</strong> toggle</li>
<li>Configure public settings:</li>
<li><strong>Slug Name</strong>: URL-friendly identifier (lowercase, numbers, hyphens only)</li>
<li><strong>Public Name</strong>: Display name for your library</li>
<li><strong>Description</strong>: Public description of your library</li>
<li><strong>Icon</strong>: Choose an icon from common options (optional)</li>
<li>Configure gallery display:</li>
<li><strong>Headline</strong>: Main headline for the gallery page</li>
<li><strong>Subtitle</strong>: Subtitle text</li>
<li><strong>Description</strong>: Gallery description</li>
<li><strong>Filter Description</strong>: Help text for filters</li>
<li>Generate <strong>API Key</strong> (if needed for programmatic access)</li>
<li>Click <strong>"Save"</strong></li>
<li>Your library is now accessible at: <code>/public/[slug-name]</code></li>
</ol>
<h2 id="use-cases-publishing-result">Result<a class="headerlink" href="#use-cases-publishing-result" title="Permanent link">&para;</a></h2>
<p>Your library is publicly accessible. Visitors can browse documents, use the chat interface, and explore your knowledge base without authentication.</p>
<h2 id="use-cases-publishing-tips">Tips<a class="headerlink" href="#use-cases-publishing-tips" title="Permanent link">&para;</a></h2>
<ul>
<li>The slug name must be unique across all public libraries</li>
<li>API keys provide programmatic access to your library</li>
<li>Gallery settings customize the public-facing interface</li>
<li>You can disable public access at any time</li>
</ul>
<h2 id="use-cases-publishing-further-information">Further Information<a class="headerlink" href="#use-cases-publishing-further-information" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#reference-modules-library">Library Module Documentation</a></li>
<li><a href="#reference-file-index-library-system">Public Publishing Settings</a></li>
</ul></section><section class="print-page" id="use-cases-chat-exploration" heading-number="5.7"><h1 id="use-cases-chat-exploration-chat-story-mode">Chat &amp; Story Mode<a class="headerlink" href="#use-cases-chat-exploration-chat-story-mode" title="Permanent link">&para;</a></h1>
<h2 id="use-cases-chat-exploration-what-is-achieved">What is achieved?<a class="headerlink" href="#use-cases-chat-exploration-what-is-achieved" title="Permanent link">&para;</a></h2>
<p>Explore your knowledge base using natural language queries. The Chat interface uses RAG (Retrieval-Augmented Generation) to find relevant content and generate answers based on your library's documents.</p>
<h2 id="use-cases-chat-exploration-prerequisites">Prerequisites<a class="headerlink" href="#use-cases-chat-exploration-prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>Active library selected</li>
<li>Documents transformed and ingested into the library</li>
</ul>
<h2 id="use-cases-chat-exploration-steps">Steps<a class="headerlink" href="#use-cases-chat-exploration-steps" title="Permanent link">&para;</a></h2>
<ol>
<li>Open the <strong>Library</strong> view</li>
<li>Click the <strong>Chat</strong> icon or open the chat panel</li>
<li>Configure chat settings (optional):</li>
<li><strong>Answer Length</strong>: Short, medium, or long answers</li>
<li><strong>Retriever</strong>: Chunk-based or summary-based retrieval</li>
<li><strong>Target Language</strong>: Language for responses</li>
<li><strong>Character</strong>: Perspective for answers (e.g., expert, beginner)</li>
<li><strong>Social Context</strong>: Context for answer generation</li>
<li>Type your question in the chat input</li>
<li>The system will:</li>
<li>Analyze your question</li>
<li>Retrieve relevant documents</li>
<li>Generate an answer based on your library content</li>
<li>Display sources used for the answer</li>
<li>Continue the conversation with follow-up questions</li>
<li>Use <strong>Story Mode</strong> for narrative-style exploration</li>
</ol>
<h2 id="use-cases-chat-exploration-result">Result<a class="headerlink" href="#use-cases-chat-exploration-result" title="Permanent link">&para;</a></h2>
<p>You receive answers based on your library's content with source citations. The chat history is saved for future reference.</p>
<h2 id="use-cases-chat-exploration-tips">Tips<a class="headerlink" href="#use-cases-chat-exploration-tips" title="Permanent link">&para;</a></h2>
<ul>
<li>Use specific questions for better results</li>
<li>Check source citations to verify information</li>
<li>Story Mode provides narrative-style exploration</li>
<li>Chat history is saved automatically</li>
<li>Filter by facets/metadata for focused queries</li>
</ul>
<h2 id="use-cases-chat-exploration-further-information">Further Information<a class="headerlink" href="#use-cases-chat-exploration-further-information" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#reference-modules-chat">Chat System Documentation</a></li>
<li><a href="#reference-file-index-chat-system">Chat Orchestration</a></li>
</ul></section><section class="print-page" id="use-cases-batch-operations" heading-number="5.8"><h1 id="use-cases-batch-operations-batch-operations">Batch Operations<a class="headerlink" href="#use-cases-batch-operations-batch-operations" title="Permanent link">&para;</a></h1>
<h2 id="use-cases-batch-operations-what-is-achieved">What is achieved?<a class="headerlink" href="#use-cases-batch-operations-what-is-achieved" title="Permanent link">&para;</a></h2>
<p>Process multiple files simultaneously for transformation, transcription, or ingestion. Save time by handling multiple operations in parallel.</p>
<h2 id="use-cases-batch-operations-prerequisites">Prerequisites<a class="headerlink" href="#use-cases-batch-operations-prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>Active library selected</li>
<li>Multiple files available in Library Browser</li>
</ul>
<h2 id="use-cases-batch-operations-steps">Steps<a class="headerlink" href="#use-cases-batch-operations-steps" title="Permanent link">&para;</a></h2>
<ol>
<li>Open the <strong>Library</strong> view</li>
<li>Navigate to the folder containing files</li>
<li>Select multiple files:</li>
<li>Use checkboxes to select individual files</li>
<li>Or select all files in a folder</li>
<li>Choose the operation:</li>
<li><strong>Transformation</strong>: Transform PDFs to Markdown</li>
<li><strong>Transcription</strong>: Transcribe audio/video files</li>
<li><strong>Ingestion</strong>: Ingest documents into RAG system</li>
<li>Configure options:</li>
<li>Select <strong>target language</strong></li>
<li>Choose <strong>template</strong> (if applicable)</li>
<li>Set processing options</li>
<li>Click <strong>"Start Batch Processing"</strong></li>
<li>Monitor progress:</li>
<li>View overall progress bar</li>
<li>See individual file status</li>
<li>Check success/failure counts</li>
<li>Review results:</li>
<li>Successful transformations appear as Shadow Twins</li>
<li>Failed files show error messages</li>
<li>Retry failed operations if needed</li>
</ol>
<h2 id="use-cases-batch-operations-result">Result<a class="headerlink" href="#use-cases-batch-operations-result" title="Permanent link">&para;</a></h2>
<p>Multiple files are processed in parallel. Results appear as they complete, with success/failure status for each file.</p>
<h2 id="use-cases-batch-operations-tips">Tips<a class="headerlink" href="#use-cases-batch-operations-tips" title="Permanent link">&para;</a></h2>
<ul>
<li>Batch operations run in the background</li>
<li>You can continue working while processing</li>
<li>Failed files can be retried individually</li>
<li>Progress is saved - you can refresh without losing state</li>
<li>Large batches may take time - be patient</li>
</ul>
<h2 id="use-cases-batch-operations-further-information">Further Information<a class="headerlink" href="#use-cases-batch-operations-further-information" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#reference-file-index-transform--processing">Transform Service Documentation</a></li>
<li><a href="#use-cases-file-transformation-pdf">PDF Transformation</a> for single files</li>
<li><a href="#use-cases-file-transformation-media">Media Transformation</a> for single files</li>
</ul></section></section>
                    <section class='print-page md-section' id='section-6' heading-number='6'>
                        <h1>Concepts<a class='headerlink' href='#section-6' title='Permanent link'></a>
                        </h1>
                    
                    <section class='print-page md-section' id='section-6-7' heading-number='6.7'>
                        <h1>Library<a class='headerlink' href='#section-6-7' title='Permanent link'></a>
                        </h1>
                    </section></section>
                    <section class='print-page md-section' id='section-7' heading-number='7'>
                        <h1>Reference<a class='headerlink' href='#section-7' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="reference-file-index" heading-number="7.1"><h1 id="reference-file-index-file-index">File Index<a class="headerlink" href="#reference-file-index-file-index" title="Permanent link">&para;</a></h1>
<p>Complete index of all documented source files with descriptions, exports, and usage information.</p>
<h2 id="reference-file-index-core-infrastructure">Core Infrastructure ✅<a class="headerlink" href="#reference-file-index-core-infrastructure" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>File Path</th>
<th>Module</th>
<th>Description</th>
<th>Exports</th>
<th>Used In</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>src/middleware.ts</code></td>
<td>core</td>
<td>Authentication and routing middleware</td>
<td><code>default</code>, <code>config</code></td>
<td>Next.js framework, all routes</td>
</tr>
<tr>
<td><code>src/app/layout.tsx</code></td>
<td>core</td>
<td>Root layout component</td>
<td><code>default</code>, <code>metadata</code></td>
<td>Next.js framework, all pages</td>
</tr>
<tr>
<td><code>src/instrumentation.ts</code></td>
<td>core</td>
<td>Next.js instrumentation hook</td>
<td><code>register</code></td>
<td>Next.js framework</td>
</tr>
<tr>
<td><code>src/lib/env.ts</code></td>
<td>core</td>
<td>Environment variable helpers</td>
<td><code>getPublicAppUrl</code>, <code>getSelfBaseUrl</code>, <code>getSecretaryConfig</code>, <code>getVimeoConfig</code></td>
<td>API routes, services</td>
</tr>
<tr>
<td><code>src/lib/auth.ts</code></td>
<td>core</td>
<td>Authentication helpers</td>
<td><code>getLibraryId</code>, <code>isAuthenticated</code>, <code>getUserInfo</code></td>
<td>API routes, components</td>
</tr>
<tr>
<td><code>src/lib/mongodb-service.ts</code></td>
<td>core</td>
<td>MongoDB database service</td>
<td><code>connectToDatabase</code>, <code>getCollection</code></td>
<td>Services, repositories, API routes</td>
</tr>
</tbody>
</table>
<h2 id="reference-file-index-storage-layer">Storage Layer ✅<a class="headerlink" href="#reference-file-index-storage-layer" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>File Path</th>
<th>Module</th>
<th>Description</th>
<th>Exports</th>
<th>Used In</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>src/lib/storage/types.ts</code></td>
<td>storage</td>
<td>Storage type definitions</td>
<td><code>StorageItemMetadata</code>, <code>StorageItem</code>, <code>StorageValidationResult</code>, <code>StorageProvider</code></td>
<td>All storage files</td>
</tr>
<tr>
<td><code>src/lib/storage/storage-factory.ts</code></td>
<td>storage</td>
<td>Storage provider factory</td>
<td><code>StorageFactory</code>, <code>LocalStorageProvider</code></td>
<td>Contexts, API routes, components</td>
</tr>
<tr>
<td><code>src/lib/storage/filesystem-provider.ts</code></td>
<td>storage</td>
<td>Local filesystem provider</td>
<td><code>FileSystemProvider</code></td>
<td>Storage factory</td>
</tr>
<tr>
<td><code>src/lib/storage/onedrive-provider.ts</code></td>
<td>storage</td>
<td>OneDrive provider</td>
<td><code>OneDriveProvider</code></td>
<td>Storage factory</td>
</tr>
<tr>
<td><code>src/lib/storage/storage-factory-mongodb.ts</code></td>
<td>storage</td>
<td>MongoDB storage factory</td>
<td><code>MongoDBStorageFactory</code></td>
<td>MongoDB operations</td>
</tr>
<tr>
<td><code>src/lib/storage/filesystem-client.ts</code></td>
<td>storage</td>
<td>Filesystem client</td>
<td><code>FileSystemClient</code></td>
<td>Client-side operations</td>
</tr>
<tr>
<td><code>src/lib/storage/server-provider.ts</code></td>
<td>storage</td>
<td>Server-side provider helper</td>
<td><code>getServerProvider</code></td>
<td>API routes</td>
</tr>
<tr>
<td><code>src/lib/storage/supported-types.ts</code></td>
<td>storage</td>
<td>Supported library types</td>
<td><code>SUPPORTED_LIBRARY_TYPES</code>, <code>isSupportedLibraryType</code>, <code>getSupportedLibraryTypesString</code></td>
<td>Storage factory</td>
</tr>
<tr>
<td><code>src/contexts/storage-context.tsx</code></td>
<td>storage</td>
<td>Storage React context</td>
<td><code>StorageContextProvider</code>, <code>useStorage</code></td>
<td>Components</td>
</tr>
<tr>
<td><code>src/hooks/use-storage-provider.tsx</code></td>
<td>storage</td>
<td>Storage provider hook</td>
<td><code>useStorageProvider</code></td>
<td>Components</td>
</tr>
</tbody>
</table>
<h2 id="reference-file-index-library-system">Library System ✅<a class="headerlink" href="#reference-file-index-library-system" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>File Path</th>
<th>Module</th>
<th>Description</th>
<th>Exports</th>
<th>Used In</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>src/types/library.ts</code></td>
<td>library</td>
<td>Library type definitions</td>
<td><code>ClientLibrary</code>, <code>Library</code>, <code>LibraryChatConfig</code>, <code>StorageConfig</code>, <code>PublicLibraryConfig</code></td>
<td>All library files</td>
</tr>
<tr>
<td><code>src/atoms/library-atom.ts</code></td>
<td>library</td>
<td>Library state atoms</td>
<td><code>libraryAtom</code>, <code>activeLibraryIdAtom</code>, <code>librariesAtom</code>, <code>activeLibraryAtom</code>, <code>currentFolderIdAtom</code></td>
<td>Components</td>
</tr>
<tr>
<td><code>src/lib/services/library-service.ts</code></td>
<td>library</td>
<td>Library service</td>
<td><code>LibraryService</code>, <code>UserLibraries</code></td>
<td>API routes, components</td>
</tr>
<tr>
<td><code>src/components/library/library.tsx</code></td>
<td>library</td>
<td>Main library component</td>
<td><code>Library</code></td>
<td>Library page</td>
</tr>
<tr>
<td><code>src/components/library/library-header.tsx</code></td>
<td>library</td>
<td>Library header component</td>
<td>TBD</td>
<td>Library component</td>
</tr>
<tr>
<td><code>src/components/library/library-switcher.tsx</code></td>
<td>library</td>
<td>Library switcher component</td>
<td>TBD</td>
<td>Library header</td>
</tr>
<tr>
<td><code>src/components/library/file-list.tsx</code></td>
<td>library</td>
<td>File list with header actions and record operations</td>
<td><code>FileList</code></td>
<td>Library component</td>
</tr>
</tbody>
</table>
<h2 id="reference-file-index-chat-system">Chat System ✅<a class="headerlink" href="#reference-file-index-chat-system" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>File Path</th>
<th>Module</th>
<th>Description</th>
<th>Exports</th>
<th>Used In</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>src/types/chat.ts</code></td>
<td>chat</td>
<td>Chat type definitions</td>
<td><code>Chat</code></td>
<td>Chat system</td>
</tr>
<tr>
<td><code>src/lib/chat/constants.ts</code></td>
<td>chat</td>
<td>Chat constants</td>
<td><code>AnswerLength</code>, <code>Retriever</code>, <code>TargetLanguage</code>, <code>Character</code>, <code>SocialContext</code></td>
<td>Chat system</td>
</tr>
<tr>
<td><code>src/lib/chat/orchestrator.ts</code></td>
<td>chat</td>
<td>Chat orchestration</td>
<td><code>runChatOrchestrated</code>, <code>OrchestratorInput</code>, <code>OrchestratorOutput</code></td>
<td>Chat API routes</td>
</tr>
<tr>
<td><code>src/lib/chat/loader.ts</code></td>
<td>chat</td>
<td>Chat loader</td>
<td><code>loadLibraryChatContext</code>, <code>LibraryChatContext</code></td>
<td>Chat orchestrator</td>
</tr>
<tr>
<td><code>src/lib/chat/config.ts</code></td>
<td>chat</td>
<td>Chat configuration</td>
<td><code>chatConfigSchema</code>, <code>normalizeChatConfig</code>, <code>getVectorIndexForLibrary(library, chatConfig?)</code></td>
<td>Chat system</td>
</tr>
<tr>
<td><code>src/lib/chat/retrievers/chunks.ts</code></td>
<td>chat</td>
<td>Chunk retriever</td>
<td><code>chunksRetriever</code></td>
<td>Chat orchestrator</td>
</tr>
<tr>
<td><code>src/lib/chat/retrievers/summaries-mongo.ts</code></td>
<td>chat</td>
<td>Summary retriever</td>
<td><code>summariesMongoRetriever</code></td>
<td>Chat orchestrator</td>
</tr>
<tr>
<td><code>src/lib/chat/common/prompt.ts</code></td>
<td>chat</td>
<td>Prompt building</td>
<td><code>buildPrompt</code>, <code>buildTOCPrompt</code>, <code>getSourceDescription</code></td>
<td>Chat orchestrator</td>
</tr>
<tr>
<td><code>src/lib/chat/common/llm.ts</code></td>
<td>chat</td>
<td>LLM calling</td>
<td><code>callOpenAI</code>, <code>parseOpenAIResponseWithUsage</code>, <code>parseStructuredLLMResponse</code></td>
<td>Chat orchestrator</td>
</tr>
<tr>
<td><code>src/app/api/chat/[libraryId]/stream/route.ts</code></td>
<td>chat</td>
<td>Chat streaming endpoint</td>
<td><code>POST</code></td>
<td>Chat components</td>
</tr>
</tbody>
</table>
<h2 id="reference-file-index-external-jobs-system">External Jobs System ✅<a class="headerlink" href="#reference-file-index-external-jobs-system" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>File Path</th>
<th>Module</th>
<th>Description</th>
<th>Exports</th>
<th>Used In</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>src/lib/external-jobs-repository.ts</code></td>
<td>external-jobs</td>
<td>MongoDB repository for external jobs</td>
<td><code>ExternalJobsRepository</code></td>
<td>Worker, watchdog, API routes, orchestration</td>
</tr>
<tr>
<td><code>src/lib/external-jobs-worker.ts</code></td>
<td>external-jobs</td>
<td>Background worker for processing jobs</td>
<td><code>ExternalJobsWorker</code></td>
<td>Instrumentation, worker status endpoint</td>
</tr>
<tr>
<td><code>src/lib/external-jobs-watchdog.ts</code></td>
<td>external-jobs</td>
<td>Timeout monitoring for jobs</td>
<td><code>startWatchdog</code>, <code>bumpWatchdog</code>, <code>clearWatchdog</code></td>
<td>Job callbacks, job start</td>
</tr>
<tr>
<td><code>src/lib/external-jobs/context.ts</code></td>
<td>external-jobs</td>
<td>Request context parsing</td>
<td><code>readContext</code></td>
<td>Job callback</td>
</tr>
<tr>
<td><code>src/lib/external-jobs/auth.ts</code></td>
<td>external-jobs</td>
<td>Authorization and bypass checks</td>
<td><code>isInternalAuthorized</code>, <code>authorizeCallback</code>, <code>guardProcessId</code></td>
<td>Job callbacks, job start</td>
</tr>
<tr>
<td><code>src/lib/external-jobs/policies.ts</code></td>
<td>external-jobs</td>
<td>Phase policy extraction</td>
<td><code>readPhasesAndPolicies</code></td>
<td>Job callback</td>
</tr>
<tr>
<td><code>src/lib/external-jobs/template-decision.ts</code></td>
<td>external-jobs</td>
<td>Template execution decision logic</td>
<td><code>decideTemplateRun</code></td>
<td>Job callback</td>
</tr>
<tr>
<td><code>src/lib/external-jobs/template-run.ts</code></td>
<td>external-jobs</td>
<td>Template transformation execution</td>
<td><code>runTemplateTransform</code></td>
<td>Job callback</td>
</tr>
<tr>
<td><code>src/lib/external-jobs/chapters.ts</code></td>
<td>external-jobs</td>
<td>Chapter detection and merging</td>
<td><code>analyzeAndMergeChapters</code></td>
<td>Job callback</td>
</tr>
<tr>
<td><code>src/lib/external-jobs/storage.ts</code></td>
<td>external-jobs</td>
<td>Markdown file storage</td>
<td><code>saveMarkdown</code></td>
<td>Job callback</td>
</tr>
<tr>
<td><code>src/lib/external-jobs/images.ts</code></td>
<td>external-jobs</td>
<td>Image archive extraction</td>
<td><code>processAllImageSources</code></td>
<td>Job callback</td>
</tr>
<tr>
<td><code>src/lib/external-jobs/ingest.ts</code></td>
<td>external-jobs</td>
<td>RAG ingestion pipeline</td>
<td><code>runIngestion</code></td>
<td>Job callback, job start</td>
</tr>
<tr>
<td><code>src/lib/external-jobs/complete.ts</code></td>
<td>external-jobs</td>
<td>Job completion handler</td>
<td><code>setJobCompleted</code></td>
<td>Job callback, job start</td>
</tr>
<tr>
<td><code>src/lib/external-jobs/preprocess.ts</code></td>
<td>external-jobs</td>
<td>Job preprocessing and analysis</td>
<td><code>preprocess</code>, <code>PreprocessResult</code></td>
<td>Job start, job callback</td>
</tr>
<tr>
<td><code>src/lib/external-jobs/provider.ts</code></td>
<td>external-jobs</td>
<td>Storage provider construction</td>
<td><code>buildProvider</code></td>
<td>Preprocessing, job callback</td>
</tr>
<tr>
<td><code>src/lib/external-jobs/progress.ts</code></td>
<td>external-jobs</td>
<td>Progress update processing</td>
<td><code>handleProgressIfAny</code></td>
<td>Job callback</td>
</tr>
<tr>
<td><code>src/app/api/external/jobs/[jobId]/route.ts</code></td>
<td>external-jobs</td>
<td>Main job processing endpoint</td>
<td><code>GET</code>, <code>POST</code></td>
<td>Secretary Service, worker</td>
</tr>
<tr>
<td><code>src/app/api/external/jobs/[jobId]/start/route.ts</code></td>
<td>external-jobs</td>
<td>Job execution trigger</td>
<td><code>POST</code></td>
<td>Worker</td>
</tr>
<tr>
<td><code>src/app/api/external/jobs/route.ts</code></td>
<td>external-jobs</td>
<td>Job query endpoint</td>
<td><code>GET</code></td>
<td>Event monitor components</td>
</tr>
</tbody>
</table>
<h2 id="reference-file-index-secretary-service">Secretary Service ✅<a class="headerlink" href="#reference-file-index-secretary-service" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>File Path</th>
<th>Module</th>
<th>Description</th>
<th>Exports</th>
<th>Used In</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>src/lib/secretary/client.ts</code></td>
<td>secretary</td>
<td>HTTP client for Secretary Service API</td>
<td><code>SecretaryServiceClient</code>, <code>SecretaryServiceError</code>, response interfaces</td>
<td>Secretary API routes, external jobs</td>
</tr>
<tr>
<td><code>src/lib/secretary/adapter.ts</code></td>
<td>secretary</td>
<td>Low-level API call functions</td>
<td><code>callPdfProcess</code>, <code>callTemplateTransform</code></td>
<td>Secretary client, template runner</td>
</tr>
<tr>
<td><code>src/lib/secretary/response-parser.ts</code></td>
<td>secretary</td>
<td>Markdown response parsing</td>
<td><code>parseSecretaryMarkdownStrict</code>, <code>FrontmatterParseResult</code></td>
<td>External jobs, Secretary API routes</td>
</tr>
<tr>
<td><code>src/lib/secretary/types.ts</code></td>
<td>secretary</td>
<td>Type definitions for Secretary Service</td>
<td>Request/response interfaces</td>
<td>Secretary client, API routes, external jobs</td>
</tr>
<tr>
<td><code>src/app/api/secretary/process-pdf/route.ts</code></td>
<td>secretary</td>
<td>PDF transformation endpoint</td>
<td><code>POST</code></td>
<td>Library components</td>
</tr>
<tr>
<td><code>src/app/api/secretary/process-audio/route.ts</code></td>
<td>secretary</td>
<td>Audio transformation endpoint</td>
<td><code>POST</code></td>
<td>Library components</td>
</tr>
<tr>
<td><code>src/app/api/secretary/process-video/route.ts</code></td>
<td>secretary</td>
<td>Video transformation endpoint</td>
<td><code>POST</code></td>
<td>Library components</td>
</tr>
<tr>
<td><code>src/app/api/secretary/process-image/route.ts</code></td>
<td>secretary</td>
<td>Image OCR endpoint</td>
<td><code>POST</code></td>
<td>Library components</td>
</tr>
<tr>
<td><code>src/app/api/secretary/session/process/route.ts</code></td>
<td>secretary</td>
<td>Session import endpoint</td>
<td><code>POST</code></td>
<td>Event monitor components, session processing</td>
</tr>
</tbody>
</table>
<h2 id="reference-file-index-event-job-system">Event Job System ✅<a class="headerlink" href="#reference-file-index-event-job-system" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>File Path</th>
<th>Module</th>
<th>Description</th>
<th>Exports</th>
<th>Used In</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>src/lib/event-job-repository.ts</code></td>
<td>event-job</td>
<td>MongoDB repository for event jobs</td>
<td><code>EventJobRepository</code></td>
<td>API routes, session processor, event monitor</td>
</tr>
<tr>
<td><code>src/lib/session/session-processor.ts</code></td>
<td>event-job</td>
<td>Session data processing utilities</td>
<td><code>vttToPlainText</code>, <code>extractVideoTranscript</code>, <code>buildSessionPayload</code></td>
<td>API routes, event monitor components</td>
</tr>
<tr>
<td><code>src/lib/session-repository.ts</code></td>
<td>event-job</td>
<td>MongoDB repository for sessions</td>
<td><code>SessionRepository</code></td>
<td>API routes, event monitor components</td>
</tr>
<tr>
<td><code>src/app/api/event-job/jobs/[jobId]/route.ts</code></td>
<td>event-job</td>
<td>Individual job operations</td>
<td><code>GET</code>, <code>DELETE</code>, <code>PATCH</code></td>
<td>Event monitor components</td>
</tr>
<tr>
<td><code>src/app/api/event-job/batches/[batchId]/route.ts</code></td>
<td>event-job</td>
<td>Individual batch operations</td>
<td><code>GET</code>, <code>DELETE</code></td>
<td>Event monitor components</td>
</tr>
<tr>
<td><code>src/app/api/event-job/events/route.ts</code></td>
<td>event-job</td>
<td>Event list and migration</td>
<td><code>GET</code>, <code>POST</code></td>
<td>Event monitor components</td>
</tr>
</tbody>
</table>
<h2 id="reference-file-index-transform-processing">Transform &amp; Processing ✅<a class="headerlink" href="#reference-file-index-transform-processing" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>File Path</th>
<th>Module</th>
<th>Description</th>
<th>Exports</th>
<th>Used In</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>src/lib/transform/transform-service.ts</code></td>
<td>transform</td>
<td>Central transformation service</td>
<td><code>TransformService</code>, transform option interfaces, <code>TransformResult</code></td>
<td>Library components, transform API routes</td>
</tr>
<tr>
<td><code>src/lib/transform/image-extraction-service.ts</code></td>
<td>transform</td>
<td>PDF image extraction and storage</td>
<td><code>ImageExtractionService</code>, <code>ExtractedPageImage</code>, <code>ImageExtractionResult</code></td>
<td>Transform service, external jobs</td>
</tr>
<tr>
<td><code>src/lib/processing/gates.ts</code></td>
<td>processing</td>
<td>Phase gate checking utilities</td>
<td><code>gateExtractPdf</code>, <code>gateTransformTemplate</code>, <code>gateIngestRag</code>, <code>GateContext</code>, <code>GateResult</code></td>
<td>Template decision, external jobs</td>
</tr>
<tr>
<td><code>src/lib/processing/phase-policy.ts</code></td>
<td>processing</td>
<td>Processing phase control policies</td>
<td><code>PhaseDirective</code>, <code>PhasePolicies</code>, policy utilities</td>
<td>External jobs, gates, Secretary API routes</td>
</tr>
</tbody>
</table>
<h2 id="reference-file-index-shadow-twin-system">Shadow-Twin System ✅<a class="headerlink" href="#reference-file-index-shadow-twin-system" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>File Path</th>
<th>Module</th>
<th>Description</th>
<th>Exports</th>
<th>Used In</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>src/lib/shadow-twin/shared.ts</code></td>
<td>shadow-twin</td>
<td>Shared Shadow-Twin types and utilities</td>
<td><code>ShadowTwinState</code>, <code>toMongoShadowTwinState</code></td>
<td>Backend (Job documents), Frontend (Atoms)</td>
</tr>
<tr>
<td><code>src/lib/shadow-twin/analyze-shadow-twin.ts</code></td>
<td>shadow-twin</td>
<td>Shadow-Twin analysis logic</td>
<td><code>analyzeShadowTwin</code></td>
<td>Frontend hooks, job start</td>
</tr>
<tr>
<td><code>src/lib/storage/shadow-twin.ts</code></td>
<td>shadow-twin</td>
<td>Shadow-Twin file and directory utilities</td>
<td><code>generateShadowTwinName</code>, <code>generateShadowTwinFolderName</code>, <code>findShadowTwinFolder</code>, <code>findShadowTwinMarkdown</code></td>
<td>External jobs, gates, analysis</td>
</tr>
<tr>
<td><code>src/lib/external-jobs/shadow-twin-helpers.ts</code></td>
<td>shadow-twin</td>
<td>Shadow-Twin folder creation utilities</td>
<td><code>findOrCreateShadowTwinFolder(provider, parentId, originalName, jobId)</code> → <code>string | undefined</code></td>
<td>External jobs</td>
</tr>
<tr>
<td><code>src/atoms/shadow-twin-atom.ts</code></td>
<td>shadow-twin</td>
<td>Frontend Shadow-Twin state atom</td>
<td><code>shadowTwinStateAtom</code>, <code>FrontendShadowTwinState</code></td>
<td>Library components, file list, file preview</td>
</tr>
<tr>
<td><code>src/hooks/use-shadow-twin-analysis.ts</code></td>
<td>shadow-twin</td>
<td>React hook for Shadow-Twin analysis</td>
<td><code>useShadowTwinAnalysis</code></td>
<td>File list component</td>
</tr>
</tbody>
</table>
<p><strong>Documentation</strong>: See <a href="#architecture-shadow-twin">Shadow-Twin Architecture</a> and <a href="#architecture-pdf-transformation-phases">PDF Transformation Phases</a></p>
<h2 id="reference-file-index-database-repositories">Database Repositories ✅<a class="headerlink" href="#reference-file-index-database-repositories" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>File Path</th>
<th>Module</th>
<th>Description</th>
<th>Exports</th>
<th>Used In</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>src/lib/db/chats-repo.ts</code></td>
<td>chat</td>
<td>MongoDB repository for chat management</td>
<td><code>createChat</code>, <code>listChats</code>, <code>getChatById</code>, <code>touchChat</code>, <code>deleteChat</code></td>
<td>Chat API routes, chat components</td>
</tr>
<tr>
<td><code>src/lib/db/queries-repo.ts</code></td>
<td>chat</td>
<td>MongoDB repository for query logging</td>
<td><code>insertQueryLog</code>, <code>appendRetrievalStep</code>, <code>updateQueryLogPartial</code>, <code>getQueryLogById</code>, <code>listRecentQueries</code>, <code>getFilteredDocumentCount(libraryOrId, filter)</code></td>
<td>Chat API routes, chat modules, query logger</td>
</tr>
<tr>
<td><code>src/lib/repositories/doc-meta-repo.ts</code></td>
<td>chat</td>
<td>MongoDB repository for document metadata</td>
<td><code>computeDocMetaCollectionName</code>, <code>ensureFacetIndexes</code>, <code>upsertDocMeta</code>, <code>findDocs</code>, <code>deleteDocMeta</code></td>
<td>Summary retriever, ingestion service</td>
</tr>
</tbody>
</table>
<h2 id="reference-file-index-api-routes">API Routes ✅<a class="headerlink" href="#reference-file-index-api-routes" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>File Path</th>
<th>Module</th>
<th>Description</th>
<th>Exports</th>
<th>Used In</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>src/app/api/storage/filesystem/route.ts</code></td>
<td>storage</td>
<td>Filesystem storage API</td>
<td><code>GET</code>, <code>POST</code>, <code>DELETE</code>, <code>PATCH</code></td>
<td>Storage providers</td>
</tr>
<tr>
<td><code>src/app/api/libraries/route.ts</code></td>
<td>library</td>
<td>Library management API</td>
<td><code>GET</code>, <code>POST</code></td>
<td>Settings, storage context</td>
</tr>
</tbody>
</table>
<h2 id="reference-file-index-notes">Notes<a class="headerlink" href="#reference-file-index-notes" title="Permanent link">&para;</a></h2>
<ul>
<li>Files are organized by functional module</li>
<li>✅ = Fully documented with JSDoc headers</li>
<li>Export information completed for documented files</li>
<li>Usage information updated based on dependency analysis</li>
</ul>
<h2 id="reference-file-index-status">Status<a class="headerlink" href="#reference-file-index-status" title="Permanent link">&para;</a></h2>
<ul>
<li>✅ Core Infrastructure: Documented (6 files)</li>
<li>✅ Storage Layer: Documented (10 files)</li>
<li>✅ Library System: Documented (4 files)</li>
<li>✅ Chat System: Documented (9 files)</li>
<li>✅ External Jobs System: Documented (18 files)</li>
<li>✅ Secretary Service: Documented (9 files)</li>
<li>✅ Event Job System: Documented (6 files)</li>
<li>✅ Transform &amp; Processing: Documented (4 files)</li>
<li>✅ Database Repositories: Documented (3 files)</li>
<li>✅ API Routes: Documented (2 files)</li>
<li><strong>Total Documented: 71 files (~16.7% of ~424 files)</strong></li>
<li>⏳ Remaining Components: Pending</li>
<li>⏳ Remaining API Routes: Pending</li>
</ul></section>
                    <section class='print-page md-section' id='section-7-2' heading-number='7.2'>
                        <h1>Modules<a class='headerlink' href='#section-7-2' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="reference-modules-library" heading-number="7.2.1"><h1 id="reference-modules-library-library-module">Library Module<a class="headerlink" href="#reference-modules-library-library-module" title="Permanent link">&para;</a></h1>
<p>Complete documentation for the Library module.</p>
<h2 id="reference-modules-library-overview">Overview<a class="headerlink" href="#reference-modules-library-overview" title="Permanent link">&para;</a></h2>
<p>The Library module manages library configuration, state, and UI components. Libraries represent collections of files organized by storage backend and user ownership.</p>
<h2 id="reference-modules-library-key-files">Key Files<a class="headerlink" href="#reference-modules-library-key-files" title="Permanent link">&para;</a></h2>
<h3 id="reference-modules-library-types">Types<a class="headerlink" href="#reference-modules-library-types" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>src/types/library.ts</code></strong>: Complete library type definitions including <code>Library</code>, <code>ClientLibrary</code>, <code>LibraryChatConfig</code>, <code>StorageConfig</code>, and <code>PublicLibraryConfig</code></li>
</ul>
<h3 id="reference-modules-library-state-management">State Management<a class="headerlink" href="#reference-modules-library-state-management" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>src/atoms/library-atom.ts</code></strong>: Jotai atoms for library state management including active library, folder navigation, and file caching</li>
</ul>
<h3 id="reference-modules-library-service">Service<a class="headerlink" href="#reference-modules-library-service" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>src/lib/services/library-service.ts</code></strong>: MongoDB-based library service for CRUD operations</li>
</ul>
<h3 id="reference-modules-library-components">Components<a class="headerlink" href="#reference-modules-library-components" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>src/components/library/library.tsx</code></strong>: Main library component combining file tree, list, and preview</li>
<li><strong><code>src/components/library/library-header.tsx</code></strong>: Library header with switcher and actions</li>
<li><strong><code>src/components/library/library-switcher.tsx</code></strong>: Library selection component</li>
<li><strong><code>src/components/library/file-list.tsx</code></strong>: File list component with header actions and record-level operations</li>
</ul>
<h2 id="reference-modules-library-exports">Exports<a class="headerlink" href="#reference-modules-library-exports" title="Permanent link">&para;</a></h2>
<h3 id="reference-modules-library-types_1">Types<a class="headerlink" href="#reference-modules-library-types_1" title="Permanent link">&para;</a></h3>
<ul>
<li><code>Library</code>: Complete library configuration type</li>
<li><code>ClientLibrary</code>: Client-side library type</li>
<li><code>LibraryChatConfig</code>: Chat/RAG configuration</li>
<li><code>StorageConfig</code>: Storage provider configuration</li>
<li><code>PublicLibraryConfig</code>: Public publishing configuration</li>
<li><code>StorageProviderType</code>: Supported storage provider types</li>
</ul>
<h3 id="reference-modules-library-atoms">Atoms<a class="headerlink" href="#reference-modules-library-atoms" title="Permanent link">&para;</a></h3>
<ul>
<li><code>libraryAtom</code>: Main library state atom</li>
<li><code>activeLibraryIdAtom</code>: Active library ID atom</li>
<li><code>librariesAtom</code>: Libraries list atom</li>
<li><code>activeLibraryAtom</code>: Active library object atom</li>
<li><code>currentFolderIdAtom</code>: Current folder ID atom</li>
<li><code>folderItemsAtom</code>: Folder items atom family</li>
</ul>
<h3 id="reference-modules-library-service_1">Service<a class="headerlink" href="#reference-modules-library-service_1" title="Permanent link">&para;</a></h3>
<ul>
<li><code>LibraryService</code>: Singleton service class for library operations</li>
</ul>
<h3 id="reference-modules-library-components_1">Components<a class="headerlink" href="#reference-modules-library-components_1" title="Permanent link">&para;</a></h3>
<ul>
<li><code>Library</code>: Main library component</li>
<li><code>LibraryHeader</code>: Library header component</li>
<li><code>LibrarySwitcher</code>: Library switcher component</li>
<li><code>FileList</code>: File list component with actions and batch operations</li>
</ul>
<h2 id="reference-modules-library-usage-examples">Usage Examples<a class="headerlink" href="#reference-modules-library-usage-examples" title="Permanent link">&para;</a></h2>
<h3 id="reference-modules-library-accessing-library-state">Accessing Library State<a class="headerlink" href="#reference-modules-library-accessing-library-state" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useAtomValue</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;jotai&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">activeLibraryAtom</span><span class="p">,</span><span class="w"> </span><span class="nx">librariesAtom</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/atoms/library-atom&#39;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">MyComponent</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">activeLibrary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useAtomValue</span><span class="p">(</span><span class="nx">activeLibraryAtom</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">libraries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useAtomValue</span><span class="p">(</span><span class="nx">librariesAtom</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// Use library data</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="reference-modules-library-using-library-service">Using Library Service<a class="headerlink" href="#reference-modules-library-using-library-service" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">LibraryService</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/lib/services/library-service&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">LibraryService</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">();</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">libraries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">service</span><span class="p">.</span><span class="nx">getUserLibraries</span><span class="p">(</span><span class="nx">userEmail</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">library</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">service</span><span class="p">.</span><span class="nx">getLibrary</span><span class="p">(</span><span class="nx">userEmail</span><span class="p">,</span><span class="w"> </span><span class="nx">libraryId</span><span class="p">);</span>
</code></pre></div>
<h3 id="reference-modules-library-library-component">Library Component<a class="headerlink" href="#reference-modules-library-library-component" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Library</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/components/library/library&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">LibraryPage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">Library</span><span class="w"> </span><span class="o">/&gt;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="reference-modules-library-using-root-items-hook">Using Root Items Hook<a class="headerlink" href="#reference-modules-library-using-root-items-hook" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useRootItems</span><span class="p">,</span><span class="w"> </span><span class="nx">useRootItemsSync</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/hooks/use-root-items&#39;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">MyComponent</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Get function to load root items (async)</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">getRootItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRootItems</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// Get root items synchronously if already loaded</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">rootItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRootItemsSync</span><span class="p">();</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">rootItems</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// Load root items if not available</span>
<span class="w">      </span><span class="nx">getRootItems</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">items</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Root items loaded:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">items</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">getRootItems</span><span class="p">,</span><span class="w"> </span><span class="nx">rootItems</span><span class="p">]);</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="reference-modules-library-dependencies">Dependencies<a class="headerlink" href="#reference-modules-library-dependencies" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Storage Layer</strong>: Uses <code>@/lib/storage/storage-factory</code> for provider access</li>
<li><strong>Database</strong>: Uses <code>@/lib/mongodb-service</code> for persistence</li>
<li><strong>State Management</strong>: Uses Jotai for state management</li>
<li><strong>Chat System</strong>: Uses <code>@/lib/chat/constants</code> for chat configuration types</li>
</ul>
<h2 id="reference-modules-library-library-configuration">Library Configuration<a class="headerlink" href="#reference-modules-library-library-configuration" title="Permanent link">&para;</a></h2>
<p>Libraries support:
- <strong>Storage Configuration</strong>: Provider type and authentication
- <strong>Chat Configuration</strong>: RAG settings, target language, character
- <strong>Public Publishing</strong>: Gallery and story mode configuration
- <strong>Gallery Configuration</strong>: Facets, detail view types</p>
<h2 id="reference-modules-library-state-management_1">State Management<a class="headerlink" href="#reference-modules-library-state-management_1" title="Permanent link">&para;</a></h2>
<p>Library state is managed through Jotai atoms with a centralized caching strategy:</p>
<h3 id="reference-modules-library-state-architecture">State Architecture<a class="headerlink" href="#reference-modules-library-state-architecture" title="Permanent link">&para;</a></h3>
<p>The Library module uses a <strong>centralized state management</strong> approach with Jotai atoms:</p>
<ul>
<li><strong>Global State</strong>: Libraries list, active library</li>
<li><strong>Navigation State</strong>: Current folder, path</li>
<li><strong>UI State</strong>: Loading states, selected files</li>
<li><strong>Cache</strong>: Folder items cache for performance</li>
</ul>
<h3 id="reference-modules-library-central-state-logic">Central State Logic<a class="headerlink" href="#reference-modules-library-central-state-logic" title="Permanent link">&para;</a></h3>
<h4 id="reference-modules-library-1-folder-items-cache-folderitemsatom">1. Folder Items Cache (<code>folderItemsAtom</code>)<a class="headerlink" href="#reference-modules-library-1-folder-items-cache-folderitemsatom" title="Permanent link">&para;</a></h4>
<p>The <code>folderItemsAtom</code> is an <strong>atom family</strong> that caches folder contents by folder ID:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Atom family for folder-specific caching</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">folderItemsAtom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">atomFamily</span><span class="p">((</span><span class="nx">folderId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nx">atom</span><span class="o">&lt;</span><span class="nx">StorageItem</span><span class="p">[]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="o">&gt;</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
<p><strong>How it works:</strong>
- Each folder has its own cached state
- When <code>currentFolderId === 'root'</code>, root items are cached
- Components can access cached items synchronously without API calls
- Cache is updated when folders are loaded via <code>StorageContext</code></p>
<p><strong>Benefits:</strong>
- Eliminates duplicate API calls for the same folder
- Provides instant access to already-loaded data
- Reduces server load and improves performance</p>
<h4 id="reference-modules-library-2-root-items-central-management-userootitems">2. Root Items Central Management (<code>useRootItems</code>)<a class="headerlink" href="#reference-modules-library-2-root-items-central-management-userootitems" title="Permanent link">&para;</a></h4>
<p>The <code>useRootItems</code> hook provides centralized access to root items:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Hook automatically uses cache if available</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">getRootItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRootItems</span><span class="p">();</span>

<span class="c1">// Synchronous access if root items are already cached</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">rootItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRootItemsSync</span><span class="p">();</span>
</code></pre></div>
<p><strong>How it works:</strong>
- Checks <code>folderItemsAtom</code> if <code>currentFolderId === 'root'</code>
- Falls back to API call via <code>StorageContext.listItems('root')</code>
- Uses request deduplication from <code>StorageContext</code>
- All components share the same cached root items</p>
<p><strong>Integration with StorageContext:</strong>
- <code>StorageContext</code> loads root items once when library is initialized
- Updates <code>folderItemsAtom</code> when root items are loaded
- <code>useRootItems</code> reads from cache, avoiding duplicate requests</p>
<h4 id="reference-modules-library-3-request-deduplication">3. Request Deduplication<a class="headerlink" href="#reference-modules-library-3-request-deduplication" title="Permanent link">&para;</a></h4>
<p>The <code>StorageContext</code> implements request deduplication:</p>
<ul>
<li>Multiple simultaneous requests for the same folder are merged</li>
<li>Only one API call is made, all callers receive the same promise</li>
<li>Prevents duplicate network requests during rapid navigation</li>
</ul>
<h4 id="reference-modules-library-4-state-flow">4. State Flow<a class="headerlink" href="#reference-modules-library-4-state-flow" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>1. User navigates to folder
   ↓
2. StorageContext.listItems(folderId)
   ↓
3. Request deduplication checks for pending requests
   ↓
4. API call (if not cached/deduplicated)
   ↓
5. folderItemsAtom updated with results
   ↓
6. All components using folderItemsAtom receive updates
</code></pre></div>
<h3 id="reference-modules-library-state-atoms-reference">State Atoms Reference<a class="headerlink" href="#reference-modules-library-state-atoms-reference" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Atom</th>
<th>Type</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>libraryAtom</code></td>
<td><code>LibraryState</code></td>
<td>Main library state container</td>
</tr>
<tr>
<td><code>activeLibraryIdAtom</code></td>
<td><code>string</code></td>
<td>Currently active library ID</td>
</tr>
<tr>
<td><code>librariesAtom</code></td>
<td><code>ClientLibrary[]</code></td>
<td>List of all user libraries</td>
</tr>
<tr>
<td><code>activeLibraryAtom</code></td>
<td><code>ClientLibrary \| undefined</code></td>
<td>Active library object (derived)</td>
</tr>
<tr>
<td><code>currentFolderIdAtom</code></td>
<td><code>string</code></td>
<td>Current folder ID (default: 'root')</td>
</tr>
<tr>
<td><code>folderItemsAtom</code></td>
<td><code>atomFamily</code></td>
<td>Folder items cache by folder ID</td>
</tr>
<tr>
<td><code>libraryStatusAtom</code></td>
<td><code>LibraryStatus</code></td>
<td>Library loading status</td>
</tr>
</tbody>
</table>
<h3 id="reference-modules-library-best-practices">Best Practices<a class="headerlink" href="#reference-modules-library-best-practices" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Always use <code>folderItemsAtom</code> for folder contents</strong> - Don't make direct API calls</li>
<li><strong>Use <code>useRootItems</code> for root items</strong> - Provides cache-aware access</li>
<li><strong>Let StorageContext manage loading</strong> - Components should read from atoms, not trigger loads</li>
<li><strong>Cache is automatically updated</strong> - No manual cache invalidation needed</li>
</ol>
<h2 id="reference-modules-library-file-list-component">File List Component<a class="headerlink" href="#reference-modules-library-file-list-component" title="Permanent link">&para;</a></h2>
<p>The <code>FileList</code> component displays files and folders in a table format with header actions and record-level operations.</p>
<h3 id="reference-modules-library-header-actions">Header Actions<a class="headerlink" href="#reference-modules-library-header-actions" title="Permanent link">&para;</a></h3>
<p>The header bar (visible when not in compact mode) provides batch operations:</p>
<table>
<thead>
<tr>
<th>Button</th>
<th>Icon</th>
<th>Function</th>
<th>When Visible</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Refresh</strong></td>
<td><code>RefreshCw</code></td>
<td>Reloads current folder contents</td>
<td>Always</td>
</tr>
<tr>
<td><strong>File Category Filter</strong></td>
<td>Filter icon</td>
<td>Filters files by category (PDF, Audio, Video, etc.)</td>
<td>Always</td>
</tr>
<tr>
<td><strong>Batch Transcription</strong></td>
<td><code>ScrollText</code></td>
<td>Opens transcription dialog for selected audio/video files</td>
<td>When audio/video files are selected</td>
</tr>
<tr>
<td><strong>Batch Transformation</strong></td>
<td><code>Plus</code></td>
<td>Opens transformation dialog for selected PDF files</td>
<td>When PDF files are selected</td>
</tr>
<tr>
<td><strong>Batch Ingest</strong></td>
<td>Text button</td>
<td>Ingests selected documents into RAG system</td>
<td>When PDF/Markdown files are selected</td>
</tr>
<tr>
<td><strong>Bulk Delete</strong></td>
<td><code>Trash2</code></td>
<td>Deletes all selected files</td>
<td>When any files are selected</td>
</tr>
</tbody>
</table>
<p><strong>Usage:</strong>
1. Select files using checkboxes
2. Header buttons appear automatically based on file types selected
3. Click button to perform batch operation
4. Operation runs in background, progress shown per file</p>
<h3 id="reference-modules-library-record-level-actions">Record-Level Actions<a class="headerlink" href="#reference-modules-library-record-level-actions" title="Permanent link">&para;</a></h3>
<p>Each file row provides the following actions:</p>
<table>
<thead>
<tr>
<th>Element</th>
<th>Function</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Checkbox</strong></td>
<td>Select file for batch operations</td>
<td>Leftmost column, enables batch actions</td>
</tr>
<tr>
<td><strong>File Icon</strong></td>
<td>Visual file type indicator</td>
<td>Shows icon based on MIME type (PDF, Audio, Video, Text)</td>
</tr>
<tr>
<td><strong>File Name</strong></td>
<td>Select/Edit file</td>
<td>Click to select, double-click to rename</td>
</tr>
<tr>
<td><strong>Shadow-Twin Icon</strong></td>
<td>View Shadow-Twin files</td>
<td>Blue <code>FileText</code> icon, shows if Shadow-Twin exists (transcript or transformed file or directory)</td>
</tr>
<tr>
<td><strong>Create Transcript</strong></td>
<td>Create new transcript</td>
<td>Plus icon, only shown for transcribable files without Shadow-Twin</td>
</tr>
<tr>
<td><strong>Delete Button</strong></td>
<td>Delete file</td>
<td>Red <code>Trash2</code> icon, deletes file after confirmation</td>
</tr>
</tbody>
</table>
<p><strong>File Interactions:</strong>
- <strong>Single Click</strong>: Selects file (opens in preview)
- <strong>Double Click</strong>: Enters rename mode
- <strong>Long Press</strong> (touch): Opens context menu
- <strong>Drag &amp; Drop</strong>: Reorder files (if supported)</p>
<p><strong>Shadow-Twin Integration:</strong>
- Shadow-Twin files (transcripts and transformed files) are grouped with their base files
- Single Shadow-Twin icon indicates if Shadow-Twin exists (file or directory)
- Clicking Shadow-Twin icon opens the transformed file (if available) or first transcript file
- Shadow-Twin state is automatically analyzed and displayed</p>
<h3 id="reference-modules-library-file-categories">File Categories<a class="headerlink" href="#reference-modules-library-file-categories" title="Permanent link">&para;</a></h3>
<p>Files are automatically categorized:
- <strong>PDF Files</strong>: Can be transformed, transcribed (OCR), and ingested
- <strong>Audio Files</strong>: Can be transcribed and ingested
- <strong>Video Files</strong>: Can be transcribed and ingested
- <strong>Markdown Files</strong>: Can be ingested, may be transcripts or transformed files
- <strong>Other Files</strong>: Display only, limited operations</p>
<h3 id="reference-modules-library-batch-operations">Batch Operations<a class="headerlink" href="#reference-modules-library-batch-operations" title="Permanent link">&para;</a></h3>
<p>Batch operations support multiple files simultaneously:</p>
<ol>
<li><strong>Batch Transcription</strong>: Transcribes multiple audio/video files in parallel</li>
<li><strong>Batch Transformation</strong>: Transforms multiple PDFs to Markdown</li>
<li><strong>Batch Ingestion</strong>: Ingests multiple documents into RAG system</li>
<li><strong>Bulk Delete</strong>: Deletes multiple files at once</li>
</ol>
<p><strong>Selection:</strong>
- Use checkboxes to select individual files
- Selection persists across folder navigation
- Header shows count of selected files</p>
<h2 id="reference-modules-library-api-integration">API Integration<a class="headerlink" href="#reference-modules-library-api-integration" title="Permanent link">&para;</a></h2>
<p>Libraries are managed through:
- <code>GET /api/libraries</code>: Get user libraries
- <code>POST /api/libraries</code>: Create/update library
- <code>GET /api/libraries/[id]</code>: Get specific library
- <code>PUT /api/libraries/[id]</code>: Update library
- <code>DELETE /api/libraries/[id]</code>: Delete library</p></section><section class="print-page" id="reference-modules-storage" heading-number="7.2.2"><h1 id="reference-modules-storage-storage-module">Storage Module<a class="headerlink" href="#reference-modules-storage-storage-module" title="Permanent link">&para;</a></h1>
<p>Complete documentation for the Storage module.</p>
<h2 id="reference-modules-storage-overview">Overview<a class="headerlink" href="#reference-modules-storage-overview" title="Permanent link">&para;</a></h2>
<p>The Storage module provides an abstraction layer for file storage operations across multiple backends. It supports local filesystem and OneDrive storage, with Nextcloud support in development.</p>
<h2 id="reference-modules-storage-key-files">Key Files<a class="headerlink" href="#reference-modules-storage-key-files" title="Permanent link">&para;</a></h2>
<h3 id="reference-modules-storage-core-types">Core Types<a class="headerlink" href="#reference-modules-storage-core-types" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>src/lib/storage/types.ts</code></strong>: Core type definitions including <code>StorageProvider</code> interface, <code>StorageItem</code>, and <code>StorageValidationResult</code></li>
</ul>
<h3 id="reference-modules-storage-factory-providers">Factory &amp; Providers<a class="headerlink" href="#reference-modules-storage-factory-providers" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>src/lib/storage/storage-factory.ts</code></strong>: Main factory for creating storage providers</li>
<li><strong><code>src/lib/storage/filesystem-provider.ts</code></strong>: Local filesystem provider implementation</li>
<li><strong><code>src/lib/storage/onedrive-provider.ts</code></strong>: OneDrive provider implementation</li>
<li><strong><code>src/lib/storage/storage-factory-mongodb.ts</code></strong>: MongoDB-based storage factory</li>
</ul>
<h3 id="reference-modules-storage-client-server">Client &amp; Server<a class="headerlink" href="#reference-modules-storage-client-server" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>src/lib/storage/filesystem-client.ts</code></strong>: Client-side filesystem provider</li>
<li><strong><code>src/lib/storage/server-provider.ts</code></strong>: Server-side provider helper</li>
</ul>
<h3 id="reference-modules-storage-context-hooks">Context &amp; Hooks<a class="headerlink" href="#reference-modules-storage-context-hooks" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>src/contexts/storage-context.tsx</code></strong>: React context for storage provider management</li>
<li><strong><code>src/hooks/use-storage-provider.tsx</code></strong>: React hook for storage provider access</li>
</ul>
<h3 id="reference-modules-storage-utilities">Utilities<a class="headerlink" href="#reference-modules-storage-utilities" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>src/lib/storage/supported-types.ts</code></strong>: Supported library type definitions</li>
</ul>
<h2 id="reference-modules-storage-exports">Exports<a class="headerlink" href="#reference-modules-storage-exports" title="Permanent link">&para;</a></h2>
<h3 id="reference-modules-storage-types">Types<a class="headerlink" href="#reference-modules-storage-types" title="Permanent link">&para;</a></h3>
<ul>
<li><code>StorageProvider</code>: Core interface for storage providers</li>
<li><code>StorageItem</code>: Unified type for files and folders</li>
<li><code>StorageItemMetadata</code>: Metadata for storage items</li>
<li><code>StorageValidationResult</code>: Result of validation operations</li>
<li><code>StorageError</code>: Error type for storage operations</li>
</ul>
<h3 id="reference-modules-storage-classes">Classes<a class="headerlink" href="#reference-modules-storage-classes" title="Permanent link">&para;</a></h3>
<ul>
<li><code>StorageFactory</code>: Singleton factory for creating providers</li>
<li><code>FileSystemProvider</code>: Local filesystem provider</li>
<li><code>OneDriveProvider</code>: OneDrive provider</li>
<li><code>FileSystemClient</code>: Client-side filesystem provider</li>
<li><code>MongoDBStorageFactory</code>: MongoDB-based factory</li>
</ul>
<h3 id="reference-modules-storage-functions">Functions<a class="headerlink" href="#reference-modules-storage-functions" title="Permanent link">&para;</a></h3>
<ul>
<li><code>getServerProvider()</code>: Creates server-side storage provider</li>
<li><code>isSupportedLibraryType()</code>: Type guard for library types</li>
<li><code>getSupportedLibraryTypesString()</code>: UI helper for supported types</li>
</ul>
<h2 id="reference-modules-storage-usage-examples">Usage Examples<a class="headerlink" href="#reference-modules-storage-usage-examples" title="Permanent link">&para;</a></h2>
<h3 id="reference-modules-storage-creating-a-provider-client-side">Creating a Provider (Client-side)<a class="headerlink" href="#reference-modules-storage-creating-a-provider-client-side" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StorageFactory</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/lib/storage/storage-factory&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">StorageFactory</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">();</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">factory</span><span class="p">.</span><span class="nx">getProvider</span><span class="p">(</span><span class="nx">libraryId</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">provider</span><span class="p">.</span><span class="nx">listItemsById</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">);</span>
</code></pre></div>
<h3 id="reference-modules-storage-using-storage-context-react">Using Storage Context (React)<a class="headerlink" href="#reference-modules-storage-using-storage-context-react" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useStorage</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/contexts/storage-context&#39;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">MyComponent</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">provider</span><span class="p">,</span><span class="w"> </span><span class="nx">listItems</span><span class="p">,</span><span class="w"> </span><span class="nx">currentLibrary</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useStorage</span><span class="p">();</span>
<span class="w">  </span><span class="c1">// Use provider for storage operations</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="reference-modules-storage-server-side-provider">Server-side Provider<a class="headerlink" href="#reference-modules-storage-server-side-provider" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">getServerProvider</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/lib/storage/server-provider&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getServerProvider</span><span class="p">(</span><span class="nx">userEmail</span><span class="p">,</span><span class="w"> </span><span class="nx">libraryId</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">provider</span><span class="p">.</span><span class="nx">listItemsById</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">);</span>
</code></pre></div>
<h2 id="reference-modules-storage-dependencies">Dependencies<a class="headerlink" href="#reference-modules-storage-dependencies" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Core Infrastructure</strong>: Uses <code>@/lib/env</code>, <code>@/lib/auth</code>, <code>@/lib/mongodb-service</code></li>
<li><strong>Library System</strong>: Uses <code>@/types/library</code>, <code>@/lib/services/library-service</code></li>
<li><strong>External</strong>: Uses Clerk for authentication, MongoDB for data storage</li>
</ul>
<h2 id="reference-modules-storage-architecture">Architecture<a class="headerlink" href="#reference-modules-storage-architecture" title="Permanent link">&para;</a></h2>
<p>The storage module follows a layered architecture:</p>
<ol>
<li><strong>Types Layer</strong>: Pure type definitions</li>
<li><strong>Provider Layer</strong>: Concrete provider implementations</li>
<li><strong>Factory Layer</strong>: Provider creation and management</li>
<li><strong>Context Layer</strong>: React integration</li>
<li><strong>API Layer</strong>: Server-side route handlers</li>
</ol>
<h2 id="reference-modules-storage-supported-storage-backends">Supported Storage Backends<a class="headerlink" href="#reference-modules-storage-supported-storage-backends" title="Permanent link">&para;</a></h2>
<ul>
<li>✅ <strong>Local File System</strong>: Direct filesystem access</li>
<li>✅ <strong>OneDrive</strong>: Microsoft OneDrive integration</li>
<li>🚧 <strong>Nextcloud</strong>: In development</li>
</ul>
<h2 id="reference-modules-storage-error-handling">Error Handling<a class="headerlink" href="#reference-modules-storage-error-handling" title="Permanent link">&para;</a></h2>
<p>Storage operations use typed errors (<code>StorageError</code>) with error codes:
- <code>HTTP_ERROR</code>: Network/HTTP errors
- <code>AUTH_ERROR</code>: Authentication failures
- <code>NOT_FOUND</code>: Item not found
- <code>VALIDATION_ERROR</code>: Configuration validation failures</p>
<h2 id="reference-modules-storage-performance-optimizations">Performance Optimizations<a class="headerlink" href="#reference-modules-storage-performance-optimizations" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Caching</strong>: Client-side caching for file listings</li>
<li><strong>Request Deduplication</strong>: Prevents duplicate concurrent requests</li>
<li><strong>Lazy Loading</strong>: Providers created on-demand</li>
<li><strong>Connection Pooling</strong>: MongoDB connection reuse</li>
</ul></section><section class="print-page" id="reference-modules-chat" heading-number="7.2.3"><h1 id="reference-modules-chat-chat-module">Chat Module<a class="headerlink" href="#reference-modules-chat-chat-module" title="Permanent link">&para;</a></h1>
<p>Complete documentation for the Chat module.</p>
<h2 id="reference-modules-chat-overview">Overview<a class="headerlink" href="#reference-modules-chat-overview" title="Permanent link">&para;</a></h2>
<p>The Chat module provides RAG-based chat functionality for knowledge exploration. Supports both regular chat mode and story mode with structured topic exploration.</p>
<h2 id="reference-modules-chat-key-files">Key Files<a class="headerlink" href="#reference-modules-chat-key-files" title="Permanent link">&para;</a></h2>
<h3 id="reference-modules-chat-types">Types<a class="headerlink" href="#reference-modules-chat-types" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>src/types/chat.ts</code></strong>: Chat interface for conversation management</li>
<li><strong><code>src/types/chat-response.ts</code></strong>: Chat response types</li>
<li><strong><code>src/types/chat-processing.ts</code></strong>: Chat processing step types</li>
<li><strong><code>src/types/retriever.ts</code></strong>: Retriever input/output types</li>
</ul>
<h3 id="reference-modules-chat-constants-configuration">Constants &amp; Configuration<a class="headerlink" href="#reference-modules-chat-constants-configuration" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>src/lib/chat/constants.ts</code></strong>: Central chat configuration definitions</li>
<li><strong><code>src/lib/chat/config.ts</code></strong>: Chat configuration normalization</li>
</ul>
<h3 id="reference-modules-chat-orchestration">Orchestration<a class="headerlink" href="#reference-modules-chat-orchestration" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>src/lib/chat/orchestrator.ts</code></strong>: Main orchestration for chat response generation</li>
<li><strong><code>src/lib/chat/loader.ts</code></strong>: Library chat context loading</li>
</ul>
<h3 id="reference-modules-chat-retrievers">Retrievers<a class="headerlink" href="#reference-modules-chat-retrievers" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>src/lib/chat/retrievers/chunks.ts</code></strong>: Chunk-based retriever</li>
<li><strong><code>src/lib/chat/retrievers/summaries-mongo.ts</code></strong>: Summary-based retriever</li>
<li><strong><code>src/lib/chat/retrievers/metadata-extractor.ts</code></strong>: Metadata extraction</li>
</ul>
<h3 id="reference-modules-chat-common-utilities">Common Utilities<a class="headerlink" href="#reference-modules-chat-common-utilities" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>src/lib/chat/common/prompt.ts</code></strong>: Prompt building utilities</li>
<li><strong><code>src/lib/chat/common/llm.ts</code></strong>: LLM calling utilities</li>
<li><strong><code>src/lib/chat/common/filters.ts</code></strong>: Filter building utilities</li>
<li><strong><code>src/lib/chat/common/question-analyzer.ts</code></strong>: Question analysis for retriever selection</li>
<li><strong><code>src/lib/chat/common/budget.ts</code></strong>: Budget management for source reduction</li>
</ul>
<h3 id="reference-modules-chat-api-routes">API Routes<a class="headerlink" href="#reference-modules-chat-api-routes" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>src/app/api/chat/[libraryId]/stream/route.ts</code></strong>: Chat streaming endpoint</li>
</ul>
<h2 id="reference-modules-chat-exports">Exports<a class="headerlink" href="#reference-modules-chat-exports" title="Permanent link">&para;</a></h2>
<h3 id="reference-modules-chat-types_1">Types<a class="headerlink" href="#reference-modules-chat-types_1" title="Permanent link">&para;</a></h3>
<ul>
<li><code>Chat</code>: Chat conversation interface</li>
<li><code>ChatResponse</code>: Chat response structure</li>
<li><code>ChatProcessingStep</code>: Processing step types</li>
<li><code>RetrieverInput</code>: Retriever input interface</li>
<li><code>RetrieverOutput</code>: Retriever output interface</li>
<li><code>OrchestratorInput</code>: Orchestration input</li>
<li><code>OrchestratorOutput</code>: Orchestration output</li>
</ul>
<h3 id="reference-modules-chat-constants">Constants<a class="headerlink" href="#reference-modules-chat-constants" title="Permanent link">&para;</a></h3>
<ul>
<li><code>AnswerLength</code>: Answer length type and values</li>
<li><code>Retriever</code>: Retriever method type and values</li>
<li><code>TargetLanguage</code>: Target language type and values</li>
<li><code>Character</code>: Character type and values</li>
<li><code>SocialContext</code>: Social context type and values</li>
</ul>
<h3 id="reference-modules-chat-functions">Functions<a class="headerlink" href="#reference-modules-chat-functions" title="Permanent link">&para;</a></h3>
<ul>
<li><code>runChatOrchestrated()</code>: Main orchestration function</li>
<li><code>analyzeQuestionForRetriever()</code>: Question analysis function</li>
<li><code>buildPrompt()</code>: Prompt building function</li>
<li><code>callOpenAI()</code>: LLM calling function</li>
<li><code>getVectorIndexForLibrary(library, chatConfig?)</code>: Get vector index name for library</li>
</ul>
<h2 id="reference-modules-chat-usage-examples">Usage Examples<a class="headerlink" href="#reference-modules-chat-usage-examples" title="Permanent link">&para;</a></h2>
<h3 id="reference-modules-chat-chat-streaming-api-route">Chat Streaming (API Route)<a class="headerlink" href="#reference-modules-chat-chat-streaming-api-route" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// POST /api/chat/[libraryId]/stream</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/chat/library-id/stream&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span>
<span class="w">    </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;What is this library about?&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">answerLength</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ausführlich&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">chatId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;optional-chat-id&#39;</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">});</span>
</code></pre></div>
<h3 id="reference-modules-chat-using-chat-orchestrator">Using Chat Orchestrator<a class="headerlink" href="#reference-modules-chat-using-chat-orchestrator" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">runChatOrchestrated</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/lib/chat/orchestrator&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">runChatOrchestrated</span><span class="p">({</span>
<span class="w">  </span><span class="nx">libraryId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;lib-id&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">question</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;What is this about?&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">retriever</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;chunk&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">chatConfig</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">targetLanguage</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;de&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<h3 id="reference-modules-chat-getting-vector-index-name">Getting Vector Index Name<a class="headerlink" href="#reference-modules-chat-getting-vector-index-name" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">getVectorIndexForLibrary</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/lib/chat/config&#39;</span><span class="p">;</span>

<span class="c1">// Get vector index name for a library</span>
<span class="c1">// Uses config.vectorStore.indexName if set, otherwise derives from library label</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">indexName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getVectorIndexForLibrary</span><span class="p">(</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;lib-id&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">label</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;My Library&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">vectorStore</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">indexName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;custom-index&#39;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// optional chat config</span>
<span class="p">);</span>
</code></pre></div>
<h2 id="reference-modules-chat-dependencies">Dependencies<a class="headerlink" href="#reference-modules-chat-dependencies" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Library System</strong>: Uses <code>@/lib/services/library-service</code> for library access</li>
<li><strong>Database</strong>: Uses <code>@/lib/mongodb-service</code> for chat and query persistence</li>
<li><strong>Storage</strong>: Uses storage providers for file access</li>
<li><strong>External</strong>: Uses OpenAI API for LLM calls, Pinecone for vector search</li>
</ul>
<h2 id="reference-modules-chat-chat-flow">Chat Flow<a class="headerlink" href="#reference-modules-chat-chat-flow" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>Question Analysis</strong>: Analyze question to recommend retriever</li>
<li><strong>Retrieval</strong>: Retrieve relevant sources using selected retriever</li>
<li><strong>Prompt Building</strong>: Build prompt with sources and configuration</li>
<li><strong>LLM Call</strong>: Call OpenAI API with prompt</li>
<li><strong>Response Parsing</strong>: Parse structured response</li>
<li><strong>Logging</strong>: Log query and response for analytics</li>
</ol>
<h2 id="reference-modules-chat-retriever-types">Retriever Types<a class="headerlink" href="#reference-modules-chat-retriever-types" title="Permanent link">&para;</a></h2>
<ul>
<li><strong><code>chunk</code></strong>: Semantic search in Pinecone for specific chunks</li>
<li><strong><code>summary</code></strong>: MongoDB search for document summaries</li>
<li><strong><code>auto</code></strong>: Automatic retriever selection based on question analysis</li>
</ul>
<h2 id="reference-modules-chat-story-mode">Story Mode<a class="headerlink" href="#reference-modules-chat-story-mode" title="Permanent link">&para;</a></h2>
<p>Story mode provides structured topic exploration:
- TOC (Table of Contents) queries
- Structured topic hierarchy
- Narrative exploration of knowledge</p>
<h2 id="reference-modules-chat-configuration-options">Configuration Options<a class="headerlink" href="#reference-modules-chat-configuration-options" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Answer Length</strong>: kurz, mittel, ausführlich, unbegrenzt</li>
<li><strong>Target Language</strong>: de, en, it, fr, es, ar</li>
<li><strong>Character</strong>: Various character perspectives</li>
<li><strong>Social Context</strong>: Formal, informal, technical</li>
<li><strong>Gender Inclusive</strong>: Gender-neutral formulations</li>
</ul></section></section></section>
                    <section class='print-page md-section' id='section-8' heading-number='8'>
                        <h1>Operations<a class='headerlink' href='#section-8' title='Permanent link'></a>
                        </h1>
                    </section></div><style>.print-site-enumerate-headings #index > h1:before { content: '1 ' }

                .print-site-enumerate-headings #index h2:before { content: '1.' counter(counter-index-2) ' ' }
                .print-site-enumerate-headings #index h2 {  counter-reset: counter-index-3 ;  counter-increment: counter-index-2 }
            
                .print-site-enumerate-headings #index h3:before { content: '1.' counter(counter-index-2) '.' counter(counter-index-3) ' ' }
                .print-site-enumerate-headings #index h3 {  counter-increment: counter-index-3 }
            
.print-site-enumerate-headings #section-2 > h1:before { content: '2 ' }
.print-site-enumerate-headings #section-3 > h1:before { content: '3 ' }
.print-site-enumerate-headings #architecture-module-hierarchy > h1:before { content: '3.1 ' }

                .print-site-enumerate-headings #architecture-module-hierarchy h2:before { content: '3.1.' counter(counter-architecture-module-hierarchy-2) ' ' }
                .print-site-enumerate-headings #architecture-module-hierarchy h2 {  counter-increment: counter-architecture-module-hierarchy-2 }
            
.print-site-enumerate-headings #architecture-dependency-graph > h1:before { content: '3.2 ' }

                .print-site-enumerate-headings #architecture-dependency-graph h2:before { content: '3.2.' counter(counter-architecture-dependency-graph-2) ' ' }
                .print-site-enumerate-headings #architecture-dependency-graph h2 {  counter-increment: counter-architecture-dependency-graph-2 }
            
.print-site-enumerate-headings #architecture-shadow-twin > h1:before { content: '3.3 ' }

                .print-site-enumerate-headings #architecture-shadow-twin h2:before { content: '3.3.' counter(counter-architecture-shadow-twin-2) ' ' }
                .print-site-enumerate-headings #architecture-shadow-twin h2 {  counter-increment: counter-architecture-shadow-twin-2 }
            
.print-site-enumerate-headings #architecture-pdf-transformation-phases > h1:before { content: '3.4 ' }

                .print-site-enumerate-headings #architecture-pdf-transformation-phases h2:before { content: '3.4.' counter(counter-architecture-pdf-transformation-phases-2) ' ' }
                .print-site-enumerate-headings #architecture-pdf-transformation-phases h2 {  counter-increment: counter-architecture-pdf-transformation-phases-2 }
            
.print-site-enumerate-headings #section-4 > h1:before { content: '4 ' }
.print-site-enumerate-headings #section-5 > h1:before { content: '5 ' }
.print-site-enumerate-headings #use-cases-index > h1:before { content: '5.1 ' }

                .print-site-enumerate-headings #use-cases-index h2:before { content: '5.1.' counter(counter-use-cases-index-2) ' ' }
                .print-site-enumerate-headings #use-cases-index h2 {  counter-increment: counter-use-cases-index-2 }
            
.print-site-enumerate-headings #use-cases-library-setup > h1:before { content: '5.2 ' }

                .print-site-enumerate-headings #use-cases-library-setup h2:before { content: '5.2.' counter(counter-use-cases-library-setup-2) ' ' }
                .print-site-enumerate-headings #use-cases-library-setup h2 {  counter-increment: counter-use-cases-library-setup-2 }
            
.print-site-enumerate-headings #use-cases-file-transformation-pdf > h1:before { content: '5.3 ' }

                .print-site-enumerate-headings #use-cases-file-transformation-pdf h2:before { content: '5.3.' counter(counter-use-cases-file-transformation-pdf-2) ' ' }
                .print-site-enumerate-headings #use-cases-file-transformation-pdf h2 {  counter-increment: counter-use-cases-file-transformation-pdf-2 }
            
.print-site-enumerate-headings #use-cases-file-transformation-media > h1:before { content: '5.4 ' }

                .print-site-enumerate-headings #use-cases-file-transformation-media h2:before { content: '5.4.' counter(counter-use-cases-file-transformation-media-2) ' ' }
                .print-site-enumerate-headings #use-cases-file-transformation-media h2 {  counter-increment: counter-use-cases-file-transformation-media-2 }
            
.print-site-enumerate-headings #use-cases-web-scraping > h1:before { content: '5.5 ' }

                .print-site-enumerate-headings #use-cases-web-scraping h2:before { content: '5.5.' counter(counter-use-cases-web-scraping-2) ' ' }
                .print-site-enumerate-headings #use-cases-web-scraping h2 {  counter-increment: counter-use-cases-web-scraping-2 }
            
.print-site-enumerate-headings #use-cases-publishing > h1:before { content: '5.6 ' }

                .print-site-enumerate-headings #use-cases-publishing h2:before { content: '5.6.' counter(counter-use-cases-publishing-2) ' ' }
                .print-site-enumerate-headings #use-cases-publishing h2 {  counter-increment: counter-use-cases-publishing-2 }
            
.print-site-enumerate-headings #use-cases-chat-exploration > h1:before { content: '5.7 ' }

                .print-site-enumerate-headings #use-cases-chat-exploration h2:before { content: '5.7.' counter(counter-use-cases-chat-exploration-2) ' ' }
                .print-site-enumerate-headings #use-cases-chat-exploration h2 {  counter-increment: counter-use-cases-chat-exploration-2 }
            
.print-site-enumerate-headings #use-cases-batch-operations > h1:before { content: '5.8 ' }

                .print-site-enumerate-headings #use-cases-batch-operations h2:before { content: '5.8.' counter(counter-use-cases-batch-operations-2) ' ' }
                .print-site-enumerate-headings #use-cases-batch-operations h2 {  counter-increment: counter-use-cases-batch-operations-2 }
            
.print-site-enumerate-headings #section-6 > h1:before { content: '6 ' }
.print-site-enumerate-headings #section-6-7 > h1:before { content: '6.7 ' }
.print-site-enumerate-headings #section-7 > h1:before { content: '7 ' }
.print-site-enumerate-headings #reference-file-index > h1:before { content: '7.1 ' }

                .print-site-enumerate-headings #reference-file-index h2:before { content: '7.1.' counter(counter-reference-file-index-2) ' ' }
                .print-site-enumerate-headings #reference-file-index h2 {  counter-increment: counter-reference-file-index-2 }
            
.print-site-enumerate-headings #section-7-2 > h1:before { content: '7.2 ' }
.print-site-enumerate-headings #reference-modules-library > h1:before { content: '7.2.1 ' }

.print-site-enumerate-headings #reference-modules-storage > h1:before { content: '7.2.2 ' }

.print-site-enumerate-headings #reference-modules-chat > h1:before { content: '7.2.3 ' }

.print-site-enumerate-headings #section-8 > h1:before { content: '8 ' }</style>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "/docs/", "features": [], "search": "assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.50899def.min.js"></script>
      
        <script src="js/print-site.js"></script>
      
        <script src="https://unpkg.com/mermaid@10.9.1/dist/mermaid.min.js"></script>
      
        <script src="assets/javascripts/mermaid-init.js"></script>
      
    
  </body>
</html>