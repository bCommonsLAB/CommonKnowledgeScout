
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="http://localhost:3000/docs/_history/08_august/cursor_2025.08.24_wir_haben_hier_in_der_library_di.html">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Wir haben hier in der Library dieses PDF-Verzeichnis verarbeiten, das - Common Knowledge Scout</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/print-site.css">
    
      <link rel="stylesheet" href="../../css/print-site-material.css">
    
      <link rel="stylesheet" href="../../assets/stylesheets/print.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#wir-haben-hier-in-der-library-dieses-pdf-verzeichnis-verarbeiten-das" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Common Knowledge Scout" class="md-header__button md-logo" aria-label="Common Knowledge Scout" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Common Knowledge Scout
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Wir haben hier in der Library dieses PDF-Verzeichnis verarbeiten, das
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/bCommonsLAB/CommonKnowledgeScout" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Common Knowledge Scout" class="md-nav__button md-logo" aria-label="Common Knowledge Scout" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Common Knowledge Scout
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/bCommonsLAB/CommonKnowledgeScout" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Overview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/intro.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Intro
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/features.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Features
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/architecture.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/core-components.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Core Components
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/setup.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/getting-started.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/settings.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Settings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/library.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using the Library
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/event-monitor.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Event Monitor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/batch-session-import.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Batch Session Import
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/troubleshooting.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/faq.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Concepts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/storage-provider.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Storage Provider
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/localstorage.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FileSystem (Local)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/image-transformation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Image Transformation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/pdf/extraction-methods.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PDF Extraction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/metadata.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metadata
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_7" >
        
          
          <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Library
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            Library
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/overview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/global-state.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Global State
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/header.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Header
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/breadcrumb.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Breadcrumb
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/file-tree.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FileTree
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/file-list.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FileList
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/upload.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upload
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/file-preview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FilePreview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/transcription.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transcription
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/transform.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transform
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/batch-transcription.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Batch Transcription
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/error-handling-logging-testing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Error Handling & Tests
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/initialization-sequence.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Initialization
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/components.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Library Components
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/features/shadowtwins.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shadow-Twin
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/features/extended-shadowtwin.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Extended Shadow-Twin
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/features/transformation-service.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transformation Service
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/video-transformation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Video Transformation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/glossary.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api/secretary-services.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Secretary Services
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api/track-processor.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Track Processor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chat-response-generation-process.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chat & Story Mode
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Operations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Operations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ops/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ops/deployment/docker.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ops/desktop/quick-setup.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Electron Quick Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ops/desktop/package-strategy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Electron Package Strategy
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#erkennung-von-shadow-twins" class="md-nav__link">
    <span class="md-ellipsis">
      Erkennung von „Shadow Twins“
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-varianten-verarbeitung" class="md-nav__link">
    <span class="md-ellipsis">
      Pipeline-Varianten (Verarbeitung)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-design-nextjs-app-router" class="md-nav__link">
    <span class="md-ellipsis">
      API-Design (Next.js App Router)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uinavigation" class="md-nav__link">
    <span class="md-ellipsis">
      UI/Navigation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extraktion-und-sanitization" class="md-nav__link">
    <span class="md-ellipsis">
      Extraktion und Sanitization
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#idempotenz-upsert-versionierung" class="md-nav__link">
    <span class="md-ellipsis">
      Idempotenz, Upsert, Versionierung
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sicherheit-und-auth" class="md-nav__link">
    <span class="md-ellipsis">
      Sicherheit und Auth
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tests-pflicht" class="md-nav__link">
    <span class="md-ellipsis">
      Tests (Pflicht)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schrittweise-einfuhrung" class="md-nav__link">
    <span class="md-ellipsis">
      Schrittweise Einführung
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#offene-punkte-entscheidungen" class="md-nav__link">
    <span class="md-ellipsis">
      Offene Punkte / Entscheidungen
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kurzfazit-kritisch" class="md-nav__link">
    <span class="md-ellipsis">
      Kurzfazit (kritisch)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#erkennung-und-metadaten" class="md-nav__link">
    <span class="md-ellipsis">
      Erkennung und Metadaten
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-varianten" class="md-nav__link">
    <span class="md-ellipsis">
      Pipeline-Varianten
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-entwurfe-nextjs-app-router" class="md-nav__link">
    <span class="md-ellipsis">
      API-Entwürfe (Next.js App Router)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uinavigation_1" class="md-nav__link">
    <span class="md-ellipsis">
      UI/Navigation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sicherheit-qualitat-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Sicherheit, Qualität, Tests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#empfohlenes-template-robust-secretary-kompatibel" class="md-nav__link">
    <span class="md-ellipsis">
      Empfohlenes Template (robust, Secretary-kompatibel)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variante-strikt-mit-schema-validierungshinweis" class="md-nav__link">
    <span class="md-ellipsis">
      Variante „strikt“ mit Schema-Validierungshinweis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#einbindung-in-transformservicetransformtext" class="md-nav__link">
    <span class="md-ellipsis">
      Einbindung in TransformService.transformText
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zielablauf-vereinfacht" class="md-nav__link">
    <span class="md-ellipsis">
      Zielablauf (vereinfacht)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#frontmatter-beispiel-vereinheitlicht" class="md-nav__link">
    <span class="md-ellipsis">
      Frontmatter-Beispiel (vereinheitlicht)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validierungsschema-zod-und-parser" class="md-nav__link">
    <span class="md-ellipsis">
      Validierungsschema (Zod) und Parser
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#server-upsert-logik-kern" class="md-nav__link">
    <span class="md-ellipsis">
      Server: Upsert-Logik (Kern)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-route-post-apiwebpublish" class="md-nav__link">
    <span class="md-ellipsis">
      API-Route POST /api/web/publish
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-verzeichnis-veroffentlichen-dialog" class="md-nav__link">
    <span class="md-ellipsis">
      Client: „Verzeichnis veröffentlichen“-Dialog
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#edge-cases" class="md-nav__link">
    <span class="md-ellipsis">
      Edge-Cases
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="wir-haben-hier-in-der-library-dieses-pdf-verzeichnis-verarbeiten-das">Wir haben hier in der Library dieses PDF-Verzeichnis verarbeiten, das<a class="headerlink" href="#wir-haben-hier-in-der-library-dieses-pdf-verzeichnis-verarbeiten-das" title="Permanent link">&para;</a></h1>
<p><em>Exported on 8/30/2025 at 11:43:52 GMT+2 from Cursor (1.5.5)</em></p>
<hr />
<p><strong>User</strong></p>
<p>Wir haben hier in der Library dieses PDF-Verzeichnis verarbeiten, das eine Verzeichnisstruktur durchsucht und PDF-Dateien transkliniert und Markdown-Dateien speichert. Ich möchte parallel dazu jetzt eine ähnliche Funktion bauen, die da heißt Verzeichnis veröffentlichen, das in ähnlicher Manier Markdown-Dateien sucht, praktisch Shadow Trims zu PDF von anderen Medien und diese Markdown-Dateien in eine MongoDB Collection absortet. Und diese dort ablegt. Und in diese Collections sollten dann eine Art Wiki werden fürs Web. Wo ich einfach ein Bild, eine Summary von dem Markdown-Dokument habe. Einen Titel, einen treffenden Kurztitel. Auf einer ersten Seite eine in der Übersichtsliste, da ich da einen Dreizeiler habe. Und wenn ich auf eine Detailseite gehe, dann eben eine Summary habe, eine schöne Zusammenfassung. Und natürlich den originalen Link zum originalen Dokument und auch dieses Markdown aus dem Dokumen@library-header.tsx @pdf-bulk-import-dialog.tsx </p>
<p>können wir das mal konzipieren?
Datenmodell
und neuen Hauptmenüpunkt "Web"
wie könnte das aussehen?</p>
<hr />
<p><strong>Cursor</strong></p>
<p>Ich lege eine Design-Notiz unter <code>docs/_analysis/wiki-publish-design.md</code> an, die Datenmodell, Varianten, API- und UI-Konzept (inkl. neuem Menüpunkt „Web“) präzise beschreibt. Anschließend skizziere ich die wichtigsten Interfaces und Flows.</p>
<div class="highlight"><pre><span></span><code><span class="gu">## Verzeichnis veröffentlichen – Konzeption für Wiki-/Web-Publishing</span>

Ziel: Aus bereits erzeugten Markdown-„Shadow Twins“ (z. B. <span class="sb">`*.de.md`</span>) ein öffentliches, durchsuchbares Wiki erzeugen. Die Markdown-Dateien werden identifiziert, mit Metadaten (Titel, Kurz-Titel, Summary, Cover-Bild, Original-Link) angereichert und als Einträge in MongoDB gespeichert. Frontend liefert eine Übersicht (dreizeiliger Teaser) und Detailseiten mit Summary, Link zum Original und vollem Markdown.

<span class="gu">### Anforderungen</span>
<span class="k">-</span><span class="w"> </span>Funktional
<span class="w">  </span><span class="k">-</span><span class="w"> </span>Scan eines Wurzelordners (wie beim PDF-Dialog), rekursiv.
<span class="w">  </span><span class="k">-</span><span class="w"> </span>Identifikation von Markdown-Shadow-Twins zu Originaldokumenten (Namensschema, Metadaten).
<span class="w">  </span><span class="k">-</span><span class="w"> </span>Erzeugung von stabilen <span class="sb">`slug`</span>s und Kurz-Titeln; Mehrsprachigkeit (z. B. <span class="sb">`*.de.md`</span>).
<span class="w">  </span><span class="k">-</span><span class="w"> </span>Extraktion von: Titel, Summary (3–5 Sätze oder ~320 Zeichen), Teaser (3 Zeilen), Cover (erstes Bild), Original-Link.
<span class="w">  </span><span class="k">-</span><span class="w"> </span>Idempotentes „Publish“ (Re-Run überschreibt/aktualisiert denselben Eintrag statt Duplikat).
<span class="w">  </span><span class="k">-</span><span class="w"> </span>API-Endpunkte zum Enqueue/Publish sowie zum Listen/Lesen.
<span class="w">  </span><span class="k">-</span><span class="w"> </span>Öffentliche Web-Ansicht: Übersicht, Detail, Suche/Filter.
<span class="k">-</span><span class="w"> </span>Nicht-funktional
<span class="w">  </span><span class="k">-</span><span class="w"> </span>Typensichere Schemas (Zod + Interfaces), strikte TS.
<span class="w">  </span><span class="k">-</span><span class="w"> </span>Indizes für schnelle Queries (slug, lang, libraryId, tags).
<span class="w">  </span><span class="k">-</span><span class="w"> </span>Sanitisierung von HTML beim Rendern; sichere Markdown-Pipeline.
<span class="w">  </span><span class="k">-</span><span class="w"> </span>Geringe Laufzeitlast beim Scan (paginierte/gestreamte Verarbeitung optional).

---

<span class="gu">### Datenmodell (MongoDB)</span>

Collection: <span class="sb">`wiki_entries`</span>

Sinnvolle Minimalfelder (alle strikt typisiert und validiert):

```ts
export interface WikiEntry {
  _id: string;                      // Mongo ObjectId als String (serverseitig)
  libraryId: string;                // Zuordnung zur aktiven Library
  sourceItemId: string;             // Storage-Item-ID des Originaldokuments (wenn vorhanden)
  sourcePath: string;               // Vollständiger Pfad im Storage (rekonstruiert)
  originalUrl?: string;             // Deeplink zurück ins Library-UI
  lang: string;                     // z. B. &quot;de&quot;, &quot;en&quot;

  title: string;                    // Aus Frontmatter/H1/Dateiname
  shortTitle: string;               // Knapp, UI-tauglich (~30–40 Zeichen)
  slug: string;                     // Eindeutig pro (libraryId, lang)
  summary: string;                  // 3–5 Sätze oder ~320 Zeichen
  teaser: string;                   // Dreizeiler für Karten/Listen

  coverImageUrl?: string;           // Erstes Bild im Markdown oder generiert
  tags: string[];                   // Aus Frontmatter/Heuristik
  authors?: string[];               // Optional, aus Frontmatter

  markdown: string;                 // Voller Markdown-Inhalt
  wordCount: number;                // Heuristik
  readingTimeMinutes: number;       // Heuristik (z. B. 200 WpM)

  status: &#39;draft&#39; | &#39;published&#39;;
  version: number;                  // Hochzählen bei Re-Publish
  checksum: string;                 // Hash über Markdown + relevante Metadaten (Idempotenz)

  createdAt: string;                // ISO
  updatedAt: string;                // ISO
}
</code></pre></div>
<p>Indizes:
- <code>{ libraryId: 1, lang: 1, slug: 1 }</code> unique
- <code>{ libraryId: 1, updatedAt: -1 }</code>
- <code>{ tags: 1 }</code></p>
<p>Checksum-Strategie:
- SHA-256 über <code>markdown</code> + <code>title</code> + <code>lang</code> + optional <code>sourceItemId</code>.
- Bei identischer Checksum: nur <code>updatedAt</code> anpassen, kein Versionsbump.</p>
<p>Kurz-Titel/Slug:
- <code>shortTitle</code>: heuristisch aus Titel (Trunkierung bei ~40 Zeichen, Wortgrenzen, Suffix-Entfernung wie „- v2“).
- <code>slug</code>: <code>kebab-case</code> aus <code>shortTitle</code> + Kollisionen über Zähler lösen (<code>slug</code>, <code>slug-2</code>, ...). Uniqueness per Index.</p>
<p>Cover-Bild:
- Erstes Markdown-Bild <code>![](url)</code> als <code>coverImageUrl</code>.
- Fallback: generiertes OG-Image (später), oder leer lassen.</p>
<hr />
<h3 id="erkennung-von-shadow-twins">Erkennung von „Shadow Twins“<a class="headerlink" href="#erkennung-von-shadow-twins" title="Permanent link">&para;</a></h3>
<p>Namenskonventionen:
- <code>name.&lt;lang&gt;.md</code> (z. B. <code>bericht.de.md</code>) → <code>lang = de</code>, Basename = <code>bericht</code>.
- Alternativ: <code>name.md</code> mit Frontmatter <code>lang</code>.</p>
<p>Zugehörigkeit zum Original:
- Gleicher Ordner wie Original-PDF oder verlinkt über <code>sourceItemId</code> in Frontmatter.
- Für die erste Phase reicht: Ablage neben dem PDF und Ableitung über Basename.</p>
<p>Frontmatter (optional):
- Unterstützt <code>title</code>, <code>shortTitle</code>, <code>tags</code>, <code>authors</code>, <code>originalUrl</code>, <code>lang</code>.
- Frontmatter überschreibt Heuristiken.</p>
<hr />
<h3 id="pipeline-varianten-verarbeitung">Pipeline-Varianten (Verarbeitung)<a class="headerlink" href="#pipeline-varianten-verarbeitung" title="Permanent link">&para;</a></h3>
<p>1) Direkt in API (synchron, sequentiell)
- Client scannt, sendet pro Markdown-Datei <code>POST /api/web/publish</code>.
- API extrahiert Metadaten, persistiert; UI zeigt Fortschritt.
- Pros: Einfach, wenig Infrastruktur. Cons: Längere Requests, weniger robust.</p>
<p>2) Job-Queue (empfohlen, integriert in bestehende External-Jobs)
- Client enqueued Items (ähnlich PDF-Flow). Worker verarbeitet nacheinander.
- Pros: Robust, throttling, Retry, Logging. Cons: Etwas mehr Setup.</p>
<p>3) Batch-Import (Server-initiierter Scan)
- <code>POST /api/web/publish-folder</code> triggert serverseitigen rekursiven Scan + Batch-Inserts.
- Pros: Sehr schnell. Cons: Serverlast/Timeouts, weniger feingranulares Feedback.</p>
<p>Empfehlung: Start mit (2) Job-Queue. UI bleibt responsiv, Re-Runs sind idempotent, Logging/Fehlerbehandlung konsistent mit PDF-Prozess.</p>
<pre class="mermaid"><code>flowchart TD
  A[Client: PublishFolderDialog] --&gt;|scan md| B(Enqueue per Datei)
  B --&gt; C[API /api/web/publish]
  C --&gt; D[Job angelegt]
  D --&gt; E[Worker: Parse MD]
  E --&gt; F[Extract meta + compute checksum]
  F --&gt; G[Upsert in wiki_entries]
  G --&gt; H[UI/"Web" liest aus DB]</code></pre>
<hr />
<h3 id="api-design-nextjs-app-router">API-Design (Next.js App Router)<a class="headerlink" href="#api-design-nextjs-app-router" title="Permanent link">&para;</a></h3>
<ul>
<li><code>POST /api/web/publish</code></li>
<li>Headers: <code>X-Library-Id</code>, Auth via Clerk</li>
<li>Body (FormData oder JSON): <code>{ markdownFile, path, sourceItemId?, originalUrl? }</code></li>
<li>
<p>Ergebnis: <code>{ ok: true, entryId, slug, status }</code></p>
</li>
<li>
<p><code>POST /api/web/publish-folder</code> (optional, wenn serverseitiger Scan gewünscht)</p>
</li>
<li>Headers: <code>X-Library-Id</code></li>
<li>Body: <code>{ rootFolderId, ignoreExisting: boolean }</code></li>
<li>
<p>Ergebnis: <code>{ ok: true, enqueued: number }</code></p>
</li>
<li>
<p><code>GET /api/web/entries?query=&amp;tag=&amp;lang=&amp;page=&amp;limit=</code></p>
</li>
<li>
<p>Für UI-Listen (RSC konsumierbar).</p>
</li>
<li>
<p><code>GET /api/web/entries/[slug]?lang=de</code></p>
</li>
<li>Detail-Abruf.</li>
</ul>
<p>Antwortschema (typisiert, standardisiert):
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">ApiList</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">items</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="p">[];</span><span class="w"> </span><span class="nx">total</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span><span class="w"> </span><span class="nx">page</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span><span class="w"> </span><span class="nx">limit</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="p">}</span>
<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">ApiResult</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ok</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ok</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span>
</code></pre></div></p>
<hr />
<h3 id="uinavigation">UI/Navigation<a class="headerlink" href="#uinavigation" title="Permanent link">&para;</a></h3>
<ul>
<li>Neuer Hauptmenüpunkt: „Web“</li>
<li>Route: <code>/web</code></li>
<li>Übersicht: Karten-Layout (cover, shortTitle, teaser, tags). Suche/Filter (nuqs).</li>
<li>
<p>Detail: <code>/web/[slug]</code> – Title, Summary, Cover, Original-Link, Render des Markdown (serverseitig, sanitized), Tags.</p>
</li>
<li>
<p>Neuer Dialog analog <code>PdfBulkImportDialog</code>: <code>PublishFolderDialog</code></p>
</li>
<li>Komponente: <code>src/components/library/publish-folder-dialog.tsx</code></li>
<li>
<p>Funktionen:</p>
<ul>
<li>Rekursiver Scan nach <code>*.md</code> (optional Filter <code>*.{de,en,fr,es,it}.md</code>).</li>
<li>Erkennen bereits veröffentlichter Einträge (per Checksum/Slug) → „Ignorieren“.</li>
<li>Vorschau (max. 10) mit relativem Pfad, Name.</li>
<li>Optionen: <code>ignoreExisting</code>, Standardsprache, Tags-Default.</li>
<li>Aktion: „Einträge veröffentlichen (N)“ → enqueue <code>POST /api/web/publish</code>.</li>
</ul>
</li>
<li>
<p>Library-Header-Erweiterung</p>
</li>
<li>Button „Verzeichnis veröffentlichen“ (Icon: <code>Globe</code> o. ä.), öffnet <code>PublishFolderDialog</code>.</li>
</ul>
<p>Komponentenstruktur (Vorschlag):
- <code>src/app/web/page.tsx</code> (RSC) – Liste mit Server-Abfrage
- <code>src/app/web/[slug]/page.tsx</code> (RSC) – Detail mit Server-Abfrage
- <code>src/components/web/wiki-card.tsx</code> – Karte/Teaser
- <code>src/components/web/wiki-list.tsx</code> – Listengrid + Paginierung
- <code>src/components/web/wiki-detail.tsx</code> – Detail-Layout</p>
<hr />
<h3 id="extraktion-und-sanitization">Extraktion und Sanitization<a class="headerlink" href="#extraktion-und-sanitization" title="Permanent link">&para;</a></h3>
<p>Reihenfolge für <code>title</code>/<code>summary</code>/<code>teaser</code>:
1. YAML-Frontmatter (falls vorhanden)
2. H1-Überschrift
3. Dateiname als Fallback</p>
<p><code>summary</code>:
- Erste 1–2 Absätze, bereinigt (ohne Bilder/Links), auf ~320 Zeichen begrenzen, Satzende respektieren.</p>
<p><code>teaser</code> (dreizeilig):
- Aus <code>summary</code>, Hart-Umbruch für UI (CSS <code>line-clamp-3</code>).</p>
<p>Sanitization:
- Markdown → HTML via <code>remark/rehype</code> auf dem Server, mit <code>rehype-sanitize</code>.
- Bilder/Links whitelisten, <code>target=_blank</code>-Policy, rel-Attribute.</p>
<hr />
<h3 id="idempotenz-upsert-versionierung">Idempotenz, Upsert, Versionierung<a class="headerlink" href="#idempotenz-upsert-versionierung" title="Permanent link">&para;</a></h3>
<ul>
<li>Einzigartigkeit: <code>(libraryId, lang, slug)</code>.</li>
<li>Upsert-Logik:</li>
<li>Gleicher <code>slug</code> + <code>lang</code> + <code>libraryId</code>: <ul>
<li>Wenn <code>checksum</code> gleich → kein Versionsbump, nur <code>updatedAt</code>.</li>
<li>Sonst: <code>version++</code>, Felder aktualisieren.</li>
</ul>
</li>
</ul>
<hr />
<h3 id="sicherheit-und-auth">Sicherheit und Auth<a class="headerlink" href="#sicherheit-und-auth" title="Permanent link">&para;</a></h3>
<ul>
<li>Schreiben (Publish): Clerk-geschützte Routen, nur Rollen: Admin/Editor.</li>
<li>Lesen (Web): öffentlich oder per Feature-Flag. Nie Secrets leaken.</li>
<li>CSP und XSS-Schutz bei Markdown-Rendering strikt.</li>
</ul>
<hr />
<h3 id="tests-pflicht">Tests (Pflicht)<a class="headerlink" href="#tests-pflicht" title="Permanent link">&para;</a></h3>
<ul>
<li>Unit</li>
<li>Parser: Frontmatter/H1/Absatz-Erkennung, Slug/Kurz-Titel, Summary/Teaser.</li>
<li>Checksum/Idempotenz.</li>
<li>
<p>Sanitization-Pipeline (Whitelist). </p>
</li>
<li>
<p>Integration</p>
</li>
<li><code>POST /api/web/publish</code> mit Beispiel-Markdown (mit/ohne Frontmatter).</li>
<li>Upsert-Szenarien (gleich/verschieden Checksum).</li>
<li>
<p>Listen- und Detail-Endpunkte.</p>
</li>
<li>
<p>E2E (Playwright)</p>
</li>
<li>Übersicht lädt, Such-/Filter-Interaktion (nuqs) funktioniert.</li>
<li>Detail zeigt Summary, Cover, Original-Link, Markdown-Render ohne XSS.</li>
</ul>
<p>Abdeckungsschwellen gem. Projektvorgaben einhalten.</p>
<hr />
<h3 id="schrittweise-einfuhrung">Schrittweise Einführung<a class="headerlink" href="#schrittweise-einfuhrung" title="Permanent link">&para;</a></h3>
<ol>
<li>Datenmodell + Repo-Funktionen (Insert/Upsert + Indizes)</li>
<li><code>POST /api/web/publish</code> (einzeln), einfacher Worker/Job-Integration</li>
<li><code>PublishFolderDialog</code> + Button im Library-Header</li>
<li><code>/web</code> Übersicht + <code>/web/[slug]</code> Detail (RSC)</li>
<li>Suche/Filter/Tags + SEO/OG-Metadaten</li>
</ol>
<hr />
<h3 id="offene-punkte-entscheidungen">Offene Punkte / Entscheidungen<a class="headerlink" href="#offene-punkte-entscheidungen" title="Permanent link">&para;</a></h3>
<ul>
<li>Mehrsprachige Konsolidierung (ein Slug über mehrere <code>lang</code> oder getrennte Slugs?)</li>
<li>OG-Image-Generator (später)</li>
<li>Volltextsuche (Mongo Text-Index vs. externe Suche)</li>
<li>Rechte/ACL auf Einträge (öffentlich vs. intern)</li>
</ul>
<hr />
<h3 id="kurzfazit-kritisch">Kurzfazit (kritisch)<a class="headerlink" href="#kurzfazit-kritisch" title="Permanent link">&para;</a></h3>
<ul>
<li>Variante mit Job-Queue ist robust und deckt sich mit bestehendem PDF-Flow.</li>
<li>Datenmodell ist minimal, aber erweiterbar (Versionierung, Tags, Autoren).</li>
<li>Risiken liegen primär in konsistenter Erkennung der Shadow Twins und sicherem Markdown-Rendering. Tests und Idempotenz-Checks mitigieren das.</li>
</ul>
<div class="highlight"><pre><span></span><code>Ich habe die Design-Notiz erstellt: `docs/_analysis/wiki-publish-design.md`. Als Nächstes skizziere ich Datenmodell, API und UI inkl. Hauptmenü „Web“ kurz und präzise.

### Zielbild
- Verzeichnis rekursiv scannen, Markdown-Shadow-Twins (z. B. name.de.md) erkennen, Metadaten extrahieren, Einträge als Wiki in MongoDB speichern.
- UI: Übersicht mit Teasern (dreizeilig), Detail mit Summary, Cover, Link zum Original und vollem Markdown.

### Datenmodell (MongoDB)
- Collection: `wiki_entries`
- Kerneigenschaften: Stabiler `slug` je `libraryId+lang`, `summary` (~320 Zeichen), `teaser` (dreizeilig), `coverImageUrl` (erstes Bild), `originalUrl`, Versionierung und `checksum` für Idempotenz.
- Indizes: unique `(libraryId, lang, slug)`, `(libraryId, updatedAt)`, `(tags)`.

Kurzform Interface:
```ts
export interface WikiEntry {
  _id: string;
  libraryId: string;
  sourceItemId: string;
  sourcePath: string;
  originalUrl?: string;
  lang: string;
  title: string;
  shortTitle: string;
  slug: string;
  summary: string;
  teaser: string;
  coverImageUrl?: string;
  tags: string[];
  authors?: string[];
  markdown: string;
  wordCount: number;
  readingTimeMinutes: number;
  status: &#39;draft&#39; | &#39;published&#39;;
  version: number;
  checksum: string;
  createdAt: string;
  updatedAt: string;
}
</code></pre></div>
<h3 id="erkennung-und-metadaten">Erkennung und Metadaten<a class="headerlink" href="#erkennung-und-metadaten" title="Permanent link">&para;</a></h3>
<ul>
<li>Shadow-Twins: <code>name.&lt;lang&gt;.md</code> oder Frontmatter <code>lang</code>.</li>
<li>Metadaten-Priorität: Frontmatter → H1 → Dateiname.</li>
<li><code>shortTitle</code>: heuristisch aus Titel (trunkiert ~40 Zeichen).</li>
<li><code>slug</code>: kebab-case + Kollisionen mit Zähler lösen.</li>
<li><code>summary</code>: 1–2 Absätze, ~320 Zeichen, satzbasiert.</li>
<li><code>teaser</code>: aus <code>summary</code>, UI-geklemmt (line-clamp-3).</li>
<li><code>coverImageUrl</code>: erstes Bild im Markdown; Fallback später.</li>
</ul>
<h3 id="pipeline-varianten">Pipeline-Varianten<a class="headerlink" href="#pipeline-varianten" title="Permanent link">&para;</a></h3>
<ul>
<li>Variante 1 (einfach): Client schickt jede Datei direkt an <code>/api/web/publish</code> (synchron).</li>
<li>Variante 2 (empfohlen): Enqueue pro Datei, Worker verarbeitet nacheinander (robust, idempotent, Logging).</li>
<li>Variante 3 (Batch): Serverseitiger Scan + Bulk-Import.
Hinweis: Wir haben die drei Varianten detailliert in der Notiz dokumentiert und empfehlen v2 (Job-Queue).</li>
</ul>
<h3 id="api-entwurfe-nextjs-app-router">API-Entwürfe (Next.js App Router)<a class="headerlink" href="#api-entwurfe-nextjs-app-router" title="Permanent link">&para;</a></h3>
<ul>
<li>POST <code>/api/web/publish</code> – Body: Datei/JSON mit Pfad, Sprache, optional <code>sourceItemId</code>, <code>originalUrl</code>. Antwort: <code>{ ok, entryId, slug }</code>.</li>
<li>GET <code>/api/web/entries?query=&amp;tag=&amp;lang=&amp;page=&amp;limit=</code> – Liste für Übersicht.</li>
<li>GET <code>/api/web/entries/[slug]?lang=de</code> – Detailabruf.</li>
<li>Optional: POST <code>/api/web/publish-folder</code> – serverseitiger Scan/Enqueue.</li>
</ul>
<h3 id="uinavigation_1">UI/Navigation<a class="headerlink" href="#uinavigation_1" title="Permanent link">&para;</a></h3>
<ul>
<li>Neuer Hauptmenüpunkt: „Web“</li>
<li>Route <code>app/web/page.tsx</code> (RSC): Kartenliste (cover, <code>shortTitle</code>, <code>teaser</code>, tags), Suche/Filter via <code>nuqs</code>.</li>
<li>Route <code>app/web/[slug]/page.tsx</code> (RSC): Detail mit Title, Summary, Cover, Original-Link, sanitiziertes Markdown.</li>
<li>Neuer Dialog analog PDF: <code>src/components/library/publish-folder-dialog.tsx</code></li>
<li>Scan nach <code>*.md</code>, Sprache wählen, „Ignoriere vorhandene“ (per <code>checksum/slug</code>), Vorschau (10 Einträge), „Veröffentlichen (N)“ → enqueued POSTs.</li>
<li><code>src/components/library/library-header.tsx</code>: zusätzlicher Button „Verzeichnis veröffentlichen“ neben „PDF-Verzeichnis verarbeiten“, öffnet den neuen Dialog.</li>
</ul>
<h3 id="sicherheit-qualitat-tests">Sicherheit, Qualität, Tests<a class="headerlink" href="#sicherheit-qualitat-tests" title="Permanent link">&para;</a></h3>
<ul>
<li>Auth: Clerk-geschützte Schreibrouten (Admin/Editor).</li>
<li>Sanitization: Serverseitige Markdown→HTML-Pipeline mit <code>rehype-sanitize</code>.</li>
<li>Tests (Vitest/Playwright): Parser/Heuristiken, Idempotenz/Upsert, API-Integration, UI-Listen/Details ohne XSS.</li>
</ul>
<p>Nächste Schritte (minimal-invasiv):
- Schema/Repo-Funktionen und Indizes für <code>wiki_entries</code>.
- POST <code>/api/web/publish</code> (Upsert mit <code>checksum</code>, Versionierung).
- <code>publish-folder-dialog.tsx</code> + Button im <code>library-header.tsx</code>.
- <code>/web</code> Übersicht und <code>/web/[slug]</code> Detail (RSC).
Soll ich mit Schritt 1–2 starten (Schema + Publish-API) und anschließend den Dialog einhängen?</p>
<ul>
<li>Ich habe die Konzeption als <code>docs/_analysis/wiki-publish-design.md</code> abgelegt und die drei Pipeline-Varianten bewertet.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">WikiEntry</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">libraryId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">sourceItemId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">sourcePath</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">originalUrl?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">lang</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">shortTitle</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">slug</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">summary</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">teaser</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">coverImageUrl?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">tags</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[];</span>
<span class="w">  </span><span class="nx">authors?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[];</span>
<span class="w">  </span><span class="nx">markdown</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">wordCount</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">readingTimeMinutes</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;draft&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;published&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">checksum</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<p><strong>User</strong></p>
<p>Ich möchte da diese Auswertung der Markdown Shadow Twins mit unserer eigenen Templateverarbeitung bewerkstelligen. Ich kann ja über ein Template genau bestimmen, welche Parameter ich von einem Text generieren möchte, oder extrahieren möchte, oder transformieren möchte. So möchte ich den Titel, den Short-Title, Slug Summary und Teaser, Text und Autors und die Mark-Word-Count mit dieser Template-Logik, also Secretary Service, berechnen und das Ergebnis dann im MongoDB Datenmodell speichern. Alle anderen Parameter können wir aus den sonstigen Variablen rekonstruieren.@transform-service.ts Wie könnte so ein Template aussehen?</p>
<hr />
<p><strong>Cursor</strong></p>
<p>Kurze Einordnung: Wir sollten die Extraktion strikt strukturiert und deterministisch halten. Der Secretary-Template-Prompt muss das Modell erzwingen, ausschließlich valides JSON in exakt vorgegebenem Schema auszugeben. „Teaser“ und „Summary“ sind inhaltlich verwandt, aber mit unterschiedlichen Längen/Intentionen (Teaser: Listing-geeignet, nicht identisch). Slug-Regeln, Längenlimits und ASCII-Normalisierung gehören in den Prompt. Wortanzahl und Autoren übernehmen wir ebenfalls aus dem Template-Output; alle übrigen Felder (libraryId, sourceItemId, originalUrl, Pfad) rekonstruieren wir serverseitig.</p>
<p>Risiken: LLM-Output driftet schnell ins Freiform-Format. Dem begegnen wir mit strengen I/O-Anweisungen (JSON-only), einem eingebauten Schema und „fencing“ (MARKDOWN-Block). Frontmatter im Markdown muss entfernt werden, bevor „text“ gezählt wird. Für Sprachen/Slug gilt: klare Regeln und Limits, samt Fallback, wenn eine Regel nicht erfüllbar ist. Wir validieren anschließend serverseitig (Zod), rechnen bei Bedarf <code>readingTimeMinutes</code> lokal und erzwingen Idempotenz per <code>checksum</code>.</p>
<p>Drei Varianten:
- Minimal: Ein Template ohne Few-Shot, rein Schema + Regeln (schnell, aber anfälliger).
- Robust: Mit JSON-Schema-Block, harten Constraints, negativen Beispielen; empfohlen.
- Strikt: Zusätzlicher „do not output anything else“-Block und Beispiel-Ein/Ausgabe; maximal robust, etwas längerer Prompt.</p>
<h3 id="empfohlenes-template-robust-secretary-kompatibel">Empfohlenes Template (robust, Secretary-kompatibel)<a class="headerlink" href="#empfohlenes-template-robust-secretary-kompatibel" title="Permanent link">&para;</a></h3>
<p>Verwende Platzhalter, die du beim Aufruf ersetzen kannst: <code>{{targetLanguage}}</code>, <code>{{fileName}}</code>, <code>{{maxSummaryChars}}</code>, <code>{{maxTeaserChars}}</code>. Der Markdown-Inhalt wird im Block <code>&lt;&lt;&lt;MARKDOWN</code> eingeschlossen.</p>
<div class="highlight"><pre><span></span><code>You are a precise information extraction model.

TASK
From the given Markdown document, extract a WikiEntry JSON with fields:
- title: string
- shortTitle: string (&lt;= 40 chars, readable, no trailing punctuation)
- slug: string (lowercase, kebab-case, ASCII only, &lt;= 80 chars; collapse whitespace/dashes)
- summary: string (1–2 sentences, &lt;= {{maxSummaryChars}} chars, neutral tone, no quotes/backticks)
- teaser: string (2–3 sentences, &lt;= {{maxTeaserChars}} chars, not identical to summary)
- text: string (the Markdown content without YAML frontmatter)
- authors: string[] (from frontmatter authors/author; else [])
- wordCount: integer (plain word count of text; ignore code fences and frontmatter)

CONTEXT
- Preferred language: {{targetLanguage}}
- File name (fallback for title/slug): {{fileName}}

RULES
1) Use frontmatter (title, authors, lang) if present; else use first H1 as title; else derive from file name (remove extension and separators, title case).
2) shortTitle: shorten title to &lt;= 40 chars on word boundary; remove trailing punctuation.
3) slug: derive from shortTitle → lowercase, ASCII, replace non-alphanumerics with &#39;-&#39;, collapse multiple &#39;-&#39;, trim leading/trailing &#39;-&#39;.
4) summary: use first meaningful paragraph(s), strip images/links/markdown formatting, &lt;= {{maxSummaryChars}} chars, end on sentence boundary if possible.
5) teaser: distinct from summary; preview-style, concise; &lt;= {{maxTeaserChars}} chars.
6) text: original Markdown minus YAML frontmatter. Keep headings and lists; do not include the frontmatter or injected context.
7) authors: array of strings; if missing → [].
8) wordCount: count words in text (no code blocks/frontmatter).
9) Output strictly valid JSON only. No markdown fences, no comments, no trailing commas.

INPUT MARKDOWN
&lt;&lt;&lt;MARKDOWN
{{markdown}}
MARKDOWN

OUTPUT FORMAT (must match; example types only)
{
  &quot;title&quot;: &quot;string&quot;,
  &quot;shortTitle&quot;: &quot;string&quot;,
  &quot;slug&quot;: &quot;string&quot;,
  &quot;summary&quot;: &quot;string&quot;,
  &quot;teaser&quot;: &quot;string&quot;,
  &quot;text&quot;: &quot;string&quot;,
  &quot;authors&quot;: [&quot;string&quot;],
  &quot;wordCount&quot;: 123
}
</code></pre></div>
<h3 id="variante-strikt-mit-schema-validierungshinweis">Variante „strikt“ mit Schema-Validierungshinweis<a class="headerlink" href="#variante-strikt-mit-schema-validierungshinweis" title="Permanent link">&para;</a></h3>
<p>Optional kannst du zusätzlich ein kompaktes JSON-Schema in den Prompt packen, um die Form noch stärker zu erzwingen:</p>
<div class="highlight"><pre><span></span><code>JSON-SCHEMA (for shape, not to be included in output)
{
  &quot;type&quot;:&quot;object&quot;,
  &quot;properties&quot;:{
    &quot;title&quot;:{&quot;type&quot;:&quot;string&quot;},
    &quot;shortTitle&quot;:{&quot;type&quot;:&quot;string&quot;},
    &quot;slug&quot;:{&quot;type&quot;:&quot;string&quot;},
    &quot;summary&quot;:{&quot;type&quot;:&quot;string&quot;},
    &quot;teaser&quot;:{&quot;type&quot;:&quot;string&quot;},
    &quot;text&quot;:{&quot;type&quot;:&quot;string&quot;},
    &quot;authors&quot;:{&quot;type&quot;:&quot;array&quot;,&quot;items&quot;:{&quot;type&quot;:&quot;string&quot;}},
    &quot;wordCount&quot;:{&quot;type&quot;:&quot;integer&quot;,&quot;minimum&quot;:0}
  },
  &quot;required&quot;:[&quot;title&quot;,&quot;shortTitle&quot;,&quot;slug&quot;,&quot;summary&quot;,&quot;teaser&quot;,&quot;text&quot;,&quot;authors&quot;,&quot;wordCount&quot;],
  &quot;additionalProperties&quot;:false
}
Return ONLY a JSON object conforming to the schema. No extra text.
</code></pre></div>
<h3 id="einbindung-in-transformservicetransformtext">Einbindung in <code>TransformService.transformText</code><a class="headerlink" href="#einbindung-in-transformservicetransformtext" title="Permanent link">&para;</a></h3>
<ul>
<li><code>template</code>-Parameter: übergib die obige Template-Zeichenkette (ggf. in <code>src/lib/secretary/templates/wiki-entry.ts</code> abgelegt) und ersetze <code>{{...}}</code> Platzhalter vor dem Call.</li>
<li>Eingabe: <code>textContent</code> ist der Markdown-Content. Falls der Dateiname wichtig ist, füge ihn über Template-Kontext ein (siehe „CONTEXT“).</li>
<li>Output: der Secretary Service liefert JSON-String; danach serverseitig via Zod validieren und in <code>wiki_entries</code> upserten. <code>readingTimeMinutes</code> lokal berechnen (z. B. <code>Math.ceil(wordCount / 200)</code>).</li>
</ul>
<p>Wenn du willst, baue ich dir eine kleine Template-Hilfsfunktion plus Zod-Schema für die Validierung und ein kurzes Vitest-Sample, das die Extraktion mit einem Beispiel-Markdown prüft.</p>
<div class="highlight"><pre><span></span><code>You are a precise information extraction model.

TASK
From the given Markdown document, extract a WikiEntry JSON with fields:
- title: string
- shortTitle: string (&lt;= 40 chars, readable, no trailing punctuation)
- slug: string (lowercase, kebab-case, ASCII only, &lt;= 80 chars; collapse whitespace/dashes)
- summary: string (1–2 sentences, &lt;= {{maxSummaryChars}} chars, neutral tone, no quotes/backticks)
- teaser: string (2–3 sentences, &lt;= {{maxTeaserChars}} chars, not identical to summary)
- text: string (the Markdown content without YAML frontmatter)
- authors: string[] (from frontmatter authors/author; else [])
- wordCount: integer (plain word count of text; ignore code fences and frontmatter)

CONTEXT
- Preferred language: {{targetLanguage}}
- File name (fallback for title/slug): {{fileName}}

RULES
1) Use frontmatter (title, authors, lang) if present; else use first H1 as title; else derive from file name (remove extension and separators, title case).
2) shortTitle: shorten title to &lt;= 40 chars on word boundary; remove trailing punctuation.
3) slug: derive from shortTitle → lowercase, ASCII, replace non-alphanumerics with &#39;-&#39;, collapse multiple &#39;-&#39;, trim leading/trailing &#39;-&#39;.
4) summary: use first meaningful paragraph(s), strip images/links/markdown formatting, &lt;= {{maxSummaryChars}} chars, end on sentence boundary if possible.
5) teaser: distinct from summary; preview-style, concise; &lt;= {{maxTeaserChars}} chars.
6) text: original Markdown minus YAML frontmatter. Keep headings and lists; do not include the frontmatter or injected context.
7) authors: array of strings; if missing → [].
8) wordCount: count words in text (no code blocks/frontmatter).
9) Output strictly valid JSON only. No markdown fences, no comments, no trailing commas.

INPUT MARKDOWN
&lt;&lt;&lt;MARKDOWN
{{markdown}}
MARKDOWN

OUTPUT FORMAT (must match; example types only)
{
  &quot;title&quot;: &quot;string&quot;,
  &quot;shortTitle&quot;: &quot;string&quot;,
  &quot;slug&quot;: &quot;string&quot;,
  &quot;summary&quot;: &quot;string&quot;,
  &quot;teaser&quot;: &quot;string&quot;,
  &quot;text&quot;: &quot;string&quot;,
  &quot;authors&quot;: [&quot;string&quot;],
  &quot;wordCount&quot;: 123
}
</code></pre></div>
<div class="highlight"><pre><span></span><code>JSON-SCHEMA (for shape, not to be included in output)
{
  &quot;type&quot;:&quot;object&quot;,
  &quot;properties&quot;:{
    &quot;title&quot;:{&quot;type&quot;:&quot;string&quot;},
    &quot;shortTitle&quot;:{&quot;type&quot;:&quot;string&quot;},
    &quot;slug&quot;:{&quot;type&quot;:&quot;string&quot;},
    &quot;summary&quot;:{&quot;type&quot;:&quot;string&quot;},
    &quot;teaser&quot;:{&quot;type&quot;:&quot;string&quot;},
    &quot;text&quot;:{&quot;type&quot;:&quot;string&quot;},
    &quot;authors&quot;:{&quot;type&quot;:&quot;array&quot;,&quot;items&quot;:{&quot;type&quot;:&quot;string&quot;}},
    &quot;wordCount&quot;:{&quot;type&quot;:&quot;integer&quot;,&quot;minimum&quot;:0}
  },
  &quot;required&quot;:[&quot;title&quot;,&quot;shortTitle&quot;,&quot;slug&quot;,&quot;summary&quot;,&quot;teaser&quot;,&quot;text&quot;,&quot;authors&quot;,&quot;wordCount&quot;],
  &quot;additionalProperties&quot;:false
}
Return ONLY a JSON object conforming to the schema. No extra text.
</code></pre></div>
<hr />
<p><strong>User</strong></p>
<p>@wiki-publish-design.md Wir können die Sache vereinfachen. Und zwar, wir würden einfach in einem Verzeichnis alle Markdown-Dateien analysieren Und diese Attribute Title, Short-Title, Slug, Summary, Teaser, Author und Text befinden sich bereits im Front-Matter dieser Markdown-Dateien Da sie ja bereits über diese Template erstellt wurden und diese Parameter im YAML Front-Matter bereitstellen Und diese würden wir jetzt verwenden und in MongoDB speichern Wie könnte man das machen?</p>
<hr />
<p><strong>Cursor</strong></p>
<p>Kurzüberlegung
- Wenn alle Felder bereits im YAML-Frontmatter stehen, minimieren wir die Logik: nur parsen, validieren, ableiten (Fallbacks), checksum bilden und upserten. Kein LLM nötig.
- Robustheitspunkte: strikte Validierung (Zod), Idempotenz (checksum), Toleranz für Varianten wie <code>author</code> vs. <code>authors</code>, fehlende <code>slug</code>/<code>shortTitle</code> (Fallback aus <code>title</code>), saubere Fehlerprotokollierung.</p>
<h3 id="zielablauf-vereinfacht">Zielablauf (vereinfacht)<a class="headerlink" href="#zielablauf-vereinfacht" title="Permanent link">&para;</a></h3>
<ul>
<li>Client-Dialog „Verzeichnis veröffentlichen“ scannt rekursiv <code>*.md</code>.</li>
<li>Pro Datei: Hole Inhalt via <code>provider.getBinary(...)</code>, parse Frontmatter, validiere, sende an <code>POST /api/web/publish</code>.</li>
<li>Server: validiert erneut, berechnet <code>checksum</code>, upsert in <code>wiki_entries</code> per <code>(libraryId, lang, slug)</code>.</li>
</ul>
<h3 id="frontmatter-beispiel-vereinheitlicht">Frontmatter-Beispiel (vereinheitlicht)<a class="headerlink" href="#frontmatter-beispiel-vereinheitlicht" title="Permanent link">&para;</a></h3>
<p><div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Klimabericht Alpenraum 2024</span>
<span class="nt">shortTitle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Klimabericht Alpen</span>
<span class="nt">slug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">klimabericht-alpen-2024</span>
<span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Dieser Bericht fasst die wichtigsten Trends und Maßnahmen zusammen.</span>
<span class="nt">teaser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ein kompakter Überblick über Risiken und Handlungsfelder.</span>
<span class="nt">authors</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Umweltamt Tirol</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Institut Alpine Research</span>
<span class="nt">lang</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">de</span>
<span class="nt">text</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<span class="w">  </span><span class="no"># Klimabericht Alpenraum 2024</span>

<span class="w">  </span><span class="no">Einleitung …</span>
<span class="nt">wordCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">842</span>
<span class="nn">---</span>
</code></pre></div>
- Optional akzeptieren: <code>author: "Name"</code> (wir mappen zu <code>authors: [..]</code>).
- Falls <code>text</code> nicht vorhanden: nehmen wir den Markdown-Body als Text-Grundlage.</p>
<h3 id="validierungsschema-zod-und-parser">Validierungsschema (Zod) und Parser<a class="headerlink" href="#validierungsschema-zod-und-parser" title="Permanent link">&para;</a></h3>
<p><div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">z</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zod&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">WikiFrontmatterSchema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">z</span><span class="p">.</span><span class="nx">object</span><span class="p">({</span>
<span class="w">  </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">z.string</span><span class="p">().</span><span class="nx">min</span><span class="p">(</span><span class="mf">1</span><span class="p">),</span>
<span class="w">  </span><span class="nx">shortTitle</span><span class="o">:</span><span class="w"> </span><span class="kt">z.string</span><span class="p">().</span><span class="nx">min</span><span class="p">(</span><span class="mf">1</span><span class="p">).</span><span class="nx">max</span><span class="p">(</span><span class="mf">80</span><span class="p">).</span><span class="nx">optional</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">slug</span><span class="o">:</span><span class="w"> </span><span class="kt">z.string</span><span class="p">().</span><span class="nx">min</span><span class="p">(</span><span class="mf">1</span><span class="p">).</span><span class="nx">max</span><span class="p">(</span><span class="mf">120</span><span class="p">).</span><span class="nx">optional</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">summary</span><span class="o">:</span><span class="w"> </span><span class="kt">z.string</span><span class="p">().</span><span class="nx">min</span><span class="p">(</span><span class="mf">1</span><span class="p">).</span><span class="nx">max</span><span class="p">(</span><span class="mf">600</span><span class="p">),</span>
<span class="w">  </span><span class="nx">teaser</span><span class="o">:</span><span class="w"> </span><span class="kt">z.string</span><span class="p">().</span><span class="nx">min</span><span class="p">(</span><span class="mf">1</span><span class="p">).</span><span class="nx">max</span><span class="p">(</span><span class="mf">600</span><span class="p">),</span>
<span class="w">  </span><span class="nx">authors</span><span class="o">:</span><span class="w"> </span><span class="kt">z.array</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="kt">string</span><span class="p">()).</span><span class="nx">optional</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">author</span><span class="o">:</span><span class="w"> </span><span class="kt">z.string</span><span class="p">().</span><span class="nx">optional</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">lang</span><span class="o">:</span><span class="w"> </span><span class="kt">z.string</span><span class="p">().</span><span class="nx">min</span><span class="p">(</span><span class="mf">2</span><span class="p">).</span><span class="nx">max</span><span class="p">(</span><span class="mf">5</span><span class="p">).</span><span class="k">default</span><span class="p">(</span><span class="s1">&#39;de&#39;</span><span class="p">),</span>
<span class="w">  </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">z.string</span><span class="p">().</span><span class="nx">optional</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">wordCount</span><span class="o">:</span><span class="w"> </span><span class="kt">z.number</span><span class="p">().</span><span class="kr">int</span><span class="p">().</span><span class="nx">nonnegative</span><span class="p">().</span><span class="nx">optional</span><span class="p">(),</span>
<span class="p">});</span>

<span class="k">export</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="nx">WikiFrontmatter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">z</span><span class="p">.</span><span class="nx">infer</span><span class="o">&lt;</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">WikiFrontmatterSchema</span><span class="o">&gt;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">ParsedMarkdown</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">frontmatter</span><span class="o">:</span><span class="w"> </span><span class="kt">WikiFrontmatter</span><span class="p">;</span>
<span class="w">  </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w"> </span><span class="c1">// Markdown ohne Frontmatter</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">parseMarkdown</span><span class="p">(</span><span class="nx">md</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">ParsedMarkdown</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// gray-matter o. ä. verwenden</span>
<span class="w">  </span><span class="c1">// const { data, content } = matter(md);</span>
<span class="w">  </span><span class="c1">// Hier konzeptuell:</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">md</span><span class="p">;</span><span class="w"> </span><span class="c1">// Platzhalter</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">fm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">WikiFrontmatterSchema</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">authors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fm</span><span class="p">.</span><span class="nx">authors</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="p">(</span><span class="nx">fm</span><span class="p">.</span><span class="nx">author</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">[</span><span class="nx">fm</span><span class="p">.</span><span class="nx">author</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">[]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fm</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">shortTitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fm</span><span class="p">.</span><span class="nx">shortTitle</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="nx">deriveShortTitle</span><span class="p">(</span><span class="nx">title</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">slug</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fm</span><span class="p">.</span><span class="nx">slug</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="nx">deriveSlug</span><span class="p">(</span><span class="nx">shortTitle</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">frontmatter</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">fm</span><span class="p">,</span><span class="w"> </span><span class="nx">authors</span><span class="p">,</span><span class="w"> </span><span class="nx">shortTitle</span><span class="p">,</span><span class="w"> </span><span class="nx">slug</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="kt">content</span><span class="p">,</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div>
- <code>deriveShortTitle(title)</code>: Kürzen an Wortgrenzen (~40 Zeichen).
- <code>deriveSlug(s)</code>: <code>kebab-case</code>, ASCII-only, max 80 Zeichen.</p>
<h3 id="server-upsert-logik-kern">Server: Upsert-Logik (Kern)<a class="headerlink" href="#server-upsert-logik-kern" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">interface</span><span class="w"> </span><span class="nx">UpsertInput</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">libraryId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">sourceItemId?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">sourcePath?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">originalUrl?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">markdown</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w"> </span><span class="c1">// kompletter Inhalt</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">upsertWikiEntry</span><span class="p">(</span><span class="nx">input</span><span class="o">:</span><span class="w"> </span><span class="kt">UpsertInput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">frontmatter</span><span class="p">,</span><span class="w"> </span><span class="nx">body</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parseMarkdown</span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">markdown</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">frontmatter</span><span class="p">.</span><span class="nx">text</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="nx">stripFrontmatterText</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">wordCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">frontmatter</span><span class="p">.</span><span class="nx">wordCount</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="nx">countWords</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">readingTimeMinutes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">wordCount</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">200</span><span class="p">));</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">checksum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sha256</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">text</span><span class="si">}</span><span class="sb">|</span><span class="si">${</span><span class="nx">frontmatter</span><span class="p">.</span><span class="nx">title</span><span class="si">}</span><span class="sb">|</span><span class="si">${</span><span class="nx">frontmatter</span><span class="p">.</span><span class="nx">lang</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">libraryId</span><span class="o">:</span><span class="w"> </span><span class="kt">input.libraryId</span><span class="p">,</span>
<span class="w">    </span><span class="nx">sourceItemId</span><span class="o">:</span><span class="w"> </span><span class="kt">input.sourceItemId</span><span class="p">,</span>
<span class="w">    </span><span class="nx">sourcePath</span><span class="o">:</span><span class="w"> </span><span class="kt">input.sourcePath</span><span class="p">,</span>
<span class="w">    </span><span class="nx">originalUrl</span><span class="o">:</span><span class="w"> </span><span class="kt">input.originalUrl</span><span class="p">,</span>
<span class="w">    </span><span class="nx">lang</span><span class="o">:</span><span class="w"> </span><span class="kt">frontmatter.lang</span><span class="p">,</span>
<span class="w">    </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">frontmatter.title</span><span class="p">,</span>
<span class="w">    </span><span class="nx">shortTitle</span><span class="o">:</span><span class="w"> </span><span class="kt">frontmatter.shortTitle</span><span class="p">,</span>
<span class="w">    </span><span class="nx">slug</span><span class="o">:</span><span class="w"> </span><span class="kt">frontmatter.slug</span><span class="p">,</span>
<span class="w">    </span><span class="nx">summary</span><span class="o">:</span><span class="w"> </span><span class="kt">frontmatter.summary</span><span class="p">,</span>
<span class="w">    </span><span class="nx">teaser</span><span class="o">:</span><span class="w"> </span><span class="kt">frontmatter.teaser</span><span class="p">,</span>
<span class="w">    </span><span class="nx">authors</span><span class="o">:</span><span class="w"> </span><span class="kt">frontmatter.authors</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="p">[],</span>
<span class="w">    </span><span class="nx">markdown</span><span class="o">:</span><span class="w"> </span><span class="kt">body</span><span class="p">,</span>
<span class="w">    </span><span class="nx">wordCount</span><span class="p">,</span>
<span class="w">    </span><span class="nx">readingTimeMinutes</span><span class="p">,</span>
<span class="w">    </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;published&#39;</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kd">const</span><span class="p">,</span>
<span class="w">    </span><span class="nx">checksum</span><span class="p">,</span>
<span class="w">    </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="c1">// unique key: { libraryId, lang, slug }</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">existing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">wikiEntries</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span><span class="w"> </span><span class="nx">libraryId</span><span class="o">:</span><span class="w"> </span><span class="kt">doc.libraryId</span><span class="p">,</span><span class="w"> </span><span class="nx">lang</span><span class="o">:</span><span class="w"> </span><span class="kt">doc.lang</span><span class="p">,</span><span class="w"> </span><span class="nx">slug</span><span class="o">:</span><span class="w"> </span><span class="kt">doc.slug</span><span class="w"> </span><span class="p">});</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">existing</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">wikiEntries</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">({</span><span class="w"> </span><span class="p">...</span><span class="nx">doc</span><span class="p">,</span><span class="w"> </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">doc.updatedAt</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">created</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">existing</span><span class="p">.</span><span class="nx">checksum</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">checksum</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">wikiEntries</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">({</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="kt">existing._id</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$set</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">doc.updatedAt</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">created</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span><span class="w"> </span><span class="nx">updated</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">wikiEntries</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">(</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="kt">existing._id</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">$set</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">doc</span><span class="p">,</span><span class="w"> </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="kt">existing.version</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">created</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span><span class="w"> </span><span class="nx">updated</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="w"> </span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="api-route-post-apiwebpublish">API-Route <code>POST /api/web/publish</code><a class="headerlink" href="#api-route-post-apiwebpublish" title="Permanent link">&para;</a></h3>
<ul>
<li>Headers: <code>X-Library-Id</code>.</li>
<li>Body: FormData mit <code>file</code> (Markdown) oder JSON <code>{ markdown, sourceItemId, sourcePath, originalUrl }</code>.</li>
<li>Schritte:</li>
<li>Clerk-Auth prüfen.</li>
<li><code>libraryId</code> aus Header validieren.</li>
<li>Markdown laden, <code>upsertWikiEntry(...)</code> aufrufen.</li>
<li>Standardisierte Antwort zurückgeben.</li>
</ul>
<h3 id="client-verzeichnis-veroffentlichen-dialog">Client: „Verzeichnis veröffentlichen“-Dialog<a class="headerlink" href="#client-verzeichnis-veroffentlichen-dialog" title="Permanent link">&para;</a></h3>
<ul>
<li>Nahezu identisch zu <code>PdfBulkImportDialog</code>, aber Filter auf <code>*.md</code>.</li>
<li>Beim Enqueue: Datei-Inhalt laden (<code>provider.getBinary(id)</code>), als Text lesen und an <code>/api/web/publish</code> senden.</li>
<li>Option „Existierende ignorieren“: optional vorab HEAD-Check via <code>slug</code> (leicht, aber optional; idempotente Upsert genügt).</li>
</ul>
<h3 id="edge-cases">Edge-Cases<a class="headerlink" href="#edge-cases" title="Permanent link">&para;</a></h3>
<ul>
<li>Fehlender <code>slug</code>/<code>shortTitle</code>: Fallbacks greifen, serverseitig deterministisch.</li>
<li><code>authors</code>/<code>author</code>: vereinheitlichen (Array).</li>
<li><code>text</code> fehlt im Frontmatter: aus Body extrahieren.</li>
<li>Mehrsprachigkeit: <code>lang</code> aus Frontmatter, sonst Default <code>de</code>.</li>
</ul>
<p>Wenn du möchtest, implementiere ich als nächsten Schritt:
- <code>src/utils/wiki-parser.ts</code> (parse + derive),
- <code>src/app/api/web/publish/route.ts</code> (POST, Upsert),
- sowie die Mongo-Repo-Funktion für <code>wiki_entries</code> inkl. unique Index.</p>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Klimabericht Alpenraum 2024</span>
<span class="nt">shortTitle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Klimabericht Alpen</span>
<span class="nt">slug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">klimabericht-alpen-2024</span>
<span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Dieser Bericht fasst die wichtigsten Trends und Maßnahmen zusammen.</span>
<span class="nt">teaser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ein kompakter Überblick über Risiken und Handlungsfelder.</span>
<span class="nt">authors</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Umweltamt Tirol</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Institut Alpine Research</span>
<span class="nt">lang</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">de</span>
<span class="nt">text</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<span class="w">  </span><span class="no"># Klimabericht Alpenraum 2024</span>

<span class="w">  </span><span class="no">Einleitung …</span>
<span class="nt">wordCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">842</span>
<span class="nn">---</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">z</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zod&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">WikiFrontmatterSchema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">z</span><span class="p">.</span><span class="nx">object</span><span class="p">({</span>
<span class="w">  </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">z.string</span><span class="p">().</span><span class="nx">min</span><span class="p">(</span><span class="mf">1</span><span class="p">),</span>
<span class="w">  </span><span class="nx">shortTitle</span><span class="o">:</span><span class="w"> </span><span class="kt">z.string</span><span class="p">().</span><span class="nx">min</span><span class="p">(</span><span class="mf">1</span><span class="p">).</span><span class="nx">max</span><span class="p">(</span><span class="mf">80</span><span class="p">).</span><span class="nx">optional</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">slug</span><span class="o">:</span><span class="w"> </span><span class="kt">z.string</span><span class="p">().</span><span class="nx">min</span><span class="p">(</span><span class="mf">1</span><span class="p">).</span><span class="nx">max</span><span class="p">(</span><span class="mf">120</span><span class="p">).</span><span class="nx">optional</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">summary</span><span class="o">:</span><span class="w"> </span><span class="kt">z.string</span><span class="p">().</span><span class="nx">min</span><span class="p">(</span><span class="mf">1</span><span class="p">).</span><span class="nx">max</span><span class="p">(</span><span class="mf">600</span><span class="p">),</span>
<span class="w">  </span><span class="nx">teaser</span><span class="o">:</span><span class="w"> </span><span class="kt">z.string</span><span class="p">().</span><span class="nx">min</span><span class="p">(</span><span class="mf">1</span><span class="p">).</span><span class="nx">max</span><span class="p">(</span><span class="mf">600</span><span class="p">),</span>
<span class="w">  </span><span class="nx">authors</span><span class="o">:</span><span class="w"> </span><span class="kt">z.array</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="kt">string</span><span class="p">()).</span><span class="nx">optional</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">author</span><span class="o">:</span><span class="w"> </span><span class="kt">z.string</span><span class="p">().</span><span class="nx">optional</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">lang</span><span class="o">:</span><span class="w"> </span><span class="kt">z.string</span><span class="p">().</span><span class="nx">min</span><span class="p">(</span><span class="mf">2</span><span class="p">).</span><span class="nx">max</span><span class="p">(</span><span class="mf">5</span><span class="p">).</span><span class="k">default</span><span class="p">(</span><span class="s1">&#39;de&#39;</span><span class="p">),</span>
<span class="w">  </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">z.string</span><span class="p">().</span><span class="nx">optional</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">wordCount</span><span class="o">:</span><span class="w"> </span><span class="kt">z.number</span><span class="p">().</span><span class="kr">int</span><span class="p">().</span><span class="nx">nonnegative</span><span class="p">().</span><span class="nx">optional</span><span class="p">(),</span>
<span class="p">});</span>

<span class="k">export</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="nx">WikiFrontmatter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">z</span><span class="p">.</span><span class="nx">infer</span><span class="o">&lt;</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">WikiFrontmatterSchema</span><span class="o">&gt;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">ParsedMarkdown</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">frontmatter</span><span class="o">:</span><span class="w"> </span><span class="kt">WikiFrontmatter</span><span class="p">;</span>
<span class="w">  </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w"> </span><span class="c1">// Markdown ohne Frontmatter</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">parseMarkdown</span><span class="p">(</span><span class="nx">md</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">ParsedMarkdown</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// gray-matter o. ä. verwenden</span>
<span class="w">  </span><span class="c1">// const { data, content } = matter(md);</span>
<span class="w">  </span><span class="c1">// Hier konzeptuell:</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">md</span><span class="p">;</span><span class="w"> </span><span class="c1">// Platzhalter</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">fm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">WikiFrontmatterSchema</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">authors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fm</span><span class="p">.</span><span class="nx">authors</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="p">(</span><span class="nx">fm</span><span class="p">.</span><span class="nx">author</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">[</span><span class="nx">fm</span><span class="p">.</span><span class="nx">author</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">[]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fm</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">shortTitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fm</span><span class="p">.</span><span class="nx">shortTitle</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="nx">deriveShortTitle</span><span class="p">(</span><span class="nx">title</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">slug</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fm</span><span class="p">.</span><span class="nx">slug</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="nx">deriveSlug</span><span class="p">(</span><span class="nx">shortTitle</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">frontmatter</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">fm</span><span class="p">,</span><span class="w"> </span><span class="nx">authors</span><span class="p">,</span><span class="w"> </span><span class="nx">shortTitle</span><span class="p">,</span><span class="w"> </span><span class="nx">slug</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="kt">content</span><span class="p">,</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kd">interface</span><span class="w"> </span><span class="nx">UpsertInput</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">libraryId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">sourceItemId?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">sourcePath?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">originalUrl?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">markdown</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w"> </span><span class="c1">// kompletter Inhalt</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">upsertWikiEntry</span><span class="p">(</span><span class="nx">input</span><span class="o">:</span><span class="w"> </span><span class="kt">UpsertInput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">frontmatter</span><span class="p">,</span><span class="w"> </span><span class="nx">body</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parseMarkdown</span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">markdown</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">frontmatter</span><span class="p">.</span><span class="nx">text</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="nx">stripFrontmatterText</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">wordCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">frontmatter</span><span class="p">.</span><span class="nx">wordCount</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="nx">countWords</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">readingTimeMinutes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">wordCount</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">200</span><span class="p">));</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">checksum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sha256</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">text</span><span class="si">}</span><span class="sb">|</span><span class="si">${</span><span class="nx">frontmatter</span><span class="p">.</span><span class="nx">title</span><span class="si">}</span><span class="sb">|</span><span class="si">${</span><span class="nx">frontmatter</span><span class="p">.</span><span class="nx">lang</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">libraryId</span><span class="o">:</span><span class="w"> </span><span class="kt">input.libraryId</span><span class="p">,</span>
<span class="w">    </span><span class="nx">sourceItemId</span><span class="o">:</span><span class="w"> </span><span class="kt">input.sourceItemId</span><span class="p">,</span>
<span class="w">    </span><span class="nx">sourcePath</span><span class="o">:</span><span class="w"> </span><span class="kt">input.sourcePath</span><span class="p">,</span>
<span class="w">    </span><span class="nx">originalUrl</span><span class="o">:</span><span class="w"> </span><span class="kt">input.originalUrl</span><span class="p">,</span>
<span class="w">    </span><span class="nx">lang</span><span class="o">:</span><span class="w"> </span><span class="kt">frontmatter.lang</span><span class="p">,</span>
<span class="w">    </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">frontmatter.title</span><span class="p">,</span>
<span class="w">    </span><span class="nx">shortTitle</span><span class="o">:</span><span class="w"> </span><span class="kt">frontmatter.shortTitle</span><span class="p">,</span>
<span class="w">    </span><span class="nx">slug</span><span class="o">:</span><span class="w"> </span><span class="kt">frontmatter.slug</span><span class="p">,</span>
<span class="w">    </span><span class="nx">summary</span><span class="o">:</span><span class="w"> </span><span class="kt">frontmatter.summary</span><span class="p">,</span>
<span class="w">    </span><span class="nx">teaser</span><span class="o">:</span><span class="w"> </span><span class="kt">frontmatter.teaser</span><span class="p">,</span>
<span class="w">    </span><span class="nx">authors</span><span class="o">:</span><span class="w"> </span><span class="kt">frontmatter.authors</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="p">[],</span>
<span class="w">    </span><span class="nx">markdown</span><span class="o">:</span><span class="w"> </span><span class="kt">body</span><span class="p">,</span>
<span class="w">    </span><span class="nx">wordCount</span><span class="p">,</span>
<span class="w">    </span><span class="nx">readingTimeMinutes</span><span class="p">,</span>
<span class="w">    </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;published&#39;</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kd">const</span><span class="p">,</span>
<span class="w">    </span><span class="nx">checksum</span><span class="p">,</span>
<span class="w">    </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="c1">// unique key: { libraryId, lang, slug }</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">existing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">wikiEntries</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span><span class="w"> </span><span class="nx">libraryId</span><span class="o">:</span><span class="w"> </span><span class="kt">doc.libraryId</span><span class="p">,</span><span class="w"> </span><span class="nx">lang</span><span class="o">:</span><span class="w"> </span><span class="kt">doc.lang</span><span class="p">,</span><span class="w"> </span><span class="nx">slug</span><span class="o">:</span><span class="w"> </span><span class="kt">doc.slug</span><span class="w"> </span><span class="p">});</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">existing</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">wikiEntries</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">({</span><span class="w"> </span><span class="p">...</span><span class="nx">doc</span><span class="p">,</span><span class="w"> </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">doc.updatedAt</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">created</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">existing</span><span class="p">.</span><span class="nx">checksum</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">checksum</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">wikiEntries</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">({</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="kt">existing._id</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$set</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">doc.updatedAt</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">created</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span><span class="w"> </span><span class="nx">updated</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">wikiEntries</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">(</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="kt">existing._id</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">$set</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">doc</span><span class="p">,</span><span class="w"> </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="kt">existing.version</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">created</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span><span class="w"> </span><span class="nx">updated</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="w"> </span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.50899def.min.js"></script>
      
        <script src="../../js/print-site.js"></script>
      
        <script src="https://unpkg.com/mermaid@10.9.1/dist/mermaid.min.js"></script>
      
        <script src="../../assets/javascripts/mermaid-init.js"></script>
      
    
  </body>
</html>