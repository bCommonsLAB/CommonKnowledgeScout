
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="http://localhost:3000/docs/_history/08_august/cursor_2025.08.24_zusammenfassung_der_asynchronen.html">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Zusammenfassung der asynchronen PDF-Erstellung - Common Knowledge Scout</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/print-site.css">
    
      <link rel="stylesheet" href="../../css/print-site-material.css">
    
      <link rel="stylesheet" href="../../assets/stylesheets/print.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#zusammenfassung-der-asynchronen-pdf-erstellung" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Common Knowledge Scout" class="md-header__button md-logo" aria-label="Common Knowledge Scout" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Common Knowledge Scout
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Zusammenfassung der asynchronen PDF-Erstellung
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/bCommonsLAB/CommonKnowledgeScout" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Common Knowledge Scout" class="md-nav__button md-logo" aria-label="Common Knowledge Scout" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Common Knowledge Scout
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/bCommonsLAB/CommonKnowledgeScout" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Overview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/intro.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Intro
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/features.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Features
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/architecture.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/core-components.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Core Components
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/setup.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/getting-started.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/settings.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Settings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/library.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using the Library
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/event-monitor.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Event Monitor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/batch-session-import.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Batch Session Import
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/troubleshooting.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/faq.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Concepts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/storage-provider.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Storage Provider
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/localstorage.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FileSystem (Local)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/image-transformation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Image Transformation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/pdf/extraction-methods.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PDF Extraction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/metadata.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metadata
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_7" >
        
          
          <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Library
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            Library
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/overview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/global-state.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Global State
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/header.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Header
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/breadcrumb.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Breadcrumb
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/file-tree.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FileTree
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/file-list.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FileList
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/upload.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upload
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/file-preview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FilePreview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/transcription.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transcription
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/transform.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transform
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/batch-transcription.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Batch Transcription
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/error-handling-logging-testing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Error Handling & Tests
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/initialization-sequence.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Initialization
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/library/components.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Library Components
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/features/shadowtwins.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shadow-Twin
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/features/extended-shadowtwin.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Extended Shadow-Twin
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/features/transformation-service.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transformation Service
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/video-transformation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Video Transformation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/glossary.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api/secretary-services.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Secretary Services
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api/track-processor.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Track Processor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chat-response-generation-process.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chat & Story Mode
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Operations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Operations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ops/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ops/deployment/docker.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ops/desktop/quick-setup.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Electron Quick Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ops/desktop/package-strategy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Electron Package Strategy
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#kerngedanke" class="md-nav__link">
    <span class="md-ellipsis">
      Kerngedanke
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ablauf" class="md-nav__link">
    <span class="md-ellipsis">
      Ablauf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#live-updatesanzeige" class="md-nav__link">
    <span class="md-ellipsis">
      Live-Updates/Anzeige
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sicherheit" class="md-nav__link">
    <span class="md-ellipsis">
      Sicherheit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#umgebung" class="md-nav__link">
    <span class="md-ellipsis">
      Umgebung
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ui-status" class="md-nav__link">
    <span class="md-ellipsis">
      UI-Status
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kompatibilitat-und-notwendige-anpassungen" class="md-nav__link">
    <span class="md-ellipsis">
      Kompatibilität und notwendige Anpassungen
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hinweise" class="md-nav__link">
    <span class="md-ellipsis">
      Hinweise
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kurzer-testplan" class="md-nav__link">
    <span class="md-ellipsis">
      Kurzer Testplan
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wie-der-scan-arbeitet" class="md-nav__link">
    <span class="md-ellipsis">
      Wie der Scan arbeitet
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="zusammenfassung-der-asynchronen-pdf-erstellung">Zusammenfassung der asynchronen PDF-Erstellung<a class="headerlink" href="#zusammenfassung-der-asynchronen-pdf-erstellung" title="Permanent link">&para;</a></h1>
<p><em>Exported on 8/30/2025 at 11:44:32 GMT+2 from Cursor (1.5.5)</em></p>
<hr />
<p><strong>User</strong></p>
<p>Wir haben jetzt diese PDF-Erstellung auf eine asynchrone Methode umgestellt, sodass der Secretary Service diese hintereinander abarbeiten kann und in unserer External-Job-Liste diese Verarbeitung angezeigt wird. Können wir das nochmal kurz zusammenfassen, was sind die wichtigsten Punkte, wie das funktioniert?</p>
<hr />
<p><strong>Cursor</strong></p>
<p>Ich schaue mir die relevanten Routen und Helfer an, um den neuen asynchronen PDF-Verarbeitungsfluss korrekt und knapp zusammenzufassen. Anschließend fasse ich die wichtigsten Punkte, Events und Endpunkte in Bullet Points zusammen.</p>
<p>Ich habe die relevanten Routen und Services geprüft. Hier ist die knappe, technische Zusammenfassung des asynchronen Flows.</p>
<h3 id="kerngedanke">Kerngedanke<a class="headerlink" href="#kerngedanke" title="Permanent link">&para;</a></h3>
<ul>
<li>Die PDF-Verarbeitung läuft extern im Secretary Service. Unsere App legt dafür einen External-Job an, leitet die Datei weiter und erhält Fortschritt/Ergebnis über Callbacks zurück. Die UI zeigt Live-Status via SSE.</li>
</ul>
<h3 id="ablauf">Ablauf<a class="headerlink" href="#ablauf" title="Permanent link">&para;</a></h3>
<ul>
<li>Auftrag erzeugen: POST <code>api/secretary/process-pdf</code></li>
<li>Clerk-Auth prüfen. FormData lesen (PDF, Optionen).</li>
<li>External-Job anlegen: <code>jobId</code>, per-Job-Secret (nur Hash gespeichert), Status <code>queued</code>, Korrelation (Library, Quelle, Optionen).</li>
<li>Sofort SSE-Event: <code>queued</code>. Watchdog starten (~120s ohne Heartbeat).</li>
<li>Weiterleiten an Secretary <code>.../pdf/process</code> mit:<ul>
<li><code>callback_url</code>: <code>.../api/external/jobs/{jobId}</code></li>
<li><code>callback_token</code>: per-Job-Secret</li>
<li>API-Key-Header: <code>Authorization: Bearer</code> und <code>X-Service-Token</code> [[memory:6998386]].</li>
</ul>
</li>
<li>
<p>Response an Client enthält zusätzlich <code>job: { id: jobId }</code>.</p>
</li>
<li>
<p>Fortschritt/Callbacks: POST <code>api/external/jobs/{jobId}</code></p>
</li>
<li><code>callback_token</code> validieren (Header/Bearer/Body). Gegen gespeicherten Hash prüfen.</li>
<li>Status <code>running</code>, optional <code>process.id</code> speichern.</li>
<li>
<p>Progress/Phase/Message puffern, Watchdog heartbeat, SSE <code>job_update</code> an Benutzerkanal.</p>
</li>
<li>
<p>Abschluss</p>
</li>
<li>
<p>Bei finaler Payload (<code>extracted_text</code>, optional <code>images_archive_data</code>):</p>
<ul>
<li>Speicherung je nach Library:</li>
<li>Local: Markdown (optional mit Frontmatter) in Zielordner, Bilder-ZIP extrahieren und ablegen.</li>
<li>OneDrive: Markdown hochladen; bei Bildern Ordner <code>.&lt;basename&gt;</code> anlegen, Bilder (und optional pro Seite .md) hochladen.</li>
<li>Status <code>completed</code>, Logs aus Puffer persistieren, <code>result</code>-Referenzen (IDs) setzen, SSE final.</li>
</ul>
</li>
<li>
<p>Fehlerfall</p>
</li>
<li>Watchdog stoppen, Logs persistieren, Status <code>failed</code>, SSE <code>failed</code>.</li>
</ul>
<h3 id="live-updatesanzeige">Live-Updates/Anzeige<a class="headerlink" href="#live-updatesanzeige" title="Permanent link">&para;</a></h3>
<ul>
<li>SSE-Stream: GET <code>api/external/jobs/stream</code></li>
<li>Authentifiziert; sendet <code>job_update</code>-Events für die User-Mail.</li>
<li>Job-Details: GET <code>api/external/jobs/{jobId}</code></li>
<li>Liefert Status, Timestamps, Logs, Ergebnis-Referenzen.</li>
</ul>
<h3 id="sicherheit">Sicherheit<a class="headerlink" href="#sicherheit" title="Permanent link">&para;</a></h3>
<ul>
<li>Per-Job-Secret nur als Hash gespeichert; Validierung bei jedem Callback.</li>
<li>Keine sensiblen Korrelationen an den Worker senden (nur Callback-Infos).</li>
<li>Secretary-API-Key nur serverseitig gesetzt; niemals an Client leaken.</li>
<li>Watchdog erkennt hängende Jobs (Timeout ohne Progress).</li>
</ul>
<h3 id="umgebung">Umgebung<a class="headerlink" href="#umgebung" title="Permanent link">&para;</a></h3>
<ul>
<li>Erforderlich: <code>SECRETARY_SERVICE_URL</code>, <code>SECRETARY_SERVICE_API_KEY</code>, <code>NEXT_PUBLIC_APP_URL</code>.</li>
</ul>
<h3 id="ui-status">UI-Status<a class="headerlink" href="#ui-status" title="Permanent link">&para;</a></h3>
<ul>
<li>Einzelverarbeitung: voll integriert über <code>process-pdf</code>.</li>
<li>
<p>Bulk-Dialog (<code>pdf-bulk-import-dialog.tsx</code>): Scan/Optionen fertig; Enqueue ist als Platzhalter vorgesehen und soll auf Secretary-Batch-API zeigen.</p>
</li>
<li>
<p>Kürzestformel: Client lädt hoch → Job angelegt + SSE queued → Secretary arbeitet sequentiell → Callbacks treiben Status/Logs → Ergebnis gespeichert → SSE completed/failed.</p>
</li>
</ul>
<hr />
<p><strong>User</strong></p>
<p>Ok, als nächstes möchte ich eben ganze Verzeichnisstrukturen auslesen und auf diese External Jobs legen und schauen, wie der Secretary Service diese verarbeitet. Wir haben schon folgende Logik implementiert. Wie ist diese jetzt mit unserer neuen Jobmethode kompatibel? Müssen wir da noch was anpassen?@pdf-bulk-import-dialog.tsx @library-header.tsx </p>
<hr />
<p><strong>Cursor</strong></p>
<p>Ich prüfe jetzt, ob der Bulk-Dialog die Dateien als File/Blob laden kann und welche Provider-APIs verfügbar sind, damit wir sie an <code>api/secretary/process-pdf</code> schicken können. Dann bewerte ich, welche minimalen Anpassungen im Dialog nötig sind.</p>
<p>Ich beginne mit der minimalen Anpassung: Im <code>handleEnqueue</code> des <code>pdf-bulk-import-dialog.tsx</code> ersetze ich den Platzhalter durch das sequentielle Anlegen von External Jobs über die bestehende Route, mit Header <code>X-Library-Id</code> und allen erforderlichen FormData-Feldern. Danach prüfe ich kurz die Linter-Ergebnisse.</p>
<div class="highlight"><pre><span></span><code>&#39;use client&#39;;

import { useCallback, useEffect, useMemo, useState } from &#39;react&#39;;
import { useAtomValue } from &#39;jotai&#39;;
import { activeLibraryIdAtom, currentFolderIdAtom } from &#39;@/atoms/library-atom&#39;;
import { useStorage } from &#39;@/contexts/storage-context&#39;;
import { StorageItem } from &#39;@/lib/storage/types&#39;;
import { Button } from &#39;@/components/ui/button&#39;;
import { Checkbox } from &#39;@/components/ui/checkbox&#39;;
import { Label } from &#39;@/components/ui/label&#39;;
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from &#39;@/components/ui/dialog&#39;;
import { ScrollArea } from &#39;@/components/ui/scroll-area&#39;;
import { Separator } from &#39;@/components/ui/separator&#39;;
import { TransformSaveOptions as SaveOptionsComponent } from &#39;@/components/library/transform-save-options&#39;;
import type { TransformSaveOptions as SaveOptionsType } from &#39;@/components/library/transform-save-options&#39;;
import { FileLogger } from &#39;@/lib/debug/logger&#39;;

interface PdfBulkImportDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) =&gt; void;
}

interface ScanStats {
  totalPdfs: number;
  skippedExisting: number;
  toProcess: number;
}

export function PdfBulkImportDialog({ open, onOpenChange }: PdfBulkImportDialogProps) {
  const { provider } = useStorage();
  const rootFolderId = useAtomValue(currentFolderIdAtom);
  const activeLibraryId = useAtomValue(activeLibraryIdAtom);

  const [ignoreExisting, setIgnoreExisting] = useState(true);
  const [isScanning, setIsScanning] = useState(false);
  const [isEnqueuing, setIsEnqueuing] = useState(false);
  const [candidates, setCandidates] = useState&lt;Array&lt;{ file: StorageItem; parentId: string }&gt;&gt;([]);
  const [preview, setPreview] = useState&lt;string[]&gt;([]);
  const [stats, setStats] = useState&lt;ScanStats&gt;({ totalPdfs: 0, skippedExisting: 0, toProcess: 0 });

  // Optionen wie im Einzel-PDF-Dialog
  const [saveOptions, setSaveOptions] = useState&lt;SaveOptionsType&gt;({
    targetLanguage: &#39;de&#39;,
    fileName: &#39;&#39;,
    createShadowTwin: true,
    fileExtension: &#39;md&#39;,
    extractionMethod: &#39;native&#39;,
    useCache: true,
    includeImages: false,
  });

  // Shadow-Twin Erkennung (z. B. name.de.md)
  const shadowTwinRegex = useMemo(() =&gt; /^(.+)\.(de|en|fr|es|it)\.md$/i, []);

  const getBaseName = useCallback((name: string): string =&gt; {
    const lastDot = name.lastIndexOf(&#39;.&#39;);
    return lastDot === -1 ? name : name.substring(0, lastDot);
  }, []);

  const hasTwinInFolder = useCallback(
    (siblings: StorageItem[], pdfBase: string, lang?: string): boolean =&gt; {
      if (lang) {
        const expected = `${pdfBase}.${lang}.md`;
        return siblings.some((i) =&gt; i.type === &#39;file&#39; &amp;&amp; i.metadata.name.toLowerCase() === expected.toLowerCase());
      }
      // Fallback: irgendein Twin in beliebiger Sprache
      return siblings.some((i) =&gt; i.type === &#39;file&#39; &amp;&amp; shadowTwinRegex.test(i.metadata.name));
    },
    [shadowTwinRegex]
  );

  // rekursiver Scan
  const scanFolder = useCallback(async (folderId: string) =&gt; {
    if (!provider) return { total: 0, skipped: 0, selected: [] as Array&lt;{ file: StorageItem; parentId: string }&gt;, previews: [] as string[] };

    const stack: string[] = [folderId];
    let total = 0;
    let skipped = 0;
    const selected: Array&lt;{ file: StorageItem; parentId: string }&gt; = [];
    const previews: string[] = [];

    while (stack.length) {
      const current = stack.pop() as string;
      let items: StorageItem[] = [];
      try {
        items = await provider.listItemsById(current);
      } catch (error) {
        FileLogger.error(&#39;PdfBulkImportDialog&#39;, &#39;Fehler beim Listen eines Ordners&#39;, { folderId: current, error });
        continue;
      }

      const folders = items.filter((i) =&gt; i.type === &#39;folder&#39;);
      folders.forEach((f) =&gt; stack.push(f.id));

      const files = items.filter((i) =&gt; i.type === &#39;file&#39;);
      for (const file of files) {
        const name = file.metadata.name.toLowerCase();
        const isPdf = name.endsWith(&#39;.pdf&#39;) || file.metadata.mimeType?.toLowerCase() === &#39;application/pdf&#39;;
        if (!isPdf) continue;
        total++;

        const base = getBaseName(file.metadata.name);
        const shouldSkip = ignoreExisting &amp;&amp; hasTwinInFolder(items, base, saveOptions.targetLanguage);
        if (shouldSkip) {
          skipped++;
          continue;
        }
        selected.push({ file, parentId: current });
        if (previews.length &lt; 10) previews.push(file.metadata.name);
      }
    }

    return { total, skipped, selected, previews };
  }, [provider, getBaseName, ignoreExisting, hasTwinInFolder, saveOptions.targetLanguage]);

  const handleScan = useCallback(async () =&gt; {
    if (!provider || !rootFolderId) return;
    setIsScanning(true);
    setCandidates([]);
    setPreview([]);
    try {
      const result = await scanFolder(rootFolderId);
      setCandidates(result.selected);
      setPreview(result.previews);
      setStats({ totalPdfs: result.total, skippedExisting: result.skipped, toProcess: result.selected.length });
    } finally {
      setIsScanning(false);
    }
  }, [provider, rootFolderId, scanFolder]);

  useEffect(() =&gt; {
    if (open) {
      // Bei Öffnen initial Scannen
      void handleScan();
    }
  }, [open, handleScan]);

  const handleOptionsChange = useCallback((opts: SaveOptionsType) =&gt; {
    setSaveOptions({
      ...opts,
      extractionMethod: opts.extractionMethod || &#39;native&#39;,
      useCache: opts.useCache ?? true,
      includeImages: opts.includeImages ?? false,
    });
  }, []);

  const handleEnqueue = useCallback(async () =&gt; {
    if (!activeLibraryId) return;
    if (candidates.length === 0) return;
    setIsEnqueuing(true);
    try {
      // Sequenzielles Anlegen von External-Jobs über unsere API-Route
      // Minimale Last, klare Reihenfolge (Secretary arbeitet der Reihe nach)
      for (const { file, parentId } of candidates) {
        try {
          const bin = await provider?.getBinary(file.id);
          if (!bin) continue;

          const pdfFile = new File([bin.blob], file.metadata.name, { type: bin.mimeType || &#39;application/pdf&#39; });

          const form = new FormData();
          form.append(&#39;file&#39;, pdfFile);
          form.append(&#39;targetLanguage&#39;, saveOptions.targetLanguage || &#39;de&#39;);
          form.append(&#39;extractionMethod&#39;, saveOptions.extractionMethod || &#39;native&#39;);
          form.append(&#39;useCache&#39;, String(saveOptions.useCache ?? true));
          form.append(&#39;includeImages&#39;, String(saveOptions.includeImages ?? false));
          form.append(&#39;originalItemId&#39;, file.id);
          form.append(&#39;parentId&#39;, parentId);

          const res = await fetch(&#39;/api/secretary/process-pdf&#39;, {
            method: &#39;POST&#39;,
            headers: { &#39;X-Library-Id&#39;: activeLibraryId },
            body: form,
          });

          if (!res.ok) {
            const msg = await res.text().catch(() =&gt; &#39;unknown error&#39;);
            FileLogger.error(&#39;PdfBulkImportDialog&#39;, &#39;Job enqueue failed&#39;, { name: file.metadata.name, status: res.status, msg });
          } else {
            FileLogger.info(&#39;PdfBulkImportDialog&#39;, &#39;Job enqueued&#39;, { name: file.metadata.name });
          }
        } catch (error) {
          FileLogger.error(&#39;PdfBulkImportDialog&#39;, &#39;Fehler beim Enqueue für Datei&#39;, { fileId: file.id, error });
          // Weiter mit nächster Datei
        }
      }

      onOpenChange(false);
    } finally {
      setIsEnqueuing(false);
    }
  }, [activeLibraryId, candidates.length, saveOptions, onOpenChange]);

  return (
    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;
      &lt;DialogContent className=&quot;max-w-3xl&quot;&gt;
        &lt;DialogHeader&gt;
          &lt;DialogTitle&gt;PDF-Verzeichnis verarbeiten&lt;/DialogTitle&gt;
          &lt;DialogDescription&gt;
            Wählen Sie Optionen wie beim Einzel-PDF-Dialog. Optional bereits transformierte PDFs ignorieren.
          &lt;/DialogDescription&gt;
        &lt;/DialogHeader&gt;

        &lt;div className=&quot;space-y-4&quot;&gt;
          &lt;div className=&quot;rounded-md border p-3&quot;&gt;
            &lt;div className=&quot;flex items-center gap-2&quot;&gt;
              &lt;Checkbox id=&quot;ignore-existing&quot; checked={ignoreExisting} onCheckedChange={(v) =&gt; setIgnoreExisting(Boolean(v))} /&gt;
              &lt;Label htmlFor=&quot;ignore-existing&quot;&gt;Ignore existing transformations&lt;/Label&gt;
            &lt;/div&gt;
          &lt;/div&gt;

          &lt;div className=&quot;rounded-md border p-3&quot;&gt;
            &lt;SaveOptionsComponent
              originalFileName={&#39;&#39;}
              onOptionsChangeAction={handleOptionsChange}
              className=&quot;mb-0&quot;
              showExtractionMethod={true}
              defaultExtractionMethod={saveOptions.extractionMethod || &#39;native&#39;}
              showUseCache={true}
              defaultUseCache={saveOptions.useCache ?? true}
              showIncludeImages={true}
              defaultIncludeImages={saveOptions.includeImages ?? false}
            /&gt;
          &lt;/div&gt;

          &lt;div className=&quot;rounded-md border p-3&quot;&gt;
            &lt;div className=&quot;flex items-center justify-between text-sm&quot;&gt;
              &lt;div className=&quot;flex gap-4&quot;&gt;
                &lt;div&gt;
                  &lt;span className=&quot;text-muted-foreground&quot;&gt;Gesamt PDFs:&lt;/span&gt; &lt;span className=&quot;font-medium&quot;&gt;{stats.totalPdfs}&lt;/span&gt;
                &lt;/div&gt;
                &lt;div&gt;
                  &lt;span className=&quot;text-muted-foreground&quot;&gt;Ignoriert:&lt;/span&gt; &lt;span className=&quot;font-medium&quot;&gt;{stats.skippedExisting}&lt;/span&gt;
                &lt;/div&gt;
                &lt;div&gt;
                  &lt;span className=&quot;text-muted-foreground&quot;&gt;Zu verarbeiten:&lt;/span&gt; &lt;span className=&quot;font-medium&quot;&gt;{stats.toProcess}&lt;/span&gt;
                &lt;/div&gt;
              &lt;/div&gt;
              &lt;Button variant=&quot;outline&quot; size=&quot;sm&quot; onClick={handleScan} disabled={isScanning}&gt;
                {isScanning ? &#39;Scan läuft…&#39; : &#39;Neu scannen&#39;}
              &lt;/Button&gt;
            &lt;/div&gt;
            &lt;Separator className=&quot;my-3&quot; /&gt;
            &lt;ScrollArea className=&quot;h-40&quot;&gt;
              {preview.length === 0 ? (
                &lt;div className=&quot;text-sm text-muted-foreground&quot;&gt;Keine Kandidaten gefunden.&lt;/div&gt;
              ) : (
                &lt;ul className=&quot;text-sm list-disc pl-5&quot;&gt;
                  {preview.map((n, i) =&gt; (
                    &lt;li key={i}&gt;{n}&lt;/li&gt;
                  ))}
                &lt;/ul&gt;
              )}
            &lt;/ScrollArea&gt;
          &lt;/div&gt;
        &lt;/div&gt;

        &lt;DialogFooter&gt;
          &lt;Button variant=&quot;outline&quot; onClick={() =&gt; onOpenChange(false)} disabled={isEnqueuing || isScanning}&gt;Abbrechen&lt;/Button&gt;
          &lt;Button onClick={handleEnqueue} disabled={isEnqueuing || isScanning || candidates.length === 0}&gt;
            {isEnqueuing ? &#39;Wird gestartet…&#39; : `Jobs starten (${candidates.length})`}
          &lt;/Button&gt;
        &lt;/DialogFooter&gt;
      &lt;/DialogContent&gt;
    &lt;/Dialog&gt;
  );
}

export default PdfBulkImportDialog;
</code></pre></div>
<p>Ich habe den Bulk-Dialog direkt an die neue External-Job-Methode angepasst: Beim Klick auf “Jobs starten” werden die gefundenen PDFs jetzt sequentiell via POST auf <code>api/secretary/process-pdf</code> eingereiht (mit <code>X-Library-Id</code> und allen FormData-Optionen). Lint ist grün.</p>
<h3 id="kompatibilitat-und-notwendige-anpassungen">Kompatibilität und notwendige Anpassungen<a class="headerlink" href="#kompatibilitat-und-notwendige-anpassungen" title="Permanent link">&para;</a></h3>
<ul>
<li>Pdf-Bulk-Scan/Erkennung: unverändert kompatibel. Eure bestehende Rekursion/Filterung bleibt so.</li>
<li>Enqueue (neu umgesetzt): Für jedes PDF wird</li>
<li>der Binärinhalt geladen (<code>provider.getBinary</code>),</li>
<li>ein <code>File</code> erstellt,</li>
<li>FormData befüllt (<code>file</code>, <code>targetLanguage</code>, <code>extractionMethod</code>, <code>useCache</code>, <code>includeImages</code>, <code>originalItemId</code>, <code>parentId</code>),</li>
<li>ein Request gegen <code>POST /api/secretary/process-pdf</code> geschickt, Header: <code>X-Library-Id: &lt;activeLibraryId&gt;</code>.</li>
<li>Der Secretary arbeitet die Jobs nacheinander ab, Fortschritt/Resultat kommt über die Callback-Route und erscheint in eurer External-Job-Liste/SSE.</li>
<li>Library-Header: keine Änderung nötig; er öffnet nur den Dialog.</li>
</ul>
<h3 id="hinweise">Hinweise<a class="headerlink" href="#hinweise" title="Permanent link">&para;</a></h3>
<ul>
<li>Sequenzielles Enqueue ist bewusst gewählt (geringe Last, klare Reihenfolge). Wenn gewünscht, können wir später mit kleinem Parallelismus (2–3) throttle’n.</li>
<li>UI zeigt im Dialog keinen Fortschritt; Status/Logs bekommt ihr wie gehabt über <code>api/external/jobs/stream</code> bzw. die Job-Liste.</li>
</ul>
<h3 id="kurzer-testplan">Kurzer Testplan<a class="headerlink" href="#kurzer-testplan" title="Permanent link">&para;</a></h3>
<ul>
<li>Ordner öffnen, Dialog “PDF-Verzeichnis verarbeiten”, Scan prüfen.</li>
<li>“Jobs starten” klicken. In externer Job-Liste/SSE sollten sofort <code>queued</code>-Events auftauchen, danach <code>running</code>/<code>completed</code> oder <code>failed</code>.</li>
<li>
<p>Bei aktivierter Option “Bilder extrahieren” prüfen, dass zusätzliche Dateien/Ordner erzeugt werden (lokal oder OneDrive je nach Library).</p>
</li>
<li>
<p>Zusammenfassung:</p>
</li>
<li>Bestehende Scan-Logik ist voll kompatibel.</li>
<li>Enqueue ist jetzt an die External-Job-API angebunden.</li>
<li>Keine Änderungen am <code>library-header.tsx</code> nötig.</li>
</ul>
<hr />
<p><strong>User</strong></p>
<p>Wie funktioniert das Scannen der Verzeichnisse in diesem Batch-Dialog? Ich habe mehrere Verzeichnisse mit unterschiedlichen untergeordneten Dokumente. Warum werden die nicht alle erkannt?</p>
<hr />
<p><strong>Cursor</strong></p>
<p>Kurz: Der Dialog scannt rekursiv ab dem aktuell ausgewählten Ordner und sammelt alle Dateien, die als PDF erkannt werden. Viele “fehlende” Dateien werden bewusst übersprungen, z. B. wegen aktivem “Ignore existing transformations”, fehlender PDF-Erkennung (MIME/Endung), Provider-Fehlern oder Limitierungen (Pagination/Permissions).</p>
<h3 id="wie-der-scan-arbeitet">Wie der Scan arbeitet<a class="headerlink" href="#wie-der-scan-arbeitet" title="Permanent link">&para;</a></h3>
<p>```79:121:src/components/library/pdf-bulk-import-dialog.tsx
// rekursiver Scan (DFS mit Stack)
const stack: string[] = [folderId];
let total = 0;
let skipped = 0;
const selected: Array&lt;{ file: StorageItem; parentId: string }&gt; = [];
const previews: string[] = [];</p>
<p>while (stack.length) {
  const current = stack.pop() as string;
  let items: StorageItem[] = [];
  try {
    items = await provider.listItemsById(current);
  } catch (error) {
    FileLogger.error('PdfBulkImportDialog', 'Fehler beim Listen eines Ordners', { folderId: current, error });
    continue; // Ordner wird ausgelassen, es wird weitergescannt
  }</p>
<p>const folders = items.filter((i) =&gt; i.type === 'folder');
  folders.forEach((f) =&gt; stack.push(f.id));</p>
<p>const files = items.filter((i) =&gt; i.type === 'file');
  for (const file of files) {
    const name = file.metadata.name.toLowerCase();
    const isPdf = name.endsWith('.pdf') || file.metadata.mimeType?.toLowerCase() === 'application/pdf';
    if (!isPdf) continue; // nur PDFs
    total++;</p>
<pre><code>const base = getBaseName(file.metadata.name);
const shouldSkip = ignoreExisting &amp;&amp; hasTwinInFolder(items, base, saveOptions.targetLanguage);
if (shouldSkip) {
  skipped++;
  continue;
}
selected.push({ file, parentId: current });
if (previews.length &lt; 10) previews.push(file.metadata.name); // Vorschau limitiert auf 10
</code></pre>
<p>}
}</p>
<p>return { total, skipped, selected, previews };
<div class="highlight"><pre><span></span><code>### Häufige Gründe, warum Dateien “nicht erkannt” werden
- Ignore-Option: Mit “Ignore existing transformations” aktiv werden PDFs übersprungen, wenn im gleichen Ordner bereits ein Twin für die Ziel-Sprache existiert (`name.&lt;lang&gt;.md`).
- Root-Auswahl: Es wird ab dem aktuell geöffneten Ordner gescannt (`currentFolderIdAtom`). Nicht der Bibliotheks-Root? Dann bleiben andere Teilbäume außen vor.
- PDF-Erkennung: Nur wenn Endung `.pdf` ODER MIME `application/pdf`. Dateien ohne Endung/MIME werden nicht erkannt.
- Provider-Fehler: Fehler beim Auflisten eines Ordners werden geloggt und der Ordner wird übersprungen. Sieht man in den Logs.
- Pagination/Rate Limits (Cloud): Falls der Provider `listItemsById` nicht paginiert komplett liefert, fehlen Einträge in tiefen/umfangreichen Ordnern.
- Vorschau-Irrtum: Die Liste zeigt nur die ersten 10 Kandidaten, nicht alle. Die Kennzahl “Zu verarbeiten” ist maßgeblich.

### Was prüfen/ändern
- Im Dialog die Meldungen “Gesamt PDFs / Ignoriert / Zu verarbeiten” prüfen; bei vielen “Ignoriert” ggf. “Ignore existing transformations” deaktivieren.
- In den Logs nach “Fehler beim Listen eines Ordners” suchen; betroffene Ordner neu prüfen.
- Sicherstellen, dass Sie im gewünschten obersten Ordner sind, bevor Sie den Dialog öffnen.
- Provider: Prüfen, ob `listItemsById` vollständig paginiert und `mimeType` setzt. Bei OneDrive/Cloud ggf. Pagination in der Provider-Implementierung fixen.
- PDFs ohne `.pdf`-Endung: Endung ergänzen oder MIME zuverlässig bereitstellen.

Kurztest: In einem Test-Ordner mit 3 Unterordnern je 5 PDFs “Ignore existing” aus → “Zu verarbeiten” sollte 15 zeigen; mit je einem vorhandenen `name.de.md` in den gleichen Ordnern sollte “Ignoriert” steigen und “Zu verarbeiten” entsprechend sinken.

```typescriptreact
// rekursiver Scan (DFS mit Stack)
const stack: string[] = [folderId];
let total = 0;
let skipped = 0;
const selected: Array&lt;{ file: StorageItem; parentId: string }&gt; = [];
const previews: string[] = [];

while (stack.length) {
  const current = stack.pop() as string;
  let items: StorageItem[] = [];
  try {
    items = await provider.listItemsById(current);
  } catch (error) {
    FileLogger.error(&#39;PdfBulkImportDialog&#39;, &#39;Fehler beim Listen eines Ordners&#39;, { folderId: current, error });
    continue; // Ordner wird ausgelassen, es wird weitergescannt
  }

  const folders = items.filter((i) =&gt; i.type === &#39;folder&#39;);
  folders.forEach((f) =&gt; stack.push(f.id));

  const files = items.filter((i) =&gt; i.type === &#39;file&#39;);
  for (const file of files) {
    const name = file.metadata.name.toLowerCase();
    const isPdf = name.endsWith(&#39;.pdf&#39;) || file.metadata.mimeType?.toLowerCase() === &#39;application/pdf&#39;;
    if (!isPdf) continue; // nur PDFs
    total++;

    const base = getBaseName(file.metadata.name);
    const shouldSkip = ignoreExisting &amp;&amp; hasTwinInFolder(items, base, saveOptions.targetLanguage);
    if (shouldSkip) {
      skipped++;
      continue;
    }
    selected.push({ file, parentId: current });
    if (previews.length &lt; 10) previews.push(file.metadata.name); // Vorschau limitiert auf 10
  }
}

return { total, skipped, selected, previews };
</code></pre></div></p>
<hr />
<p><strong>User</strong></p>
<p>In die Liste der erkannten Dokumente würde ich vielleicht noch verbessern. Da können wir für jedes Dokument einen kleinen Teaser machen, der in der oberen Zeile das relative Verzeichnis anzeigt, in der unteren Zeile den Dateinamen, und ist es möglich, eventuell auch die Anzahl der Seiten auszulesen. Steht das in den Metadaten einer Datei oder ist das komplexer?</p>
<hr />
<p><strong>Cursor</strong></p>
<p>Ich ergänze jetzt im Dialog eine detailliertere Vorschau: Für die ersten 10 Kandidaten zeige ich relative Ordnerpfade (ab aktuellem Wurzelordner) in der ersten Zeile und den Dateinamen in der zweiten. Die Seitenzahl lese ich derzeit nicht aus, da sie nicht in den Metadaten steckt; das erfordert PDF-Parsing und wäre ein separater Schritt. Ich mache die UI-Anpassung jetzt.</p>
<div class="highlight"><pre><span></span><code>&#39;use client&#39;;

import { useCallback, useEffect, useMemo, useState } from &#39;react&#39;;
import { useAtomValue } from &#39;jotai&#39;;
import { activeLibraryIdAtom, currentFolderIdAtom } from &#39;@/atoms/library-atom&#39;;
import { useStorage } from &#39;@/contexts/storage-context&#39;;
import { StorageItem } from &#39;@/lib/storage/types&#39;;
import { Button } from &#39;@/components/ui/button&#39;;
import { Checkbox } from &#39;@/components/ui/checkbox&#39;;
import { Label } from &#39;@/components/ui/label&#39;;
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from &#39;@/components/ui/dialog&#39;;
import { ScrollArea } from &#39;@/components/ui/scroll-area&#39;;
import { Separator } from &#39;@/components/ui/separator&#39;;
import { TransformSaveOptions as SaveOptionsComponent } from &#39;@/components/library/transform-save-options&#39;;
import type { TransformSaveOptions as SaveOptionsType } from &#39;@/components/library/transform-save-options&#39;;
import { FileLogger } from &#39;@/lib/debug/logger&#39;;

interface PdfBulkImportDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) =&gt; void;
}

interface ScanStats {
  totalPdfs: number;
  skippedExisting: number;
  toProcess: number;
}

export function PdfBulkImportDialog({ open, onOpenChange }: PdfBulkImportDialogProps) {
  const { provider } = useStorage();
  const rootFolderId = useAtomValue(currentFolderIdAtom);
  const activeLibraryId = useAtomValue(activeLibraryIdAtom);

  const [ignoreExisting, setIgnoreExisting] = useState(true);
  const [isScanning, setIsScanning] = useState(false);
  const [isEnqueuing, setIsEnqueuing] = useState(false);
  const [candidates, setCandidates] = useState&lt;Array&lt;{ file: StorageItem; parentId: string }&gt;&gt;([]);
  const [previewItems, setPreviewItems] = useState&lt;Array&lt;{ id: string; name: string; relPath: string; pages?: number }&gt;&gt;([]);
  const [stats, setStats] = useState&lt;ScanStats&gt;({ totalPdfs: 0, skippedExisting: 0, toProcess: 0 });

  // Optionen wie im Einzel-PDF-Dialog
  const [saveOptions, setSaveOptions] = useState&lt;SaveOptionsType&gt;({
    targetLanguage: &#39;de&#39;,
    fileName: &#39;&#39;,
    createShadowTwin: true,
    fileExtension: &#39;md&#39;,
    extractionMethod: &#39;native&#39;,
    useCache: true,
    includeImages: false,
  });

  // Shadow-Twin Erkennung (z. B. name.de.md)
  const shadowTwinRegex = useMemo(() =&gt; /^(.+)\.(de|en|fr|es|it)\.md$/i, []);

  const getBaseName = useCallback((name: string): string =&gt; {
    const lastDot = name.lastIndexOf(&#39;.&#39;);
    return lastDot === -1 ? name : name.substring(0, lastDot);
  }, []);

  const hasTwinInFolder = useCallback(
    (siblings: StorageItem[], pdfBase: string, lang?: string): boolean =&gt; {
      if (lang) {
        const expected = `${pdfBase}.${lang}.md`;
        return siblings.some((i) =&gt; i.type === &#39;file&#39; &amp;&amp; i.metadata.name.toLowerCase() === expected.toLowerCase());
      }
      // Fallback: irgendein Twin in beliebiger Sprache
      return siblings.some((i) =&gt; i.type === &#39;file&#39; &amp;&amp; shadowTwinRegex.test(i.metadata.name));
    },
    [shadowTwinRegex]
  );

  // rekursiver Scan
  const scanFolder = useCallback(async (folderId: string) =&gt; {
    if (!provider) return { total: 0, skipped: 0, selected: [] as Array&lt;{ file: StorageItem; parentId: string }&gt;, previews: [] as string[] };

    const stack: string[] = [folderId];
    let total = 0;
    let skipped = 0;
    const selected: Array&lt;{ file: StorageItem; parentId: string }&gt; = [];
    const previews: string[] = [];

    while (stack.length) {
      const current = stack.pop() as string;
      let items: StorageItem[] = [];
      try {
        items = await provider.listItemsById(current);
      } catch (error) {
        FileLogger.error(&#39;PdfBulkImportDialog&#39;, &#39;Fehler beim Listen eines Ordners&#39;, { folderId: current, error });
        continue;
      }

      const folders = items.filter((i) =&gt; i.type === &#39;folder&#39;);
      folders.forEach((f) =&gt; stack.push(f.id));

      const files = items.filter((i) =&gt; i.type === &#39;file&#39;);
      for (const file of files) {
        const name = file.metadata.name.toLowerCase();
        const isPdf = name.endsWith(&#39;.pdf&#39;) || file.metadata.mimeType?.toLowerCase() === &#39;application/pdf&#39;;
        if (!isPdf) continue;
        total++;

        const base = getBaseName(file.metadata.name);
        const shouldSkip = ignoreExisting &amp;&amp; hasTwinInFolder(items, base, saveOptions.targetLanguage);
        if (shouldSkip) {
          skipped++;
          continue;
        }
        selected.push({ file, parentId: current });
        if (previews.length &lt; 10) previews.push(file.metadata.name);
      }
    }

    return { total, skipped, selected, previews };
  }, [provider, getBaseName, ignoreExisting, hasTwinInFolder, saveOptions.targetLanguage]);

  const handleScan = useCallback(async () =&gt; {
    if (!provider || !rootFolderId) return;
    setIsScanning(true);
    setCandidates([]);
    setPreviewItems([]);
    try {
      const result = await scanFolder(rootFolderId);
      setCandidates(result.selected);
      // Vorschau-Details (max. 10) berechnen: relativer Pfad + Dateiname
      const top = result.selected.slice(0, 10);
      const details: Array&lt;{ id: string; name: string; relPath: string; pages?: number }&gt; = [];
      for (const { file, parentId } of top) {
        let relPath = &#39;.&#39;;
        try {
          const chain = await provider.getPathItemsById(parentId);
          const idx = chain.findIndex((it) =&gt; it.id === rootFolderId);
          const start = idx &gt;= 0 ? idx + 1 : 1; // nach aktuellem Root bzw. nach globalem Root
          const parts = chain.slice(start).map((it) =&gt; it.metadata.name).filter(Boolean);
          relPath = parts.length ? parts.join(&#39;/&#39;) : &#39;.&#39;;
        } catch {
          relPath = &#39;.&#39;;
        }
        details.push({ id: file.id, name: file.metadata.name, relPath });
      }
      setPreviewItems(details);
      setStats({ totalPdfs: result.total, skippedExisting: result.skipped, toProcess: result.selected.length });
    } finally {
      setIsScanning(false);
    }
  }, [provider, rootFolderId, scanFolder]);

  useEffect(() =&gt; {
    if (open) {
      // Bei Öffnen initial Scannen
      void handleScan();
    }
  }, [open, handleScan]);

  const handleOptionsChange = useCallback((opts: SaveOptionsType) =&gt; {
    setSaveOptions({
      ...opts,
      extractionMethod: opts.extractionMethod || &#39;native&#39;,
      useCache: opts.useCache ?? true,
      includeImages: opts.includeImages ?? false,
    });
  }, []);

  const handleEnqueue = useCallback(async () =&gt; {
    if (!activeLibraryId) return;
    if (candidates.length === 0) return;
    setIsEnqueuing(true);
    try {
      // Sequenzielles Anlegen von External-Jobs über unsere API-Route
      // Minimale Last, klare Reihenfolge (Secretary arbeitet der Reihe nach)
      for (const { file, parentId } of candidates) {
        try {
          const bin = await provider?.getBinary(file.id);
          if (!bin) continue;

          const pdfFile = new File([bin.blob], file.metadata.name, { type: bin.mimeType || &#39;application/pdf&#39; });

          const form = new FormData();
          form.append(&#39;file&#39;, pdfFile);
          form.append(&#39;targetLanguage&#39;, saveOptions.targetLanguage || &#39;de&#39;);
          form.append(&#39;extractionMethod&#39;, saveOptions.extractionMethod || &#39;native&#39;);
          form.append(&#39;useCache&#39;, String(saveOptions.useCache ?? true));
          form.append(&#39;includeImages&#39;, String(saveOptions.includeImages ?? false));
          form.append(&#39;originalItemId&#39;, file.id);
          form.append(&#39;parentId&#39;, parentId);

          const res = await fetch(&#39;/api/secretary/process-pdf&#39;, {
            method: &#39;POST&#39;,
            headers: { &#39;X-Library-Id&#39;: activeLibraryId },
            body: form,
          });

          if (!res.ok) {
            const msg = await res.text().catch(() =&gt; &#39;unknown error&#39;);
            FileLogger.error(&#39;PdfBulkImportDialog&#39;, &#39;Job enqueue failed&#39;, { name: file.metadata.name, status: res.status, msg });
          } else {
            FileLogger.info(&#39;PdfBulkImportDialog&#39;, &#39;Job enqueued&#39;, { name: file.metadata.name });
          }
        } catch (error) {
          FileLogger.error(&#39;PdfBulkImportDialog&#39;, &#39;Fehler beim Enqueue für Datei&#39;, { fileId: file.id, error });
          // Weiter mit nächster Datei
        }
      }

      onOpenChange(false);
    } finally {
      setIsEnqueuing(false);
    }
  }, [activeLibraryId, candidates.length, saveOptions, onOpenChange]);

  return (
    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;
      &lt;DialogContent className=&quot;max-w-3xl&quot;&gt;
        &lt;DialogHeader&gt;
          &lt;DialogTitle&gt;PDF-Verzeichnis verarbeiten&lt;/DialogTitle&gt;
          &lt;DialogDescription&gt;
            Wählen Sie Optionen wie beim Einzel-PDF-Dialog. Optional bereits transformierte PDFs ignorieren.
          &lt;/DialogDescription&gt;
        &lt;/DialogHeader&gt;

        &lt;div className=&quot;space-y-4&quot;&gt;
          &lt;div className=&quot;rounded-md border p-3&quot;&gt;
            &lt;div className=&quot;flex items-center gap-2&quot;&gt;
              &lt;Checkbox id=&quot;ignore-existing&quot; checked={ignoreExisting} onCheckedChange={(v) =&gt; setIgnoreExisting(Boolean(v))} /&gt;
              &lt;Label htmlFor=&quot;ignore-existing&quot;&gt;Ignore existing transformations&lt;/Label&gt;
            &lt;/div&gt;
          &lt;/div&gt;

          &lt;div className=&quot;rounded-md border p-3&quot;&gt;
            &lt;SaveOptionsComponent
              originalFileName={&#39;&#39;}
              onOptionsChangeAction={handleOptionsChange}
              className=&quot;mb-0&quot;
              showExtractionMethod={true}
              defaultExtractionMethod={saveOptions.extractionMethod || &#39;native&#39;}
              showUseCache={true}
              defaultUseCache={saveOptions.useCache ?? true}
              showIncludeImages={true}
              defaultIncludeImages={saveOptions.includeImages ?? false}
            /&gt;
          &lt;/div&gt;

          &lt;div className=&quot;rounded-md border p-3&quot;&gt;
            &lt;div className=&quot;flex items-center justify-between text-sm&quot;&gt;
              &lt;div className=&quot;flex gap-4&quot;&gt;
                &lt;div&gt;
                  &lt;span className=&quot;text-muted-foreground&quot;&gt;Gesamt PDFs:&lt;/span&gt; &lt;span className=&quot;font-medium&quot;&gt;{stats.totalPdfs}&lt;/span&gt;
                &lt;/div&gt;
                &lt;div&gt;
                  &lt;span className=&quot;text-muted-foreground&quot;&gt;Ignoriert:&lt;/span&gt; &lt;span className=&quot;font-medium&quot;&gt;{stats.skippedExisting}&lt;/span&gt;
                &lt;/div&gt;
                &lt;div&gt;
                  &lt;span className=&quot;text-muted-foreground&quot;&gt;Zu verarbeiten:&lt;/span&gt; &lt;span className=&quot;font-medium&quot;&gt;{stats.toProcess}&lt;/span&gt;
                &lt;/div&gt;
              &lt;/div&gt;
              &lt;Button variant=&quot;outline&quot; size=&quot;sm&quot; onClick={handleScan} disabled={isScanning}&gt;
                {isScanning ? &#39;Scan läuft…&#39; : &#39;Neu scannen&#39;}
              &lt;/Button&gt;
            &lt;/div&gt;
            &lt;Separator className=&quot;my-3&quot; /&gt;
            &lt;ScrollArea className=&quot;h-40&quot;&gt;
              {previewItems.length === 0 ? (
                &lt;div className=&quot;text-sm text-muted-foreground&quot;&gt;Keine Kandidaten gefunden.&lt;/div&gt;
              ) : (
                &lt;ul className=&quot;text-sm space-y-2&quot;&gt;
                  {previewItems.map((it) =&gt; (
                    &lt;li key={it.id} className=&quot;flex items-start justify-between gap-3&quot;&gt;
                      &lt;div className=&quot;min-w-0&quot;&gt;
                        &lt;div className=&quot;text-muted-foreground truncate&quot;&gt;{it.relPath}&lt;/div&gt;
                        &lt;div className=&quot;font-medium break-all&quot;&gt;{it.name}&lt;/div&gt;
                      &lt;/div&gt;
                      &lt;div className=&quot;shrink-0 text-muted-foreground whitespace-nowrap&quot;&gt;Seiten: —&lt;/div&gt;
                    &lt;/li&gt;
                  ))}
                &lt;/ul&gt;
              )}
            &lt;/ScrollArea&gt;
          &lt;/div&gt;
        &lt;/div&gt;

        &lt;DialogFooter&gt;
          &lt;Button variant=&quot;outline&quot; onClick={() =&gt; onOpenChange(false)} disabled={isEnqueuing || isScanning}&gt;Abbrechen&lt;/Button&gt;
          &lt;Button onClick={handleEnqueue} disabled={isEnqueuing || isScanning || candidates.length === 0}&gt;
            {isEnqueuing ? &#39;Wird gestartet…&#39; : `Jobs starten (${candidates.length})`}
          &lt;/Button&gt;
        &lt;/DialogFooter&gt;
      &lt;/DialogContent&gt;
    &lt;/Dialog&gt;
  );
}

export default PdfBulkImportDialog;
</code></pre></div>
<p>Ich habe die Vorschau im Batch-Dialog so erweitert, wie gewünscht: Oben steht jetzt der relative Ordnerpfad, darunter der Dateiname. Die ersten 10 Kandidaten werden so angezeigt.</p>
<ul>
<li>Wie ermittelt: Für jedes Top-Kandidaten-Item hole ich mit <code>provider.getPathItemsById(parentId)</code> die Ordnerkette und bilde daraus den Pfad relativ zum aktuell gescannten Root (<code>currentFolderIdAtom</code>). Falls der Pfad nicht auflösbar ist, zeige ich “.”.</li>
<li>Vorschau bleibt auf 10 Einträge limitiert; die Zähler oben (“Gesamt/ Ignoriert/ Zu verarbeiten”) beziehen sich weiterhin auf alle gefundenen Dateien.</li>
</ul>
<p>Zu Seitenzahlen: Die stehen nicht in unseren <code>StorageItemMetadata</code> und werden von gängigen Providern nicht bereitgestellt. Man muss das PDF parsen. Das ist komplexer und hat Performance-/Kostenfolgen.</p>
<p>Mögliche Wege für Seitenzahlen:
- Client-seitig: Für die Top-10-Kandidaten <code>provider.getBinary</code> laden und z. B. mit pdfjs im Browser Seiten zählen. Nachteil: Datenvolumen und CPU im Client.
- Server-seitig (empfohlen): Eine kleine API-Route, die das PDF per Provider lädt, Seitenzahl mit <code>pdfjs-dist</code>/<code>pdf-parse</code> ermittelt und cached. UI holt das lazy (on demand) und zeigt es, sobald verfügbar.
- Batch-vorberechnung: Im Hintergrund Seitenzahlen für alle Kandidaten in kleinen Wellen (Throttle) ermitteln und zwischenspeichern.</p>
<p>Soll ich die serverseitige Variante mit Caching für die Seitenzahl umsetzen? Dann baue ich eine kleine <code>GET /api/pdf/pages?itemId=&amp;libraryId=</code>-Route und zeige die Zahl lazy neben jedem Eintrag.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.50899def.min.js"></script>
      
        <script src="../../js/print-site.js"></script>
      
        <script src="https://unpkg.com/mermaid@10.9.1/dist/mermaid.min.js"></script>
      
        <script src="../../assets/javascripts/mermaid-init.js"></script>
      
    
  </body>
</html>