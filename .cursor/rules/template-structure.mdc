---
description: Template-Struktur und Syntax fÃ¼r Transform-by-Template
globs: template-samples/**/*,src/components/templates/**/*,src/lib/external-jobs/template-*.ts,src/app/templates/**/*
alwaysApply: false
---

# Template-Struktur

## Was ist ein Template?

Ein **Template** definiert, wie der Secretary Service einen Quelltext (z.B. PDF-Extrakt, Audio-Transkript) in strukturiertes Markdown mit Frontmatter transformiert. Es besteht aus drei Teilen:

1. **Frontmatter** - YAML-Block mit Feld-Definitionen
2. **Body** - Markdown-Struktur fÃ¼r den Output
3. **Systemprompt** - LLM-Rolle und Parsing-Regeln

## Template-Anatomie

```markdown
---
# FRONTMATTER: Feld-Definitionen mit Placeholder-Syntax
title: {{title|Beschreibung fÃ¼r das LLM, was extrahiert werden soll}}
summary: {{summary|Zusammenfassung des Dokuments (2-3 SÃ¤tze)}}
tags: {{tags|Array von Tags, lowercase, kebab-case}}
---

# BODY: Markdown-Struktur mit Placeholder-Referenzen
## {{title}}

{{summary}}

## Kapitel 1
{{kapitel1_inhalt}}

--- systemprompt
# SYSTEMPROMPT: LLM-Rolle und Parsing-Regeln

Rolle:
- Du bist ein...

Strenge Regeln:
- Verwende ausschlieÃŸlich Inhalte, die EXPLIZIT im Text vorkommen
- Keine Halluzinationen
...

Antwortschema (JSON):
{ "title": "string", ... }
```

## Placeholder-Syntax

### Im Frontmatter: `{{feldname|Beschreibung}}`

```yaml
title: {{title|VollstÃ¤ndiger Titel des Dokuments (extraktiv)}}
#       â†‘       â†‘
#       Feld    Anweisung fÃ¼r das LLM
```

- **feldname**: Name des JSON-Feldes im Output
- **Beschreibung**: Anweisung fÃ¼r das LLM, wie der Wert extrahiert/generiert werden soll

### Im Body: `{{feldname}}`

```markdown
## {{title}}

{{summary}}
```

- Referenziert das Feld aus dem Frontmatter
- Wird im Output durch den generierten Wert ersetzt

## Feldtypen: Dynamisch vs. Fest

Im Frontmatter gibt es zwei grundsÃ¤tzlich verschiedene Feldtypen:

### ğŸ”µ Dynamische Felder (LLM fÃ¼llt aus)

Syntax: `feldname: {{variable|Anweisung fÃ¼r das LLM}}`

Das LLM extrahiert oder generiert den Wert basierend auf dem Quelltext.

```yaml
# Dynamische Felder - LLM liefert den Wert
title: {{title|VollstÃ¤ndiger Titel des Dokuments (extraktiv)}}
summary: {{summary|Zusammenfassung in 2-3 SÃ¤tzen}}
tags: {{tags|Array von Tags, lowercase, kebab-case}}
year: {{year|Jahr (YYYY) oder null wenn nicht erkennbar}}
```

**Varianten dynamischer Felder:**

| Typ | Syntax | Beispiel |
|-----|--------|----------|
| String | `{{feld\|Beschreibung}}` | `title: {{title\|Titel des Dokuments}}` |
| Array | `{{feld\|Array von...}}` | `tags: {{tags\|Array von Tags}}` |
| Boolean | `{{feld\|boolean: true/false}}` | `isScan: {{isScan\|boolean; true wenn...}}` |
| Nullable | `{{feld\|... oder null}}` | `year: {{year\|YYYY oder null}}` |
| Enum | `{{feld\|Eine aus: a, b, c}}` | `status: {{status\|Eine aus: geplant, in_umsetzung, umgesetzt}}` |

### âšª Feste Felder (fixe Werte)

Syntax: `feldname: wert` (ohne `{{...}}`)

Der Wert wird 1:1 in jedes transformierte Dokument Ã¼bernommen. NÃ¼tzlich fÃ¼r:
- Dokumenttyp/Format-Identifier
- Sprachkennzeichnung
- Feste Kategorien
- Prompts fÃ¼r Bildgenerierung

```yaml
# Feste Felder - immer derselbe Wert
sprache: de
docType: klimamassnahme
detailViewType: climateAction
region: SÃ¼dtirol
coverImagePrompt: Erstelle ein Hintergrundbild fÃ¼r einen Blogartikel...
```

### Mischbeispiel

```yaml
---
# DYNAMISCH: LLM extrahiert/generiert
title: {{title|Kurzer Titel der MaÃŸnahme (max. 80 Zeichen)}}
summary: {{summary|Zusammenfassung fÃ¼r BÃ¼rger:innen (2-3 SÃ¤tze)}}
tags: {{tags|Array von relevanten Keywords}}

# FEST: Immer gleicher Wert
sprache: de
docType: klimamassnahme
detailViewType: climateAction
coverImagePrompt: Erstelle ein Hintergrundbild ohne Text...
---
```

## Systemprompt-Abschnitte

Der Systemprompt (nach `--- systemprompt`) definiert das LLM-Verhalten:

### 1. Rolle
```markdown
Rolle:
- Du bist ein penibler, rein EXTRAKTIVER Sachbearbeiter...
- Deine Aufgabe ist es, formale Beschreibungen in verstÃ¤ndliche Texte zu Ã¼bersetzen
```

### 2. Strenge Regeln
```markdown
Strenge Regeln:
- Verwende ausschlieÃŸlich Inhalte, die EXPLIZIT im Text vorkommen
- Keine Halluzinationen
- Wenn Information nicht sicher vorliegt: gib "" oder null zurÃ¼ck
- Antworte AUSSCHLIESSLICH mit einem gÃ¼ltigen JSON-Objekt
```

### 3. Parsing-Regeln (optional)
```markdown
Parsing-Regeln fÃ¼r Markdown-Quelle:
- Erkenne Felder anhand der im Text vorkommenden Marker:
  * "Nr." â†’ Massnahme_Nr (nur die Zahl extrahieren)
  * "Handlungsfeld" â†’ handlungsfeld
```

### 4. Formatierungsregeln (optional)
```markdown
Formatierungsregeln:
- AbsÃ¤tze max. 4-6 Zeilen
- Keine AufzÃ¤hlungsorgien
- Sprache: klar, ruhig, sachlich
```

### 5. Antwortschema (PFLICHT)
```markdown
Antwortschema (MUSS exakt ein JSON-Objekt sein):
{
  "title": "string",
  "summary": "string",
  "tags": "string[]",
  ...
}
```

## Template-Typen

### Extraktive Templates
- Extrahieren Informationen direkt aus dem Quelltext
- Beispiel: `pdfanalyse.md` - wissenschaftliche Dokumente katalogisieren

```yaml
title: {{title|VollstÃ¤ndiger Titel (extraktiv, aus Heading)}}
authors: {{authors|Array von Autoren (extraktiv, aus Impressum)}}
```

### Generative Templates
- Generieren neue Texte basierend auf dem Quelltext
- Beispiel: `klimamassnahme-detail-de.md` - Blogartikel aus Verwaltungsdokumenten

```yaml
intro: {{intro|Blogtext: 2-3 SÃ¤tze. Warum betrifft diese MaÃŸnahme den Alltag?}}
worum: {{worum|Blogtext: Ziel der MaÃŸnahme, gesellschaftlicher Kontext}}
```

## Wichtige Felder (Standard)

Diese Felder sind in den meisten Templates enthalten:

| Feld | Beschreibung |
|------|--------------|
| `title` | Haupttitel des Dokuments/Artikels |
| `shortTitle` | Kurztitel fÃ¼r Listen (max. 50 Zeichen) |
| `slug` | URL-freundlicher Identifier |
| `summary` | Zusammenfassung (2-3 SÃ¤tze) |
| `teaser` | Kurzer AnreiÃŸer (max. 200 Zeichen) |
| `tags` | Keywords fÃ¼r Suche/Kategorisierung |
| `sprache` | Dokumentsprache (de, en, it) |
| `format` | Template-Identifier (z.B. `klimamassnahme-detail`) |
| `coverImagePrompt` | Prompt fÃ¼r Bildgenerierung |

## Datenfluss

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Quelldokument     â”‚     â”‚  Template          â”‚     â”‚  Secretary Service â”‚
â”‚  (PDF/Audio/MD)    â”‚â”€â”€â”€â”€â–¶â”‚  (Frontmatter +    â”‚â”€â”€â”€â”€â–¶â”‚  (LLM)             â”‚
â”‚                    â”‚     â”‚   Body + Prompt)   â”‚     â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                              â”‚
                                                              â–¼
                                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                     â”‚  Output            â”‚
                                                     â”‚  (Markdown +       â”‚
                                                     â”‚   Frontmatter)     â”‚
                                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Checkliste fÃ¼r neue Templates

- [ ] Frontmatter definiert alle benÃ¶tigten Felder mit `{{feld|Beschreibung}}`
- [ ] Body verwendet die Felder mit `{{feld}}`
- [ ] Systemprompt definiert klare Rolle
- [ ] Strenge Regeln verbieten Halluzinationen
- [ ] Antwortschema ist vollstÃ¤ndig und korrekt
- [ ] Feste Felder (`sprache`, `format`) sind ohne Placeholder gesetzt
- [ ] `coverImagePrompt` ist definiert (falls Bildgenerierung gewÃ¼nscht)

## Beispiel-Templates

| Template | Zweck | Typ |
|----------|-------|-----|
| `pdfanalyse.md` | Wissenschaftliche Dokumente katalogisieren | Extraktiv |
| `klimamassnahme-detail-de.md` | KlimamaÃŸnahmen als Blogartikel | Generativ |
| `testimonial-creation-de.md` | Testimonials aus Events erstellen | Generativ |
| `event-creation-de.md` | Event-Dokumentation | Hybrid |
